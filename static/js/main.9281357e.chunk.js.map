{"version":3,"sources":["modules/epubViewer/style.ts","modules/epubViewer/EpubViewer.tsx","LoadingView.tsx","lib/utils/commonUtil.ts","modules/reactViewer/viewerStyle.ts","modules/reactViewer/ReactViewer.tsx","lib/styles/palette.ts","lib/styles/zIndex.ts","components/header/Wrapper.tsx","components/header/Layout.tsx","lib/styles/styles.ts","components/header/ControlBtn.tsx","lib/svg/Prev.js","lib/svg/Next.js","lib/svg/BookClose.js","lib/svg/BookOpen.js","lib/svg/Close.js","lib/svg/Down.js","lib/svg/ScrollHorizontal.js","lib/svg/ScrollVertical.js","lib/svg/Search.js","components/header/ControlIconBtn.tsx","components/header/VerticalLine.tsx","containers/Header.tsx","components/footer/Wrapper.tsx","components/footer/Item.tsx","components/footer/MoveBtn.tsx","containers/Footer.tsx","components/sideMenu/CloseBtn.tsx","components/sideMenu/Wrapper.tsx","components/nav/BookInfo.tsx","components/nav/NavItem.tsx","containers/menu/Nav.tsx","components/option/Layout.tsx","components/option/OptionWrapper.tsx","components/option/OptionTitle.tsx","components/option/DropdownValue.tsx","components/option/DropdownItemWrapper.tsx","components/option/DropdownItem.tsx","components/option/Dropdown.tsx","components/option/OptionValue.tsx","components/option/SliderValue.tsx","components/option/Slider.tsx","containers/menu/Option.tsx","components/learning/highlight/Wrapper.tsx","components/learning/highlight/Title.tsx","components/learning/highlight/Post.tsx","components/learning/highlight/PageNum.tsx","slices/book.ts","containers/menu/commons/Highlight.tsx","components/learning/Layout.tsx","components/learning/SortedBtnWrapper.tsx","components/learning/SortedBtn.tsx","components/sideMenu/MenuEmpty.tsx","containers/menu/Note.tsx","lib/styles/viewerLayout.ts","components/contextMenu/Wrapper.tsx","components/contextMenu/ColorItem.tsx","components/contextMenu/Item.tsx","containers/commons/ContextMenu.tsx","lib/styles/media.ts","lib/styles/animations.ts","components/commons/Snackbar.tsx","slices/snackbar.ts","containers/commons/Snackbar.tsx","components/commons/ViewerWrapper.tsx","slices/index.ts","lib/hooks/useMenu.ts","lib/hooks/useHighlight.ts","containers/Reader.tsx","index.tsx"],"names":["EpubViewerWrapper","styled","div","EpubViewer","ref","url","epubFileOptions","epubOptions","style","location","bookChanged","rendtionChanged","pageChanged","tocChanged","selectionChanged","loadingView","useState","isLoaded","setIsLoaded","book","setBook","rendition","setRendition","toc","setToc","currentCfi","useRef","initRendition","book_","node","current","rendition_","renderTo","width","height","display","length","href","movePage","useCallback","type","prev","next","handleKeyPress","key","onLocationChange","loc","startCfi","start","endCfi","end","base","slice","split","spineItem","spine","get","navItem","navigation","chapterName","label","trim","locations","currentPage","locationFromCfi","totalPage","total","onHighlight","cfiRange","callback","color","annotations","remove","highlight","registerGlobalFunc","prevPage","nextPage","getCurrentCfi","offHighlight","setLocation","useEffect","Error","destroy","Book","loaded","then","toc_","map","t","ready","stored","localStorage","getItem","load","generate","setItem","save","initBook","document","addEventListener","on","removeEventListener","off","React","forwardRef","spin","keyframes","LoadingWrapper","Wrapper","Content","LoadingView","timeFormatter","time","yyyy","getFullYear","mm","getMonth","dd","getDate","compareCfi","cfi_1","cfi_2","EpubCFI","compare","cfiRangeSpliter","origin","getParagraphCfi","viewerStyle","ReactViewer","viewerLayout","viewerOption","onBookInfoChange","onPageChange","onTocChange","onSelection","layoutStyle","setLayoutStyle","fontFamily","fontSize","lineHeight","marginHorizontal","marginVertical","bookStyle","setBookStyle","flow","resizeOnOrientationChange","spread","bookOption","setBookOption","currentSelection","contents","onResize","useMemo","debounce","viewerLayout_","MIN_VIEWER_WIDTH","MIN_VIEWER_HEIGHT","VIEWER_HEADER_HEIGHT","VIEWER_FOOTER_HEIGHT","VIEWER_SIDEMENU_WIDTH","window","win_w","innerWidth","win_h","innerHeight","componentHeight","w","h","marginTop","l","resize","onSelected","a","iframe","querySelector","iframeWin","contentWindow","selection_","getSelection","toString","Promise","resolve","setTimeout","all","metadata","opened","metaData","bookData","newBookData","coverURL","archive","urlCache","cover","title","description","published_date","Date","pubdate","modified_date","author","creator","publisher","language","catch","error","stack","newStyle","Object","assign","body","themes","register","viewerDefaultStyles","select","palette","white","black","gray0","gray1","gray2","gray3","gray4","gray5","gray6","gray7","gray8","red0","red1","red2","red3","red4","red5","red6","red7","red8","orange0","orange1","orange2","orange3","orange4","orange5","orange6","orange7","orange8","yellow0","yellow1","yellow2","yellow3","yellow4","yellow5","yellow6","yellow7","yellow8","green0","green1","green2","green3","green4","green5","green6","green7","green8","blue0","blue1","blue2","blue3","blue4","blue5","blue6","blue7","blue8","purple0","purple1","purple2","purple3","purple4","purple5","purple6","purple7","purple8","zIndexSet","layer","zIndex","header","menu","modal","snackbar","tooltip","Layout","AutoLayout","noselect","transition","boxShadow","scrollbar","Btn","button","styles","ControlBtn","message","onClick","SvgPrev","props","xmlns","viewBox","id","data-name","fill","d","opacity","className","SvgNext","SvgBookClose","SvgBookOpen","SvgClose","SvgDown","stroke","strokeLinecap","strokeLinejoin","strokeWidth","SvgScrollHorizontal","cx","cy","r","SvgScrollVertical","SvgSearch","active","isSelected","css","Icon","ControlIconBtn","alt","HeaderIcon","ScrollVerticalIcon","ScrollHorizontalIcon","BookOpenIcon","BookCloseIcon","Bar","VerticalLine","Header","onNavToggle","onOptionToggle","onLearningToggle","onBookOptionChange","isScrollHorizontal","setIsScrollHorizontal","viewType","setViewType","onClickDirection","onClickViewType","isSpread","Container","Item","text","MoveBtn","PrevIcon","NextIcon","msg","Footer","nowPage","onPageMove","CloseIcon","CloseBtn","show","onClose","children","BookImg","img","BookContent","Title","Info","BookInfo","src","NavItem","Nav","control","onToggle","onLocation","useSelector","state","bookToc","Tocs","idx","open","OptionWrapper","OptionTitle","isDropdown","span","DropdownValue","value","Down","DropdownItemWrapper","DropdownItem","DropdownWrapper","Dropdown","defaultValue","valueList","onSelect","visible","setVisible","e","path","includes","Items","font","OptionValue","SliderWrapper","SliderBackground","SliderBar","percentage","Slider","input","SliderValue","minValue","maxValue","step","onChange","Math","round","min","max","disabled","Option","bookFlow","emitEvent","onBookStyleChange","setFontFamily","setFontSize","setLineHeight","setMarginHorizontal","setMarginVertical","onChangeSlider","target","timer","clearTimeout","Post","PageNum","num","initialBook","initialState","currentLocation","highlights","colorList","name","code","bookSlice","createSlice","reducers","updateBook","action","payload","updateCurrentPage","clearBook","updateToc","clearToc","pushHighlight","filter","push","updateHighlight","new_idx","old_idx","indexOf","splice","popHighlight","actions","Highlight","viewerRef","dispatch","useDispatch","now","toISOString","accessTime","splitCfi","svgContainer","targetSvg","childNodes","pageNum","chpaterName","content","SortedBtnWrapper","SortedBtn","MenuEmpty","Note","onClickHighlight","sorted","setSorted","highlightList","setHighlightList","onSortedClick","sortedKey","sort","b","getTime","contextmenuWidth","x","y","isReverse","ColorWrapper","Color","Message","ColorItem","blur","ContextMenu","selection","onAddHighlight","onRemoveHighlight","onUpdateHighlight","onContextmMenuRemove","menuRef","setHighlight","setDisplay","isEraseBtn","setIsEraseBtn","setIsReverse","setHeight","setY","ColorList","update","onRemoveHighlight_","onRemove","onKeyPress","paragraphCfi","filtered","highlight_","scrolledTarget","itemCnt","defaultHeight","y_","mediaQuery","maxWidth","mediaValue","media","xlarge","large","medium","small","xsmall","custom","animations","fadeIn","fadeOut","fadeInTop","fadeOutTop","fadeInBottom","fadeOutBottom","fadeInLeft","fadeOutLeft","fadeInRight","fadeOutRight","Snackbar","RefEvent","newSnackbar","createAsyncThunk","event","shift","SnackbarSlice","deleteSnackbar","appendSnackbar","SnackbarWrapper","preventDefault","stopPropagation","ViewerWrapper","reducer","combineReducers","store","configureStore","useMenu","delay","eventSignal","setEventSignal","setControl","epubIframe","useHighlight","setIsContextMenu","setSelection","baseCfiRange","targetCfiRange","splitCfi1","splitCfi2","s1","e1","s2","e2","clashCfiRange","removeAllRanges","position","viewer","CONTEXTMENU_WIDTH","windowWidth","windowHeight","iframeWidth","offsetWidth","scrollTop","rangeCount","getRangeAt","getBoundingClientRect","selectionX","selectionY","selectionHeight","selectionWidth","getSelectionPosition","highlightNode","targetNode","parentElement","dataset","epubcfi","createTime","forEach","cfi","replace","cfiPath","Number","iframeBody","component","n","bookmark","getNodefromCfi","Reader","navRef","optionRef","learningRef","isContextMenu","navControl","optionControl","learningControl","bookOption_","page","result","bookStyle_","ReaderWrapper","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.9281357e.chunk.js","sourcesContent":["import styled from 'styled-components'\r\n\r\nconst EpubViewerWrapper = styled.div`\r\n\twidth: 100%;\r\n\tbox-sizing: border-box;\r\n\tmargin: 0 auto;\r\n\t\r\n\t& > div {\r\n\t\t&::-webkit-scrollbar {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nexport default EpubViewerWrapper","import React, { useState, useEffect, useCallback, useRef } from 'react'\r\nimport { Book, Rendition } from \"epubjs\";\r\n// style\r\nimport EpubViewerWrapper from 'modules/epubViewer/style'\r\n// types\r\nimport { EpubViewerProps, ViewerRef } from 'types'\r\nimport Toc from 'types/toc'\r\nimport Loc from 'types/loc'\r\n\r\n\r\n/**\r\n * EpubViewer Module\r\n * @class\r\n * @param props\r\n * @param props.url Epub path\r\n * @param props.epubFileOptions Epub file option\r\n * @param props.epubOptions Epub viewer option\r\n * @param props.style Epub Wrapper style\r\n * @param props.location Epub CFI or href\r\n * @param props.bookChanged Run when book changed\r\n * @param props.rendtionChanged Run when rendition changed\r\n * @param props.pageChanged Run when page changed\r\n * @param props.tocChanged Run when toc changed\r\n * @param props.selectionChanged Run when selected\r\n * @param props.loadingView Loading Component\r\n * @param ref Viewer ref\r\n */\r\nconst EpubViewer = ({\r\n  url, \r\n  epubFileOptions, \r\n  epubOptions,\r\n  style,\r\n  location,\r\n  bookChanged,\r\n  rendtionChanged,\r\n  pageChanged,\r\n  tocChanged,\r\n  selectionChanged,\r\n  loadingView,\r\n}: EpubViewerProps, ref: React.RefObject<ViewerRef> | any) => {\r\n  // TODO Fix the ref type correctly instead 'any' type.\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n  const [book, setBook] = useState<Book | null>(null);\r\n\r\n  const [rendition, setRendition] = useState<Rendition | null>(null);\r\n\r\n  const [toc, setToc] = useState<Toc[]>([]);\r\n\r\n  const currentCfi = useRef<string>('');\r\n\r\n  \r\n\r\n  /**\r\n   * Init Book\r\n   * @method\r\n   * - Set book state\r\n   * - Set Epub path state\r\n   * - Set isLoaded state\r\n   * - Set toc state\r\n   */\r\n  const initBook = () => {\r\n    if (book) {\r\n      book.destroy();\r\n    }\r\n    \r\n    const book_ = new Book(url, epubFileOptions);\r\n    setBook(book_);\r\n\r\n    bookChanged && bookChanged(book_);\r\n\r\n    book_.loaded.navigation.then(({ toc }) => {\r\n      const toc_: Toc[] = toc.map(t => ({ \r\n        label: t.label, \r\n        href: t.href \r\n      }));\r\n      \r\n      setIsLoaded(true);\r\n      setToc(toc_);\r\n      tocChanged && tocChanged(toc_);\r\n      initRendition(book_);\r\n    });\r\n\r\n    // Init Location & Pagination\r\n    book_.ready.then(function() {\r\n      const stored = localStorage.getItem(book_.key() + '-locations');\r\n      if (stored) {\r\n          return book_.locations.load(stored);\r\n      } else {\r\n          return book_.locations.generate(1024);\r\n      }\r\n    }).then(() => {\r\n      localStorage.setItem(book_.key() + '-locations', book_.locations.save());\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Init Rendition\r\n   * @method\r\n   * - Init iframe tag on DOM element\r\n   * - Set rendition\r\n   * - Set start page\r\n   */\r\n  const initRendition = (book_: Book) => {\r\n    const node = ref.current;\r\n    if (!node || !book_) return;\r\n    \r\n    const rendition_ = book_.renderTo(node, {\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      ...epubOptions\r\n    });\r\n    setRendition(rendition_);\r\n    \r\n    rendtionChanged && rendtionChanged(rendition_);\r\n\r\n    if(typeof location === \"string\") {\r\n      rendition_.display(location);\r\n    } else if(toc.length > 0 && toc[0].href) {\r\n      rendition_.display(toc[0].href);\r\n    } else {\r\n      rendition_.display();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move page\r\n   * @method\r\n   * @param type direction\r\n   */\r\n  const movePage = useCallback((type: \"PREV\" | \"NEXT\") => {\r\n    if (!rendition) return;\r\n    if (type === \"PREV\") rendition.prev();\r\n    else rendition.next();\r\n  }, [rendition]);\r\n\r\n  /**\r\n   * Move page by arrow key\r\n   * @method\r\n   * @param props Keyboard Event\r\n   * @param props.key \r\n   */\r\n  const handleKeyPress = useCallback(({ key }: any) => {\r\n    key && key === \"ArrowLeft\" && movePage(\"PREV\");\r\n    key && key === \"ArrowRight\" && movePage(\"NEXT\");\r\n  }, [movePage]);\r\n\r\n  /**\r\n   * Run when location changed\r\n   * @method\r\n   * @param loc\r\n   * - Set location state\r\n   * - Run 'locationChanged()' through startCFI\r\n   */\r\n  const onLocationChange = useCallback((loc: Loc) => {\r\n    const startCfi = loc && loc.start;\r\n    const endCfi = loc && loc.end;\r\n    const base = loc && loc.start.slice(8).split('!')[0];\r\n\r\n    if (!book) return;\r\n\r\n    const spineItem = book.spine.get(startCfi);\r\n    const navItem = book.navigation.get(spineItem.href);\r\n    const chapterName = navItem && navItem.label.trim();\r\n\r\n    const locations: any = book.locations;\r\n    const currentPage = locations.locationFromCfi(startCfi);\r\n    const totalPage = locations.total;\r\n\r\n    pageChanged && pageChanged({\r\n      chapterName, \r\n      currentPage, \r\n      totalPage, \r\n      startCfi, \r\n      endCfi,\r\n      base\r\n    });\r\n\r\n    currentCfi.current = startCfi;\r\n  }, [book, pageChanged]);\r\n\r\n  /**\r\n   * Highlight function\r\n   * @param cfiRange Selecton CFIRange\r\n   * @param color Highlight color\r\n   * @param callback Highlight callback function when click it\r\n   */\r\n   const onHighlight = useCallback((\r\n    cfiRange: string, \r\n    callback: (e: any) => void,\r\n    color?: string\r\n  ) => {\r\n    if (!rendition) return;\r\n\r\n    rendition.annotations.remove(cfiRange, 'highlight');\r\n    rendition.annotations.highlight(\r\n      cfiRange, \r\n      {}, \r\n      callback, \r\n      \"epub-highlight\",\r\n      { 'fill': color || '#fdf183' }\r\n    );\r\n  }, [rendition]);\r\n\r\n  /**\r\n   * Register viewer control function\r\n   * @method\r\n   * - REF.CURRENT.prevPage() : Move prev page\r\n   * - REF.CURRENT.nextPage() : Move next page\r\n   * - REF.CURRENT.getCurrentCfi() : Get current CFI\r\n   * - REF.CURRENT.onHighlight(): Set highlight\r\n   * - REF.CURRENT.offHighlight(): Remove specific highliht\r\n   * - REF.CURRENT.seLocation(): Move to specific cfi or href\r\n   */\r\n  const registerGlobalFunc = useCallback(() => {\r\n    if (!ref.current) return;\r\n    if (movePage) {\r\n      ref.current.prevPage = () => movePage(\"PREV\");\r\n      ref.current.nextPage = () => movePage(\"NEXT\");\r\n    }\r\n    ref.current.getCurrentCfi = () => currentCfi.current;\r\n    if (onHighlight) {\r\n      ref.current.onHighlight = onHighlight;\r\n    }\r\n    if (rendition) {\r\n      ref.current.offHighlight = (cfiRange: string) => rendition.annotations.remove(cfiRange, 'highlight');\r\n      ref.current.setLocation = (location: string) => rendition.display(location);\r\n    }\r\n  }, [ref, rendition, movePage, onHighlight]);\r\n\r\n\r\n\r\n  /** Ref checker */\r\n  useEffect(() => {\r\n    if (!ref) {\r\n      throw new Error(\"[React-Epub-Viewer] Put a ref argument that has a ViewerRef type.\");\r\n    }\r\n  }, [ref]);\r\n\r\n  /** Epub Init */\r\n  /* eslint-disable */\r\n  useEffect(() => {\r\n    if (!url) return;\r\n    initBook();\r\n  }, [url]);\r\n  /* eslint-enable */\r\n\r\n  /** \r\n   * Emit Viewer Event\r\n   * - Register move event\r\n   * - Register location changed event\r\n   * - Register selection event\r\n   */\r\n  /* eslint-disable */\r\n  useEffect(() => {\r\n    if (!rendition) return;\r\n\r\n    // Emit global control function\r\n    registerGlobalFunc();\r\n\r\n    document.addEventListener('keyup', handleKeyPress, false);\r\n    rendition.on(\"keyup\", handleKeyPress);\r\n    rendition.on(\"locationChanged\", onLocationChange);\r\n    selectionChanged && rendition.on('selected', selectionChanged);\r\n\r\n    return (() => {\r\n      document.removeEventListener('keyup', handleKeyPress, false);\r\n      rendition.off(\"keyup\", handleKeyPress);\r\n      rendition.off(\"locationChanged\", onLocationChange);\r\n      selectionChanged && rendition.off('selected', selectionChanged);\r\n    });\r\n  }, [\r\n    rendition,\r\n    registerGlobalFunc,\r\n    handleKeyPress\r\n  ]);\r\n  /* eslint-enable */\r\n\r\n  /** Display page by changed location */\r\n  useEffect(() => {\r\n    if (!location || !rendition) return;\r\n\r\n    rendition.display(location);\r\n  }, [location, rendition]);\r\n\r\n  \r\n  return (<>\r\n    {!isLoaded && loadingView}\r\n    <EpubViewerWrapper ref={ref} style={style} />\r\n  </>);\r\n}\r\n\r\nexport default React.forwardRef(EpubViewer)","import styled, { keyframes } from 'styled-components'\r\n\r\nconst LoadingView = () => {\r\n  return (\r\n    <LoadingWrapper>\r\n      <Wrapper>\r\n        <Content />\r\n      </Wrapper>\r\n    </LoadingWrapper>\r\n  );\r\n}\r\n\r\nconst spin = keyframes`\r\n\tfrom { transform: rotate(0deg); }\r\n\tto { transform: rotate(360deg); }\r\n`;\r\n\r\nconst LoadingWrapper = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`;\r\n\r\nconst Wrapper = styled.div`\r\n\tposition: relative;\r\n\twidth: 100%;\r\n\theight: 30px;\r\n\tmargin: 30px 0;\r\n\ttext-align: center;\r\n`;\r\n\r\nconst Content = styled.div`\r\n\tdisplay: inline-block;\r\n\twidth: 30px;\r\n\theight: 30px;\r\n\tborder: 3px solid #ebf1ff;\r\n\tborder-radius: 50%;\r\n\tborder-top-color: #3972ff;\r\n\tanimation: ${spin} 1s ease-in-out infinite;\r\n`;\r\n\r\nexport default LoadingView","import { EpubCFI } from 'epubjs'\r\n// types\r\nimport { BookStyle, BookFlow } from 'types/book'\r\n\r\n\r\n/**\r\n * DateTime to `yyyy-mm-dd`\r\n * @param {Date} time \r\n */\r\n export const timeFormatter = (time: Date): string => {\r\n\tconst yyyy = time.getFullYear();\r\n\tconst mm = time.getMonth() + 1;\r\n\tconst dd = time.getDate();\r\n\tconst msg = `${yyyy}-${mm}-${dd}`;\r\n\r\n\treturn msg;\r\n}\r\n\r\n\r\n/**\r\n * Comparison of two CFI sizes\r\n * - -1 : CFI 1 < CFI 2\r\n * - 0 : CFI 1 == CFI 2\r\n * - 1 : CFI 1 > CFI 2\r\n * @param cfi_1 CFI 1\r\n * @param cfi_2 CFI 2\r\n */\r\nexport const compareCfi = (cfi_1: string, cfi_2: string): number => {\r\n\tconst epubcfi = new EpubCFI();\r\n\treturn epubcfi.compare(cfi_1, cfi_2);\r\n};\r\n\r\n\r\n/**\r\n * Split CFI range into two starting CFI and ending CFI\r\n * - null : Invalid CFIRange\r\n * @param cfiRange CFIRange\r\n */\r\nexport const cfiRangeSpliter = (cfiRange: string) => {\r\n\tconst content = cfiRange.slice(8, -1);\r\n\tconst [origin, start, end] = content.split(',');\r\n\r\n\tif (!origin || !start || !end) return null;\r\n\r\n\tconst startCfi = `epubcfi(${origin + start})`;\r\n\tconst endCfi = `epubcfi(${origin + end})`;\r\n\treturn { startCfi, endCfi }\r\n}\r\n\r\n\r\n/**\r\n * Whether the two CFI ranges nested\r\n * - true : Nested\r\n * - false : Not nested\r\n * - null : Invalid CFIRange\r\n * @param cfiRange1 First CFIRange\r\n * @param cfiRange2 Second CFIRange\r\n */\r\nexport const clashCfiRange = (baseCfiRange: string, targetCfiRange: string) => {\r\n\tconst splitCfi1 = cfiRangeSpliter(baseCfiRange);\r\n\tconst splitCfi2 = cfiRangeSpliter(targetCfiRange);\r\n\r\n\tif (!splitCfi1 || !splitCfi2) return null;\r\n\r\n\tconst { startCfi: s1, endCfi: e1 } = splitCfi1;\r\n\tconst { startCfi: s2, endCfi: e2 } = splitCfi2;\r\n\r\n\tif ((compareCfi(s2, s1) <= 0 && compareCfi(s1, e2) <= 0)\r\n\t\t||(compareCfi(s2, e1) <= 0 && compareCfi(e1, e2) <= 0)\r\n\t\t||(compareCfi(s1, s2) <= 0 && compareCfi(e2, e1) <= 0)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n/**\r\n * Extract paragraph CFI from CFIRange\r\n * - null : Invalid CFIRange\r\n * @param cfiRange CFIRange\r\n */\r\nexport const getParagraphCfi = (cfiRange: string) => {\r\n\tif (!cfiRange) return;\r\n\r\n\tconst content = cfiRange.slice(8, -1);\r\n\tconst [origin, start, end] = content.split(',');\r\n\t\r\n\tif (!origin || !start || !end) return null;\r\n\r\n\tconst cfi = `epubcfi(${origin})`;\r\n\treturn cfi;\r\n}\r\n\r\n\r\n/**\r\n * Get specific DOM Element from CFI\r\n * - **※ Warning**: Other Iframe must not exist in the Reader page!\r\n * @param cfi CFI\r\n * @returns HTML Element or Null\r\n */\r\nexport const getNodefromCfi = (cfi: string): HTMLElement | null => {\r\n\tconst epubcfi = cfi.slice(8, -1);\r\n\r\n\t/* Remove Id */\r\n\tconst pureCfi = epubcfi.replace(/\\[.*?\\]/gi, '');\r\n\r\n\t/* Only CFI Base */\r\n\tconst splitCfi = pureCfi.split('!');\r\n\tif (splitCfi.length < 1 || splitCfi[1] === \"\") {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/* Remove Body tag CFI */\r\n\tconst cfiPath: number[] = splitCfi[1].split('/')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t .slice(2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t .map(x => Number(x));\r\n\r\n\tconst iframe = document.querySelector('iframe');\r\n\tif (!iframe) return null;\r\n\t\r\n\tconst iframeBody = iframe.contentWindow && iframe.contentWindow.document.body;\r\n\tif (!iframeBody) return null;\r\n\r\n\tlet component: HTMLElement | null = iframeBody;\r\n\r\n\t/* Find Node based on CFI */\r\n\tfor (let idx of cfiPath) {\r\n\t\tconst childNodes: any = component && component.childNodes;\r\n\r\n\t\t/* Bookmark / Highlight filtering.. */\r\n\t\tconst filtered = ([...childNodes].filter(n => !n.dataset \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| !n.dataset.bookmark\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| !n.dataset.highlight ));\r\n\t\tcomponent = filtered[idx - 1];\r\n\r\n\t\tif (!component) {\r\n\t\t\tcomponent = null;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn component;\r\n}\r\n\r\n\r\n/**\r\n * Selection absolute location\r\n * @param viewer viewerRef.current\r\n * @param bookStyle bookStyle\r\n * @param bookFlow book-flow\r\n * @param MIN_VIEWER_WIDTH min viewer width\r\n * @param MIN_VIEWER_HEIGHT min viewer height\r\n * @param VIEWER_HEADER_HEIGHT viewer header height\r\n * @param CONTEXTMENU_WIDTH contextmenu width\r\n * @returns Contextmenu location\r\n */\r\nexport const getSelectionPosition = (\r\n\tviewer: any,\r\n\tbookStyle: BookStyle,\r\n\tbookFlow: BookFlow,\r\n\tMIN_VIEWER_WIDTH: number,\r\n\tMIN_VIEWER_HEIGHT: number,\r\n\tVIEWER_HEADER_HEIGHT: number,\r\n\tCONTEXTMENU_WIDTH: number\r\n): { x: number, y: number, height: number, width: number } | null => {\r\n\tconst { \r\n\t\tinnerWidth: windowWidth,\r\n\t\tinnerHeight: windowHeight \r\n\t} = window;\r\n\r\n\tconst iframeWidth = viewer.offsetWidth;\r\n\r\n\tconst scrollTop = viewer.querySelector('div').scrollTop;\r\n\r\n\tconst iframe = viewer.querySelector('iframe');\r\n\tconst selection_ = iframe && iframe.contentWindow && iframe.contentWindow.getSelection();\r\n\tif (!selection_ || selection_.rangeCount === 0) return null;\r\n\r\n\tconst range = selection_.getRangeAt(0);\r\n\tconst {\r\n\t\tx: selectionX,\r\n\t\ty: selectionY,\r\n\t\theight: selectionHeight,\r\n\t\twidth: selectionWidth\r\n\t} = range.getBoundingClientRect();\r\n\r\n\tconst marginLeft = ~~((windowWidth - MIN_VIEWER_WIDTH) / 100 * bookStyle.marginHorizontal / 2);\r\n\tconst marginTop = bookFlow === \"scrolled-doc\"\r\n\t\t? 0\r\n\t\t: ~~((windowHeight - VIEWER_HEADER_HEIGHT - MIN_VIEWER_HEIGHT) / 100 * bookStyle.marginVertical / 2);\r\n\r\n\tconst x = ~~(selectionX % iframeWidth + marginLeft + ( selectionWidth / 2 - CONTEXTMENU_WIDTH / 2));\r\n\tconst y = ~~(selectionY + selectionHeight + VIEWER_HEADER_HEIGHT + marginTop - scrollTop);\r\n\r\n\treturn { \r\n\t\tx, \r\n\t\ty, \r\n\t\theight: selectionHeight, \r\n\t\twidth: selectionWidth \r\n\t};\r\n}","const viewerStyle = {\r\n\t\"::selection\": {\r\n\t\t\"background-color\": \"#d4e9ff\"\r\n\t},\r\n\t\r\n\t\"img\": {\r\n\t\t\"-webkit-touch-callout\": \"none\",\r\n\t\t\"-webkit-user-select\": \"none\",\r\n\t\t\"-khtml-user-select\": \"none\",\r\n\t\t\"-moz-user-select\": \"none\",\r\n\t\t\"-ms-user-select\": \"none\",\r\n\t\t\"user-select\": \"none\"\r\n\t}\r\n}\r\n\r\nexport default viewerStyle","import React, { useState, useEffect, useRef, useCallback, useMemo } from \"react\"\r\nimport { Book, Rendition, Contents } from \"epubjs\"\r\nimport { debounce } from \"throttle-debounce\"\r\n// modules\r\nimport EpubViewer from \"modules/epubViewer/EpubViewer\"\r\n// components\r\nimport LoadingView from 'LoadingView'\r\n// utils\r\nimport { timeFormatter } from 'lib/utils/commonUtil'\r\n// styles\r\nimport viewerDefaultStyles from 'modules/reactViewer/viewerStyle'\r\n// types\r\nimport { ReactViewerProps, ViewerRef } from 'types'\r\nimport BookType, { BookStyle, BookOption } from 'types/book'\r\n\r\n\r\n/**\r\n * Epub React Viewer Module\r\n * @class\r\n * @param props\r\n * @param props.url Epub file path\r\n * @param props.viewerLayout Viewer layout\r\n * @param props.viewerStyle Viewer style\r\n * @param props.viewerOption Viewer option\r\n * @param props.onBookInfoChange Run when book information changed\r\n * @param props.onPageChange Run when page changed\r\n * @param props.onTocChange Run when toc changed\r\n * @param props.onSelection Run when selected\r\n * @param props.loadingView Loading component\r\n * @param ref Viewer ref\r\n */\r\nconst ReactViewer = ({ \r\n  url,\r\n  viewerLayout,\r\n  viewerStyle,\r\n  viewerOption,\r\n  onBookInfoChange,\r\n  onPageChange,\r\n  onTocChange,\r\n  onSelection,\r\n  loadingView\r\n}: ReactViewerProps, ref: React.RefObject<ViewerRef> | any) => {\r\n  // TODO Fix the ref type correctly instead 'any' type.\r\n  const [book, setBook] = useState<Book | null>(null);\r\n\r\n  const [rendition, setRendition] = useState<Rendition | null>(null);\r\n\r\n  const [layoutStyle, setLayoutStyle] = useState<Object>({});\r\n\r\n  const [bookStyle, setBookStyle] = useState<BookStyle>({\r\n    fontFamily: 'Origin',\r\n    fontSize: 18,\r\n    lineHeight: 1.4,\r\n    marginHorizontal: 15,\r\n    marginVertical: 5\r\n  });\r\n  \r\n  const [bookOption, setBookOption] = useState<BookOption>({\r\n    flow: \"paginated\",\r\n    resizeOnOrientationChange: true,\r\n    spread: \"auto\"\r\n  });\r\n\r\n  const currentSelection = useRef<{cfiRange:string, contents:Contents | null}>({\r\n    cfiRange: '',\r\n    contents: null\r\n  });\r\n  \r\n\r\n\r\n  /**\r\n   * Run book changed\r\n   * @method\r\n   * @param book Epub Book\r\n   */\r\n  const bookChanged = (book: Book) => setBook(book);\r\n\r\n  /**\r\n   * Run rendition changed\r\n   * @method\r\n   * @param rendition Epub Rendition\r\n   */\r\n  const rendtionChanged = (rendition: Rendition) => setRendition(rendition);\r\n\r\n  /**\r\n   * Run selection changed [Debounce]\r\n   * @method\r\n   * @param cfiRange CFIRange\r\n   * @param contents Selection Epub Contents\r\n   */\r\n  const selectionChanged = (cfiRange: string, contents: Contents) => {\r\n    currentSelection.current = { cfiRange, contents };\r\n  }\r\n\r\n  /**\r\n   * Viewer resizing function\r\n   * @method\r\n   */\r\n  const onResize = useMemo(() => debounce(250, () => {\r\n    if (!rendition) return;\r\n\r\n    const viewerLayout_ = viewerLayout || {\r\n      MIN_VIEWER_WIDTH: 600,\r\n      MIN_VIEWER_HEIGHT: 300,\r\n      VIEWER_HEADER_HEIGHT: 0,\r\n      VIEWER_FOOTER_HEIGHT: 0,\r\n      VIEWER_SIDEMENU_WIDTH: 0\r\n    };\r\n    \r\n    const { innerWidth: win_w, innerHeight: win_h } = window;\r\n    const componentHeight = viewerLayout_.VIEWER_HEADER_HEIGHT + viewerLayout_.VIEWER_FOOTER_HEIGHT;\r\n    const w = win_w - ~~((win_w - viewerLayout_.MIN_VIEWER_WIDTH) / 100 * bookStyle.marginHorizontal);\r\n    const h = bookOption.flow === \"scrolled-doc\"\r\n      ? win_h - componentHeight\r\n      : win_h - componentHeight - ~~((win_h - componentHeight - viewerLayout_.MIN_VIEWER_HEIGHT) / 100 * bookStyle.marginVertical);\r\n    const marginTop = bookOption.flow === \"scrolled-doc\"\r\n      ? \"\"\r\n      : `${~~((win_h - componentHeight - viewerLayout_.MIN_VIEWER_HEIGHT) / 100 * bookStyle.marginVertical) / 2}px`;\r\n\r\n    setLayoutStyle(l => ({\r\n      ...l,\r\n      width: w,\r\n      height: h,\r\n      marginTop\r\n    }));\r\n    \r\n    try {\r\n      rendition.resize(w, h);\r\n    } catch { }\r\n  }), [\r\n    rendition,\r\n    viewerLayout,\r\n    bookStyle.marginHorizontal,\r\n    bookStyle.marginVertical,\r\n    bookOption.flow\r\n  ]);\r\n\r\n  /**\r\n   * Selection Event, run when run mouseup event\r\n   * @method <br/>\r\n   * - Fire after the Epubjs selected event. [about 300ms]\r\n   */\r\n  const onSelected = useCallback(async () => {\r\n    if (!ref.current) return;\r\n\r\n\t\tconst iframe = ref.current.querySelector('iframe');\r\n\t\tif (!iframe) return;\r\n    \r\n\t\tconst iframeWin = iframe.contentWindow;\r\n\t\tif (!iframeWin) return;\r\n    \r\n\t\tconst selection_ = iframeWin.getSelection();\r\n    if (!selection_) return;\r\n\t\t\r\n\t\tconst selectionText = selection_.toString();\r\n\t\tif (selectionText === \"\") return;\r\n    \r\n    const cfiRange: string = await new Promise(resolve => \r\n      setTimeout(() => resolve(currentSelection.current.cfiRange), 350)\r\n    );\r\n    if (!cfiRange) return;\r\n    \r\n    const contents = currentSelection.current.contents;\r\n    if (!contents) return;\r\n\r\n    onSelection && onSelection(cfiRange, contents);\r\n  }, [ref, onSelection]);\r\n  \r\n\r\n\r\n  /** Ref checker */\r\n  useEffect(() => {\r\n    if (!ref) {\r\n      throw new Error(\"[React-Epub-Viewer] Put a ref argument that has a ViewerRef type.\");\r\n    }\r\n  }, [ref]);\r\n\r\n\t/** Epub parsing */\r\n  // TODO Fix the infinite re-rendering issue, when inlcude `onBookInfoChange` to dependencies array.\r\n  /* eslint-disable */\r\n  useEffect(() => {\r\n    if (!book) return;\r\n\r\n    Promise.all([\r\n\t\t\tbook.loaded.metadata,\r\n\t\t\tbook.opened\r\n\t\t])\r\n\t\t.then(([metaData, bookData]: any[]) => {\r\n      const newBookData: BookType = {\r\n\t\t\t\tcoverURL: bookData.archive.urlCache[bookData.cover],\r\n\t\t\t\ttitle: metaData.title,\r\n\t\t\t\tdescription: metaData.description,\r\n\t\t\t\tpublished_date: timeFormatter(new Date(metaData.pubdate)),\r\n\t\t\t\tmodified_date: timeFormatter(new Date(metaData.modified_date)),\r\n\t\t\t\tauthor: metaData.creator,\r\n\t\t\t\tpublisher: metaData.publisher,\r\n\t\t\t\tlanguage: metaData.language\r\n\t\t\t}\r\n\r\n      onBookInfoChange && onBookInfoChange(newBookData);\r\n    })\r\n\t\t.catch(error => {\r\n      throw `${error.stack} \\n\\n Message : Epub parsing failed.`;\r\n\t\t});\r\n  }, [book]);\r\n  /* eslint-enable */\r\n\r\n  /** Set viewer Styles/Options */\r\n  useEffect(() => {\r\n    viewerStyle && setBookStyle(viewerStyle);\r\n    viewerOption && setBookOption(viewerOption);\r\n  }, [viewerStyle, viewerOption]);\r\n\r\n  /** Apply viewer Styles/Options */\r\n  useEffect(() => {\r\n    if (!rendition) return;\r\n\r\n    onResize();\r\n\r\n    const newStyle = {\r\n      \"body\": {\r\n        \"padding-top\": \"0px !important\",\r\n        \"padding-bottom\": \"0px !important\"\r\n      },\r\n      \"p\": {\r\n        \"font-size\": `${bookStyle.fontSize}px !important`,\r\n        \"line-height\": `${bookStyle.lineHeight} !important`\r\n      },\r\n    };\r\n    \r\n    rendition.flow(bookOption.flow);\r\n    rendition.spread(bookOption.spread);\r\n\r\n    if (bookStyle.fontFamily !== \"Origin\") {\r\n      Object.assign(newStyle.body, {\r\n        \"font-family\": `${bookStyle.fontFamily} !important`\r\n      });\r\n    }\r\n\r\n    if (bookOption.flow === \"scrolled-doc\") {   // Scroll type\r\n      Object.assign(newStyle.body, {\r\n        \"margin\": \"auto !important\"\r\n      });\r\n    } else if (bookOption.spread === \"auto\") {  // View 2 pages\r\n      Object.assign(newStyle.body, { });\r\n    } else {                                    // View 1 page\r\n      Object.assign(newStyle.body, { });\r\n    }\r\n  \r\n    rendition.themes.register(\"main\", viewerDefaultStyles);\r\n    rendition.themes.register(\"default\", newStyle);\r\n\r\n    rendition.themes.select(\"main\");\r\n  }, [\r\n    rendition, \r\n    bookStyle.fontFamily,\r\n    bookStyle.fontSize,\r\n    bookStyle.lineHeight,\r\n    bookOption,\r\n    onResize\r\n  ]);\r\n\r\n  /** Emit screen resizing event */\r\n  useEffect(() => {\r\n    window.addEventListener('resize', onResize);\r\n    return () => window.removeEventListener('resize', onResize);\r\n  }, [onResize]);\r\n\r\n  /** Emit selection event */\r\n  useEffect(() => {\r\n    if (!rendition) return;\r\n    rendition.on(\"mouseup\", onSelected);\r\n\t\treturn () => rendition.off(\"mouseup\", onSelected);\r\n  }, [rendition, onSelected]);\r\n\r\n  \r\n\r\n  return (<>\r\n    <EpubViewer \r\n      url={url} \r\n      style={layoutStyle}\r\n      bookChanged={bookChanged} \r\n      rendtionChanged={rendtionChanged} \r\n      tocChanged={onTocChange} \r\n      pageChanged={onPageChange}\r\n      selectionChanged={selectionChanged}\r\n      loadingView={loadingView || <LoadingView />}\r\n      ref={ref}\r\n    />\r\n  </>);\r\n}\r\n\r\nexport default React.forwardRef(ReactViewer)","/*\r\n :::: Color Varient ::::\r\n*/\r\nconst palette = {\r\n  white: '#ffffff',\r\n  black: '#000000',\r\n  /* gray */\r\n  gray0: '#fafafa',\r\n  gray1: '#e7e7e7',\r\n  gray2: '#c3c3c3',\r\n  gray3: '#9e9e9e',\r\n  gray4: '#868686',\r\n  gray5: '#656565',\r\n  gray6: '#505050',\r\n  gray7: '#3c3c3c',\r\n  gray8: '#282828',\r\n  /* red */\r\n  red0: '#ffe8e8',\r\n  red1: '#ffd0d1',\r\n  red2: '#ff8a8b',\r\n  red3: '#ff4445',\r\n  red4: '#ff1517',\r\n  red5: '#bf1011',\r\n  red6: '#990d0e',\r\n  red7: '#73090a',\r\n  red8: '#4d0607',\r\n  /* orange */\r\n  orange0: '#fff0ec',\r\n  orange1: '#ffe2d9',\r\n  orange2: '#ffb6a0',\r\n  orange3: '#ff8966',\r\n  orange4: '#ff6c40',\r\n  orange5: '#bf5130',\r\n  orange6: '#994126',\r\n  orange7: '#73311d',\r\n  orange8: '#4d2013',\r\n  /* yellow */\r\n  yellow0: '#fffce6',\r\n  yellow1: '#fffacc',\r\n  yellow2: '#fff280',\r\n  yellow3: '#feea33',\r\n  yellow4: '#fee500',\r\n  yellow5: '#bfac00',\r\n  yellow6: '#988900',\r\n  yellow7: '#726700',\r\n  yellow8: '#4c4500',\r\n  /* green */\r\n  green0: '#e6f7e6',\r\n  green1: '#cdefcc',\r\n  green2: '#83d880',\r\n  green3: '#39c133',\r\n  green4: '#07b100',\r\n  green5: '#058500',\r\n  green6: '#046a00',\r\n  green7: '#035000',\r\n  green8: '#023500',\r\n  /* blue */\r\n  blue0: '#ebf1ff',\r\n  blue1: '#d7e3ff ',\r\n  blue2: '#9cb9ff ',\r\n  blue3: '#618eff ',\r\n  blue4: '#3972ff ',\r\n  blue5: '#2b56bf ',\r\n  blue6: '#224499 ',\r\n  blue7: '#1a3373 ',\r\n  blue8: '#11224d ',\r\n  /* purple */\r\n  purple0: '#f2ebff',\r\n  purple1: '#d7e3ff',\r\n  purple2: '#be9cff',\r\n  purple3: '#9761ff',\r\n  purple4: '#7d39ff',\r\n  purple5: '#5e2bbf',\r\n  purple6: '#4b2299',\r\n  purple7: '#381a73',\r\n  purple8: '#26114d',\r\n};\r\n\r\nexport default palette","export const zIndexSet = (layer: number): string => `\r\n\t${layer}\r\n`;\r\n\r\nconst zIndex = {\r\n\theader: zIndexSet(5),\r\n\tmenu: zIndexSet(10),\r\n\tmodal: zIndexSet(100),\r\n\tsnackbar: zIndexSet(400),\r\n\ttooltip: zIndexSet(500)\r\n};\r\n\r\nexport default zIndex;","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Wrapper = styled.div`\r\n  position: sticky;\r\n  width: 100%;\r\n  height: auto;\r\n  left: 0;\r\n  top: 0;\r\n  background-color: ${palette.white};\r\n  z-index: ${zIndex.header};\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Layout = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  height: 54px;\r\n  background-color: ${palette.white};\r\n  z-index: ${zIndex.header};\r\n`;\r\n\r\nexport const AutoLayout = styled.div`\r\n  width: 100%;\r\n  flex-grow: 1;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  border-bottom: 2px solid ${palette.gray1};\r\n\r\n  & > div {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n  }\r\n  & > div:last-child {\r\n    margin-right: 8px;\r\n  }\r\n`;\r\n\r\nexport default Layout","export const noselect = (): string => `\r\n\t-webkit-touch-callout: none;\r\n\t-webkit-user-select: none;\r\n\t-khtml-user-select: none;\r\n\t-moz-user-select: none;\r\n\t-ms-user-select: none;\r\n\tuser-select: none;\r\n`;\r\n\r\nexport const transition = (): string =>`\r\n\tcubic-bezier(0.25, 0.1, 0.25, 1);\r\n`;\r\n\r\nexport const boxShadow = {\r\n\tlight: \"0px 4px 16px rgba(0, 0, 0, 0.04)\",\r\n\tregular: \"0px 8px 12px rgba(0, 0, 0, 0.2)\",\r\n\tbold: \"0 8px 10px 1px rgba(0,0,0,0.14), 0 3px 8px 2px rgba(0,0,0,0.12), 0 5px 5px -3px rgba(0,0,0,0.2)\"\r\n};\r\n\r\nexport const scrollbar = (width=8) => `\r\n\t&::-webkit-scrollbar {\r\n\t\twidth: ${width}px;\r\n\t\tbackground: transparent;\r\n\t}\r\n\t&::-webkit-scrollbar-thumb {\r\n\t\tbackground: #ddd;\r\n\t\tborder-radius: 10px;\r\n\t}\r\n\t&::-webkit-scrollbar-thumb:hover {\r\n\t\tbackground: #ccc;\r\n\t}\r\n\t&::-webkit-scrollbar-track {\r\n\t\tbackground: transparent;\r\n\t}\r\n`","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ControlBtn = ({ message, onClick }: Props) => {\r\n  return <Btn onClick={() => onClick()}>{message}</Btn>;\r\n}\r\n\r\nconst Btn = styled.button`\r\n  height: 100%;\r\n  padding: 0 16px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    color: ${palette.blue3};\r\n  }\r\n\r\n  &:first-child {\r\n    margin-left: 8px;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  message: string;\r\n  onClick: (value?: boolean) => void;\r\n}\r\n\r\nexport default ControlBtn","import * as React from \"react\";\r\n\r\nfunction SvgPrev(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 44 44\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".prev_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"prev_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"prev_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h44v44H0z\" opacity={0.3} />\r\n          <path className=\"prev_svg__cls-3\" d=\"M12 22L32 2M12 22l20 20\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgPrev;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgNext(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 44 44\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".next_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"next_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"next_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h44v44H0z\" opacity={0.3} />\r\n          <path className=\"next_svg__cls-3\" d=\"M32 22L12 2M32 22L12 42\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgNext;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgBookClose(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".bookClose_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"bookClose_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"bookClose_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            className=\"bookClose_svg__cls-3\"\r\n            d=\"M37.12 3H10.88a3 3 0 00-.43 0A1.71 1.71 0 009.1 4.11a1.87 1.87 0 00-.1.59v29.18c0 1 0 .94 1.88 1.88l18 9a1.8 1.8 0 002.6-1.2 3 3 0 000-.31v-7.58h5.62A1.88 1.88 0 0039 33.8V4.87A1.88 1.88 0 0037.12 3z\"\r\n          />\r\n          <path\r\n            className=\"bookClose_svg__cls-3\"\r\n            d=\"M31.5 35.67V14.84a2 2 0 00-1.1-1.78L10.45 3\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgBookClose;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgBookOpen(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".bookOpen_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"bookOpen_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"bookOpen_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            className=\"bookOpen_svg__cls-3\"\r\n            d=\"M4 6.5a27.24 27.24 0 0120 1v34a27.24 27.24 0 00-20-1zM24 7.5a27.24 27.24 0 0120-1v34a27.24 27.24 0 00-20 1\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgBookOpen;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgClose(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".close_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"close_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"close_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path className=\"close_svg__cls-3\" d=\"M4 4l40 40M4 44L44 4\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgClose;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgDown(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <g data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g data-name=\"\\uB808\\uC774\\uC5B4 1\">\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            d=\"M8.33 15.82l14.32 20.46a1.63 1.63 0 002.7 0l14.32-20.46A1.78 1.78 0 0038.32 13H9.68a1.78 1.78 0 00-1.35 2.82z\"\r\n            stroke=\"#000\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgDown;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgScrollHorizontal(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".scrollHorizontal_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"scrollHorizontal_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"scrollHorizontal_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle\r\n            className=\"scrollHorizontal_svg__cls-3\"\r\n            cx={24}\r\n            cy={24}\r\n            r={5}\r\n          />\r\n          <path\r\n            className=\"scrollHorizontal_svg__cls-3\"\r\n            d=\"M3 24l12-12M3 24l12 12M45 24L33 12M45 24L33 36\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgScrollHorizontal;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgScrollVertical(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".scrollVertical_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"scrollVertical_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"scrollVertical_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle className=\"scrollVertical_svg__cls-3\" cx={24} cy={24} r={5} />\r\n          <path\r\n            className=\"scrollVertical_svg__cls-3\"\r\n            d=\"M24 3l12 12M24 3L12 15M24 45l12-12M24 45L12 33\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgScrollVertical;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgSearch(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".search_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"search_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"search_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle className=\"search_svg__cls-3\" cx={17} cy={17} r={14} />\r\n          <path className=\"search_svg__cls-3\" d=\"M44 44L27 27\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgSearch;\r\n","import styled, { css } from 'styled-components'\r\n// icons\r\nimport { \r\n  ScrollHorizontalIcon,\r\n  ScrollVerticalIcon,\r\n  BookCloseIcon,\r\n  BookOpenIcon\r\n} from 'lib/svg'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ControlIconBtn = ({ type, alt, active, isSelected, onClick }: Props) => {\r\n  let HeaderIcon = null;\r\n  switch (type) {\r\n    case \"ScrollVertical\":\r\n      HeaderIcon = ScrollVerticalIcon;\r\n      break;\r\n    case \"ScrollHorizontal\":\r\n      HeaderIcon = ScrollHorizontalIcon;\r\n      break;\r\n    case \"BookOpen\":\r\n      HeaderIcon = BookOpenIcon;\r\n      break;\r\n    case \"BookClose\":\r\n      HeaderIcon = BookCloseIcon;\r\n      break;\r\n  }\r\n  \r\n  const onClickBtn = () => {\r\n    if (active) onClick();\r\n  }\r\n\r\n  return (\r\n    <Btn \r\n      onClick={onClickBtn} \r\n      isSelected={isSelected}\r\n      active={active}\r\n      title={alt}\r\n    >\r\n      <Icon>\r\n        <HeaderIcon />\r\n      </Icon>\r\n    </Btn>\r\n  );\r\n}\r\n\r\nconst Btn = styled.button<{ isSelected: boolean, active: boolean }>`\r\n  position: relative;\r\n  height: 100%;\r\n  padding: 0 12px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 0;\r\n  transition: .3s ${styles.transition};\r\n  opacity: ${({active}) => active\r\n    ? '1'\r\n    : '.3'\r\n  };\r\n  cursor: ${({active}) => active\r\n    ? 'pointer'\r\n    : 'default'\r\n  };\r\n  outline: none;\r\n\r\n  &::before {\r\n    content: '';\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    top: 0;\r\n    bottom: 0;\r\n    margin: auto;\r\n    z-index: -1;\r\n    border-radius: 30px;\r\n    width: ${({isSelected}) => isSelected\r\n      ? '32px'\r\n      : '8px'\r\n    };\r\n    height: ${({isSelected}) => isSelected\r\n      ? '32px'\r\n      : '8px'\r\n    };\r\n    opacity: ${({active, isSelected}) => active && isSelected\r\n      ? '.7'\r\n      : '0'\r\n    };\r\n    transition: .1s ${styles.transition};\r\n    background-color: ${palette.blue1};\r\n  }\r\n\r\n  &:focus, &:hover {\r\n    ${({active}) => active\r\n      ? css`\r\n        &:before {\r\n          width: 32px;\r\n          height: 32px;\r\n          opacity: 1;\r\n        }\r\n      `\r\n      : \"\"\r\n    };\r\n    \r\n  }\r\n`;\r\n\r\nconst Icon = styled.div`\r\n  width: 16px;\r\n  height: 16px;\r\n\r\n  & > div, & > svg {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n`;\r\n\r\ntype HeaderIcon = \r\n  \"ScrollHorizontal\" |\r\n  \"ScrollVertical\" |\r\n  \"BookOpen\" |\r\n  \"BookClose\";\r\n\r\ninterface Props {\r\n  type: HeaderIcon;\r\n  alt: string;\r\n  active: boolean;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default ControlIconBtn","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst VerticalLine = ({ height=16 }: Props) => {\r\n  return <Bar height={height} />\r\n}\r\n\r\nconst Bar = styled.div<{height: number}>`\r\n  width: 1px;\r\n  height: ${({height}) => height+'px'};\r\n  margin: 0 8px;\r\n  background-color: ${palette.gray2};\r\n`;\r\n\r\ninterface Props {\r\n  height?: number\r\n}\r\n\r\nexport default VerticalLine","import { useState } from 'react'\r\n// components\r\nimport Wrapper from 'components/header/Wrapper'\r\nimport Layout, { AutoLayout } from 'components/header/Layout'\r\nimport ControlBtn from 'components/header/ControlBtn'\r\nimport ControlIconBtn from 'components/header/ControlIconBtn'\r\nimport VerticalLine from 'components/header/VerticalLine'\r\n// types\r\nimport { BookOption } from 'types/book'\r\n\r\n\r\nconst Header = ({ \r\n  title, \r\n  bookOption, \r\n  onNavToggle, \r\n  onOptionToggle, \r\n  onLearningToggle,\r\n  onBookOptionChange\r\n}: Props) => {\r\n  const [isScrollHorizontal, setIsScrollHorizontal] = useState<boolean>(true);\r\n  const [viewType, setViewType] = useState<ViewType>({\r\n    active: true,\r\n    spread: true\r\n  });\r\n\r\n\r\n  /** \r\n   * Select view direction\r\n   * @param type Direction\r\n   */\r\n  const onClickDirection = (type: \"Horizontal\" | \"Vertical\") => {\r\n    if (type === \"Horizontal\") {\r\n      setIsScrollHorizontal(true);\r\n      setViewType({ ...viewType, active: true });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        flow: \"paginated\"\r\n      });\r\n    } else {\r\n      setIsScrollHorizontal(false);\r\n      setViewType({ ...viewType, active: false });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        flow: \"scrolled-doc\"\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select isSpread\r\n   * @param isSpread Whether spread view \r\n   */\r\n  const onClickViewType = (isSpread: boolean) => {\r\n    if (isSpread) {\r\n      setViewType({ ...viewType, spread: true });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        spread: \"auto\"\r\n      });\r\n    } else {\r\n      setViewType({ ...viewType, spread: false });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        spread: \"none\"\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Layout>\r\n        <AutoLayout>\r\n          <div>\r\n            <ControlBtn message=\"Contents\" onClick={onNavToggle} />\r\n            <ControlBtn message=\"Setting\" onClick={onOptionToggle} />\r\n            <ControlBtn message=\"Highlights\" onClick={onLearningToggle} />\r\n          </div>\r\n\r\n          <div>\r\n            <ControlIconBtn type=\"ScrollHorizontal\"\r\n                            alt=\"Horizontal View\"\r\n                            active={true}\r\n                            isSelected={isScrollHorizontal}\r\n                            onClick={() => onClickDirection(\"Horizontal\")} />\r\n            <ControlIconBtn type=\"ScrollVertical\" \r\n                            alt=\"Vertical View\"\r\n                            active={true}\r\n                            isSelected={!isScrollHorizontal}\r\n                            onClick={() => onClickDirection(\"Vertical\")} />\r\n\r\n            <VerticalLine />\r\n\r\n            <ControlIconBtn type=\"BookOpen\" \r\n                            alt=\"Two Page View\"\r\n                            active={viewType.active}\r\n                            isSelected={viewType.spread}\r\n                            onClick={() => onClickViewType(true)} />\r\n            <ControlIconBtn type=\"BookClose\" \r\n                            alt=\"One Page View\"\r\n                            active={viewType.active}\r\n                            isSelected={!viewType.spread}\r\n                            onClick={() => onClickViewType(false)} />\r\n          </div>\r\n        </AutoLayout>\r\n      </Layout>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  title: string;\r\n  bookOption: BookOption;\r\n  onNavToggle: (value?: boolean) => void;\r\n  onOptionToggle: (value?: boolean) => void;\r\n  onLearningToggle: (value?: boolean) => void;\r\n  onBookOptionChange: (bookOption: BookOption) => void;\r\n}\r\n\r\ntype ViewType = {\r\n  active: boolean,\r\n  spread: boolean\r\n}\r\n\r\nexport default Header","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Wrapper = styled.div`\r\n  position: fixed;\r\n  left: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  height: 60px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: ${palette.white};\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Item = ({ text }: Props) => {\r\n  return (\r\n    <Container>\r\n      <span>{text}</span>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.div`\r\n  height: 100%;\r\n  flex-basis: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  & > span {\r\n    color: ${palette.gray4};\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n}\r\n\r\nexport default Item;","import styled from 'styled-components'\r\n// icons\r\nimport { PrevIcon, NextIcon } from 'lib/svg'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst MoveBtn = ({ type, onClick }: Props) => {\r\n  const Icon = type === \"PREV\"\r\n    ? PrevIcon\r\n    : NextIcon;\r\n  \r\n  const msg = type === \"PREV\"\r\n    ? \"이전 페이지\"\r\n    : \"다음 페이지\";\r\n\r\n  return (\r\n    <Container onClick={onClick} title={msg}>\r\n      <Content>\r\n        <Icon />\r\n      </Content>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.button`\r\n  min-width: 60px;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n  }\r\n`;\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n\r\n  & > svg {\r\n    width: 18px;\r\n    height: 18px;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  type: \"PREV\" | \"NEXT\"\r\n  onClick: () => void;\r\n}\r\n\r\nexport default MoveBtn;","// components\r\nimport Wrapper from 'components/footer/Wrapper'\r\nimport Item from 'components/footer/Item'\r\nimport MoveBtn from 'components/footer/MoveBtn'\r\n\r\n\r\nconst Footer = ({ title, nowPage, totalPage, onPageMove }: Props) => {\r\n  return (\r\n    <Wrapper>\r\n      <MoveBtn type=\"PREV\" onClick={() => onPageMove(\"PREV\")} />\r\n      <Item text={title} />\r\n      <Item text={`${nowPage} / ${totalPage}`} />\r\n      <MoveBtn type=\"NEXT\" onClick={() => onPageMove(\"NEXT\")} />\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  title: string;\r\n  nowPage: number;\r\n  totalPage: number;\r\n  onPageMove: (type: \"PREV\" | \"NEXT\") => void;\r\n}\r\n\r\nexport default Footer","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n// icons\r\nimport { CloseIcon } from 'lib/svg'\r\n\r\nconst CloseBtn = ({ onClick }: Props) => {\r\n  return (\r\n    <Btn onClick={onClick}>\r\n      <Icon />\r\n    </Btn>\r\n  );\r\n}\r\n\r\nconst Btn = styled.button`\r\n  position: relative;\r\n  height: 100%;\r\n  padding: 0 24px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n  }\r\n`;\r\n\r\nconst Icon = styled(CloseIcon)`\r\n  width: 18px;\r\n  height: 18px;\r\n`;\r\n\r\ninterface Props {\r\n  onClick: () => void;\r\n}\r\n\r\nexport default CloseBtn;","import React from 'react'\r\nimport styled from 'styled-components'\r\n// components\r\nimport CloseBtn from 'components/sideMenu/CloseBtn'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport zIndex from 'lib/styles/zIndex'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Wrapper = ({ title, show, onClose, children }: Props, ref: any) => {\r\n  return (\r\n    <Container show={show} ref={ref}>\r\n      <Header>\r\n        <span>{title}</span>\r\n        <CloseBtn onClick={onClose} />\r\n      </Header>\r\n      {children}\r\n    </Container>\r\n  )\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: fixed;\r\n  width: 340px;\r\n  height: 100vh;\r\n  top: 0;\r\n  right: 0;\r\n  z-index: ${zIndex.menu};\r\n  box-shadow: -4px 0 8px 0 rgba(0,0,0,.16);\r\n  background-color: ${palette.white};\r\n  border-radius: 16px 0 0 16px;\r\n  transform: ${({ show }: { show: boolean }) => show \r\n    ? `translateX(0px) scale(1)`\r\n    : `translateX(420px) scale(.8)`\r\n  };\r\n  transition: .3s ${styles.transition};\r\n  overflow-y: auto;\r\n  ${styles.scrollbar()};\r\n`;\r\n\r\nconst Header = styled.div`\r\n  width: 100%;\r\n  height: 64px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding-top: 30px;\r\n\r\n  & > span {\r\n    padding-left: 24px;\r\n    font-size: 21px;\r\n    font-weight: 600;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  title: string;\r\n  show: boolean;\r\n  onClose: () => void;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nexport default React.forwardRef(Wrapper)","import styled from 'styled-components'\r\n\r\nconst BookInfo = ({src=\"\", title ,publisher, author}: Props) => {\r\n  return (\r\n    <Container>\r\n      <BookImg src={src} alt={title} />\r\n      <BookContent>\r\n        <Title>{title}</Title>\r\n        <Info>{publisher}</Info>\r\n        <Info>{author}</Info>\r\n      </BookContent>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  padding: 24px;\r\n`;\r\n\r\nconst BookImg = styled.img`\r\n  margin-right: 12px;\r\n  width: 44%;\r\n  min-width: 120px;\r\n  border-radius: 4px;\r\n  background: #eee;\r\n`;\r\n\r\nconst BookContent = styled.div`\r\n  flex-grow: 1;\r\n`;\r\n\r\nconst Title = styled.div`\r\n  font-weight: 500;\r\n  margin-bottom: 4px;\r\n`;\r\n\r\nconst Info = styled.div`\r\n  font-size: 14px;\r\n  margin-bottom: 4px;\r\n`;\r\n\r\ninterface Props {\r\n  src: string;\r\n  title: string;\r\n  publisher: string;\r\n  author: string;\r\n}\r\n\r\nexport default BookInfo","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst NavItem = ({ message, onClick }: Props) => {\r\n  return (\r\n    <Content onClick={onClick}>\r\n      <span>{message}</span>\r\n    </Content>\r\n  );\r\n}\r\n\r\nconst Content = styled.button`\r\n  width: 100%;\r\n  height: 48px;\r\n  box-sizing: border-box;\r\n  padding: 12px 24px;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  background-color: ${palette.gray0};\r\n  outline: none;\r\n  \r\n  & > span {\r\n    transition: .2s ${styles.transition};\r\n    font-size: 14px;\r\n  }\r\n\r\n  &:focus, &:hover {\r\n    & > span {\r\n      color: ${palette.blue3};\r\n      margin-left: 12px;\r\n    }\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  message: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default NavItem","import React from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport BookInfo from 'components/nav/BookInfo'\r\nimport NavItem from 'components/nav/NavItem'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport Book from 'types/book'\r\nimport Toc from 'types/toc'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\n\r\nconst Nav = ({ control, onToggle, onLocation }: Props, ref: any) => {\r\n  const book = useSelector<RootState, Book>(state => state.book.book);\r\n  const bookToc = useSelector<RootState, Toc[]>(state => state.book.toc);\r\n  \r\n  /** Click nav item */\r\n  const onClickItem = (loc: string) => {\r\n    onLocation(loc);\r\n    onToggle();\r\n  }\r\n\r\n  const Tocs = bookToc.map((t, idx) => \r\n    <NavItem key={idx}\r\n             message={t.label}\r\n             onClick={() => onClickItem(t.href)} />\r\n  );\r\n  \r\n  \r\n  return (<>\r\n    {control.display && <Wrapper title=\"Contents\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref}>\r\n      <BookInfo \r\n        src={book.coverURL}\r\n        title={book.title}\r\n        publisher={book.publisher}\r\n        author={book.author} \r\n      />\r\n      {Tocs}\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  onToggle: () => void;\r\n  onLocation: (loc: string) => void;\r\n}\r\n\r\nexport default React.forwardRef(Nav)","import styled from 'styled-components'\r\n\r\nconst Wrapper = styled.div`\r\n  box-sizing: border-box;\r\n  padding: 24px;\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n\r\nconst OptionWrapper = styled.div`\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nexport default OptionWrapper","import styled from 'styled-components'\r\n\r\nconst OptionTitle = styled.div`\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  margin-bottom: 16px;\r\n`;\r\n\r\nexport default OptionTitle","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n// icons\r\nimport { DownIcon } from 'lib/svg'\r\n\r\nconst DropdownValue = ({ value, isDropdown, onClick }: Props) => {\r\n  return (\r\n    <Container \r\n      onClick={onClick}\r\n      isDropdown={isDropdown}\r\n      title=\"Select font\"\r\n    >\r\n      <Content>{value}</Content>\r\n      <Icon isDropdown={isDropdown}>\r\n        <DownIcon />\r\n      </Icon>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.button<{isDropdown: boolean}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  position: relative;\r\n  width: 100%;\r\n  height: 40px;\r\n  background-color: ${palette.white};\r\n  border: ${({isDropdown}) => isDropdown\r\n    ? `2px solid ${palette.blue3}`\r\n    : `2px solid ${palette.gray1}`\r\n  };\r\n  border-radius: ${({isDropdown}) => isDropdown\r\n    ? \"20px 20px 0 0\"\r\n    : \"20px\"\r\n  };\r\n  box-sizing: border-box;\r\n  padding: 0px 16px;\r\n  cursor: pointer;\r\n  z-index: 4;\r\n  transition: .1s ${styles.transition};\r\n  text-align: left;\r\n  outline: none;\r\n\r\n  &:hover, &:focus {\r\n    border: 2px solid ${palette.blue3};\r\n\r\n    & > div {\r\n      opacity: 1;\r\n      filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n    }\r\n  }\r\n`;\r\n\r\nconst Content = styled.span`\r\n  flex-grow: 1;\r\n  margin-right: 16px;\r\n  font-size: 14px;\r\n`;\r\n\r\nconst Icon = styled.div<{isDropdown: boolean}>`\r\n  display: flex;\r\n  width: 12px;\r\n  height: 12px;\r\n  opacity: .3;\r\n  \r\n  & > svg {\r\n    transform-origin: center;\r\n    transform: ${({isDropdown}) => isDropdown\r\n      ? 'rotate(180deg)'\r\n      : 'rotate(0deg)'\r\n    };\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  value: string;\r\n  isDropdown: boolean;\r\n  onClick: (e: any) => void;\r\n}\r\n\r\nexport default DropdownValue","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst DropdownItemWrapper = ({ show, children }: Props) => {\r\n  return <Container show={show}>{children}</Container>\r\n}\r\n\r\nconst Container = styled.div<{show: boolean}>`\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  max-height: 200px;\r\n  overflow-y: auto;\r\n  box-sizing: border-box;\r\n  padding: 0 0 16px 0;\r\n  background-color: ${palette.white};\r\n  border: 2px solid ${palette.blue3};\r\n  z-index: 3;\r\n  border-radius: ${({show}) => show\r\n    ? '0 0 20px 20px'\r\n    : '20px'\r\n  };\r\n  transition: .4s ${styles.transition};\r\n  opacity: ${({show}) => show\r\n    ? '1'\r\n    : '0'\r\n  };\r\n  transform-origin: top;\r\n  transform: ${({show}) => show\r\n    ? 'translateY(-2px) scaleY(1);'\r\n    : 'translateY(-40px) scaleY(0);'\r\n  };\r\n  ${styles.scrollbar(6)}\r\n  ${({show}) => show\r\n    ? ''\r\n    : styles.noselect\r\n  };\r\n`;\r\n\r\ninterface Props {\r\n  show: boolean;\r\n  children: React.ReactElement[];\r\n}\r\n\r\nexport default DropdownItemWrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst DropdownItem = ({ value, onClick }: Props) => {\r\nconst text = value === \"Origin\" ? \"Original\" : value;\r\n\r\n  return <Container onClick={onClick}>{text}</Container>;\r\n}\r\n\r\nconst Container = styled.button`\r\n  width: 100%;\r\n  height: 40px;\r\n  box-sizing: border-box;\r\n  padding: 0 16px;\r\n  transition: .1s ${styles.transition};\r\n  font-size: 14px;\r\n  line-height: 40px;\r\n  cursor: pointer;\r\n  text-align: left;\r\n  outline: none;\r\n  \r\n  &:focus, &:hover {\r\n    background-color: rgba(0,0,0,.05);\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  value: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default DropdownItem","import { useState, useEffect, useRef, useCallback } from 'react'\r\nimport styled from 'styled-components'\r\n// components\r\nimport OptionWrapper from 'components/option/OptionWrapper'\r\nimport OptionTitle from 'components/option/OptionTitle'\r\nimport DropdownValue from 'components/option/DropdownValue'\r\nimport DropdownItemWrapper from 'components/option/DropdownItemWrapper'\r\nimport DropdownItem from 'components/option/DropdownItem'\r\n// types\r\nimport { BookFontFamily } from 'types/book'\r\n\r\nconst Dropdown = ({\r\n  title,\r\n  defaultValue,\r\n  valueList,\r\n  onSelect\r\n}: Props) => {\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n  const [visible, setVisible] = useState<boolean>(false);\r\n  const value = defaultValue === \"Origin\" ? \"Original\" : defaultValue;\r\n  \r\n  /** Toggle dropdown */\r\n  const onToggle = useCallback(() => setVisible(!visible), [visible]);\r\n\r\n  /** Close dropdown */\r\n  const onClose = useCallback((e: any) => {\r\n    if (!ref || !ref.current) return;\r\n    if (![...e.path].includes(ref.current)) {\r\n      onToggle();\r\n    }\r\n  }, [ref, onToggle]);\r\n\r\n  const Items = valueList.map(font => \r\n    <DropdownItem key={font} value={font} onClick={() => {\r\n      onSelect(font);\r\n      onToggle();\r\n    }} />\r\n  );\r\n\r\n  /** Register dropdown close event */\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('click', onClose);\r\n    } else {\r\n      document.removeEventListener('click', onClose);\r\n    }\r\n    return () => {\r\n      document.removeEventListener('click', onClose);\r\n    }\r\n  }, [visible, onClose]);\r\n\r\n  return (\r\n    <OptionWrapper>\r\n      <OptionTitle>{title}</OptionTitle>\r\n\r\n      <DropdownWrapper ref={ref}>\r\n        <DropdownValue value={value} \r\n                       isDropdown={visible} \r\n                       onClick={onToggle} />\r\n        <DropdownItemWrapper show={visible}>\r\n          {Items}\r\n        </DropdownItemWrapper>\r\n      </DropdownWrapper>\r\n    </OptionWrapper>\r\n  );\r\n}\r\n\r\nconst DropdownWrapper = styled.div`\r\n  position: relative;\r\n`;\r\n\r\ninterface Props {\r\n  title: string;\r\n  defaultValue: BookFontFamily;\r\n  valueList: BookFontFamily[];\r\n  onSelect: (font: BookFontFamily) => void;\r\n}\r\n\r\nexport default Dropdown","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst OptionValue = styled.span<{ active: boolean }>`\r\n  display: inline-block;\r\n  font-size: 14px;\r\n  color: ${props => props.active\r\n    ? palette.blue3\r\n    : palette.gray4\r\n  };\r\n  margin-right: 8px;\r\n  width: 40px;\r\n  text-align: right;\r\n  line-height: 20px;\r\n`;\r\n\r\nexport default OptionValue","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst SliderValue = ({ \r\n  active, \r\n  minValue, \r\n  maxValue, \r\n  defaultValue, \r\n  step, \r\n  onChange \r\n}: Props) => {\r\n  const percentage = Math.round((defaultValue - minValue) / (maxValue - minValue) * 100);\r\n\r\n  return (<>\r\n    <Icon>-</Icon>\r\n    <SliderWrapper>\r\n      <SliderBackground />\r\n      <SliderBar \r\n        active={active}\r\n        percentage={percentage}\r\n      />\r\n      <Slider\r\n        type=\"range\" \r\n        min={minValue}\r\n        max={maxValue}\r\n        defaultValue={defaultValue}\r\n        step={step}\r\n        onChange={onChange}\r\n        active={active}\r\n        disabled={!active} />\r\n    </SliderWrapper>\r\n    <Icon>+</Icon>\r\n  </>);\r\n}\r\n\r\nconst SliderWrapper = styled.div`\r\n  flex-grow: 1;\r\n  display: flex;\r\n  position: relative;\r\n  width: auto;\r\n`;\r\n\r\nconst SliderBackground = styled.div`\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 6px;\r\n  background-color: #eee;\r\n  border-radius: 6px;\r\n  z-index: 0;\r\n`;\r\n\r\nconst SliderBar = styled.div<{ percentage: number, active: boolean }>`\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 0;\r\n  transform: translateY(-50%);\r\n  width: ${({ percentage }) => percentage + '%'};\r\n  height: 6px;\r\n  border-radius: 6px 0 0 6px;\r\n  background-color: ${props => props.active\r\n    ? palette.blue4\r\n    : palette.gray2\r\n  };\r\n\tz-index: 1;\r\n`;\r\n\r\nconst Slider = styled.input<{ active: boolean }>`\r\n  appearance: none;\r\n  width: 100%;\r\n  height: 6px;\r\n  background-color: transparent;\r\n  border-radius: 6px;\r\n  margin: 0;\r\n  z-index: 2;\r\n  outline: none;\r\n  \r\n  &::-webkit-slider-thumb {\r\n    appearance: none;\r\n    width: 18px;\r\n    height: 18px;\r\n    border-radius: 18px;\r\n    box-shadow: ${styles.boxShadow.regular};\r\n    background-color: white;\r\n    transition: .2s ${styles.transition};\r\n    transition-property: box-shadow, background-color;\r\n    border: ${props => props.active\r\n      ? `2px solid ${palette.blue3}`\r\n      : `2px solid ${palette.gray4}`\r\n    };\r\n    cursor: ${props => props.active\r\n        ? 'pointer'\r\n        : ''\r\n      };;\r\n\r\n    &:hover {\r\n      background-color: ${props => props.active\r\n        ? palette.blue1\r\n        : ''\r\n      };\r\n    }\r\n\r\n    &:active {\r\n      box-shadow: none;\r\n      background-color: ${props => props.active\r\n        ? palette.blue3\r\n        : ''\r\n      };\r\n    }\r\n  }\r\n\r\n  &:focus::-webkit-slider-thumb {\r\n    box-shadow: none;\r\n    background-color: ${palette.blue3};\r\n  }\r\n`;\r\n\r\nconst Icon = styled.span`\r\n  font-size: 12px;\r\n  font-weight: 500;\r\n  color: ${palette.gray4};\r\n  margin: 0 8px;\r\n  line-height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  minValue: number;\r\n  maxValue: number;\r\n  defaultValue: number;\r\n  step: number;\r\n  onChange: (e: any) => void;\r\n}\r\n\r\nexport default SliderValue","import styled from 'styled-components'\r\n// components\r\nimport OptionWrapper from 'components/option/OptionWrapper'\r\nimport OptionTitle from 'components/option/OptionTitle'\r\nimport OptionValue from 'components/option/OptionValue'\r\nimport SliderValue from 'components/option/SliderValue'\r\n\r\nconst Slider = ({\r\n  active,\r\n  title,\r\n  minValue,\r\n  maxValue,\r\n  defaultValue,\r\n  step,\r\n  onChange\r\n}: Props) => {\r\n  const onChangeValue = (e: any) => {\r\n    if (!active) return;\r\n    onChange(e);\r\n  }\r\n  \r\n  \r\n  return (\r\n    <OptionWrapper>\r\n      <OptionTitle>{title}</OptionTitle>\r\n      \r\n      <SliderWrapper>\r\n        <OptionValue active={active}>{defaultValue}</OptionValue>\r\n        <SliderValue active={active}\r\n                     minValue={minValue}\r\n                     maxValue={maxValue}\r\n                     defaultValue={defaultValue}\r\n                     step={step}\r\n                     onChange={onChangeValue} />\r\n      </SliderWrapper>\r\n    </OptionWrapper>\r\n  );\r\n}\r\n\r\nconst SliderWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  title: string;\r\n  minValue: number;\r\n  maxValue: number;\r\n  defaultValue: number;\r\n  step: number;\r\n  onChange: (e: any) => void;\r\n}\r\n\r\nexport default Slider","import React from 'react'\r\nimport { useState, useEffect } from 'react'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport OptionLayout from 'components/option/Layout'\r\nimport OptionDropdown from 'components/option/Dropdown'\r\nimport OptionSlider from 'components/option/Slider'\r\n// types\r\nimport { BookStyle, BookFontFamily, BookFlow } from 'types/book'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\n\r\nconst Option = ({ \r\n  control, \r\n  bookStyle,\r\n  bookFlow,\r\n  onToggle, \r\n  emitEvent,\r\n  onBookStyleChange\r\n}: Props, ref: any) => {\r\n  const [fontFamily, setFontFamily] = useState<BookFontFamily>(bookStyle.fontFamily);\r\n  const [fontSize, setFontSize] = useState<number>(bookStyle.fontSize);\r\n  const [lineHeight, setLineHeight] = useState<number>(bookStyle.lineHeight);\r\n  const [marginHorizontal, setMarginHorizontal] = useState<number>(bookStyle.marginHorizontal);\r\n  const [marginVertical, setMarginVertical] = useState<number>(bookStyle.marginVertical);\r\n\r\n\r\n  /** Change font family */\r\n  const onSelectFontFamily = (font: BookFontFamily) => setFontFamily(font);\r\n\r\n  /** Change font style and layout */\r\n  const onChangeSlider = (type: SliderType, e: any) => {\r\n    if (!e || !e.target) return;\r\n    switch (type) {\r\n      case \"FontSize\":\r\n        setFontSize(e.target.value);\r\n        break;\r\n      case \"LineHeight\":\r\n        setLineHeight(e.target.value);\r\n        break;\r\n      case \"MarginHorizontal\":\r\n        setMarginHorizontal(e.target.value);\r\n        break;\r\n      case \"MarginVertical\":\r\n        setMarginVertical(e.target.value);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  /* Save userdata */\r\n  // TODO Fix the infinite re-rendering issue, when inlcude `onBookStyleChange` to dependencies array.\r\n  /* eslint-disable */\r\n  useEffect(() => {\r\n    const timer = window.setTimeout(() => { \r\n      onBookStyleChange({\r\n        fontFamily,\r\n        fontSize,\r\n        lineHeight,\r\n        marginHorizontal,\r\n        marginVertical\r\n      });\r\n    }, 250);\r\n\r\n    return () => window.clearTimeout(timer);\r\n  }, [\r\n    fontFamily, \r\n    fontSize, \r\n    lineHeight, \r\n    marginHorizontal, \r\n    marginVertical\r\n  ]);\r\n  /* eslint-enable */\r\n\r\n  /** Re-register close event, when after set */\r\n  useEffect(() => emitEvent(), [bookStyle, emitEvent]);\r\n\r\n  \r\n  return (<>\r\n    {control.display && <Wrapper title=\"Setting\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref}>\r\n      <OptionLayout>\r\n        <OptionDropdown title=\"Font\"\r\n                        defaultValue={fontFamily}\r\n                        valueList={[\"Origin\", \"Roboto\"]}\r\n                        onSelect={onSelectFontFamily} />\r\n        <OptionSlider active={true}\r\n                      title=\"Size\"\r\n                      minValue={8}\r\n                      maxValue={36}\r\n                      defaultValue={fontSize}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"FontSize\", e)} />\r\n        <OptionSlider active={true}\r\n                      title=\"Line height\"\r\n                      minValue={1}\r\n                      maxValue={3}\r\n                      defaultValue={lineHeight}\r\n                      step={0.1}\r\n                      onChange={(e) => onChangeSlider(\"LineHeight\", e)} />\r\n        <OptionSlider active={true}\r\n                      title=\"Horizontal margin\"\r\n                      minValue={0}\r\n                      maxValue={100}\r\n                      defaultValue={marginHorizontal}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"MarginHorizontal\", e)} />\r\n        <OptionSlider active={bookFlow === \"paginated\"}\r\n                      title=\"Vertical margin\"\r\n                      minValue={0}\r\n                      maxValue={100}\r\n                      defaultValue={marginVertical}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"MarginVertical\", e)} />\r\n      </OptionLayout>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  bookStyle: BookStyle;\r\n  bookFlow: BookFlow;\r\n  onToggle: () => void;\r\n  emitEvent: () => void;\r\n  onBookStyleChange: (bookStyle: BookStyle) => void;\r\n}\r\n\r\ntype SliderType = \"FontSize\" \r\n  | \"LineHeight\" \r\n  | \"MarginHorizontal\" \r\n  | \"MarginVertical\";\r\n\r\nexport default React.forwardRef(Option)","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst Wrapper = styled.button`\r\n  padding: 16px 24px;\r\n  display: flex;\r\n  align-items: flex-start;\r\n  justify-content: flex-start;\r\n  background-color: ${palette.gray0};\r\n  transition: .1s ${styles.transition};\r\n  cursor: pointer;\r\n  outline: none;\r\n  text-align: left;\r\n  border-bottom: 1px solid ${palette.gray1};\r\n  \r\n  &:nth-child(2) {\r\n    border-top: 1px solid ${palette.gray1};\r\n  }\r\n\r\n  & > div {\r\n    color: inherit;\r\n    flex-grow: 1;\r\n  }\r\n\r\n  &:hover > *, &:focus > * {\r\n    color: ${palette.blue3};\r\n  }\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n\r\nconst Title = styled.div`\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  color: inherit;\r\n`;\r\n\r\nexport default Title","import styled from 'styled-components'\r\n\r\nconst Post = styled.div<{ color: string }>`\r\n  position: relative;\r\n  font-size: 14px;\r\n  margin-top: 16px;\r\n  padding: 8px;\r\n  box-sizing: border-box;\r\n\r\n  &::before {\r\n    content: '';\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n    background-color: ${({ color }) => color};\r\n    opacity: .3;\r\n    border-radius: 8px;\r\n    mix-blend-mode: multiply;\r\n  }\r\n`;\r\n\r\nexport default Post","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst PageNum = ({ num }: Props) => {\r\n  return <Content>{num}p</Content>\r\n}\r\n\r\nconst Content = styled.span`\r\n  min-width: 32px;\r\n  margin-right: 16px;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: ${palette.gray4};\r\n`;\r\n\r\ninterface Props {\r\n  num: number;\r\n}\r\n\r\nexport default PageNum","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n// types\r\nimport Book from 'types/book'\r\nimport Page from 'types/page'\r\nimport Toc from 'types/toc'\r\nimport Highlight, { Color } from 'types/highlight'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\n\r\n/* \r\n\tInitial State\r\n*/\r\n\r\n/** 초기 Book 상태 */\r\nconst initialBook: Book = {\r\n\tcoverURL: '',\r\n\ttitle: '',\r\n\tdescription: '',\r\n\tpublished_date: '',\r\n\tmodified_date: '',\r\n\tauthor: '',\r\n\tpublisher: '',\r\n\tlanguage: ''\r\n}\r\n\r\n/** 초기 CurrentPage 상태 */\r\nconst initialCurrentLocation: Page = {\r\n\tchapterName: \"-\",\r\n\tcurrentPage: 0,\r\n\ttotalPage: 0,\r\n\tstartCfi: '',\r\n\tendCfi: '',\r\n\tbase: ''\r\n}\r\n\r\n/** 초기 색상표 상태 */\r\nconst initialColorList: Color[] = [\r\n\t{ name: 'Red', code: palette.red4 },\r\n\t{ name: 'Orange', code: palette.orange4 },\r\n\t{ name: 'Yellow', code: palette.yellow4 },\r\n\t{ name: 'Green', code: palette.green4 },\r\n\t{ name: 'Blue', code: palette.blue4 },\r\n\t{ name: 'Purple', code: palette.purple4 }\r\n]\r\n\r\nconst initialState: BookState = {\r\n\tbook: initialBook,\r\n\tcurrentLocation: initialCurrentLocation,\r\n\ttoc: [],\r\n\thighlights: [],\r\n\tcolorList: initialColorList,\r\n}\r\n\r\n\r\n/* \r\n\tSlice\r\n*/\r\nconst bookSlice = createSlice({\r\n\tname: 'book',\r\n\tinitialState,\r\n\treducers: {\r\n\t\t/** Book 갱신 @dispatch */\r\n\t\tupdateBook(state, action: PayloadAction<Book>) {\r\n\t\t\tstate.book = action.payload;\r\n\t\t},\r\n\t\t/** CurrentPage 갱신 @dispatch */\r\n\t\tupdateCurrentPage(state, action: PayloadAction<Page>) {\r\n\t\t\tstate.currentLocation = action.payload;\r\n\t\t},\r\n\t\t/** Book 초기화 @dispatch */\r\n\t\tclearBook(state) {\r\n\t\t\tstate.book = initialBook;\r\n\t\t},\r\n\t\t/** 목차 갱신 @dispatch */\r\n\t\tupdateToc(state, action: PayloadAction<Toc[]>) {\r\n\t\t\tstate.toc = action.payload;\r\n\t\t},\r\n\t\t/** 목차 초기화 @dispatch */\r\n\t\tclearToc(state) {\r\n\t\t\tstate.toc = [];\r\n\t\t},\r\n\t\t/** 하이라이트 추가 */\r\n\t\tpushHighlight(state, action: PayloadAction<Highlight>) {\r\n\t\t\tconst check = state.highlights.filter(h => h.key === action.payload.key);\r\n\t\t\tif (check.length > 0) return;\r\n\t\t\tstate.highlights.push(action.payload);\r\n\t\t},\r\n\t\t/** 하이라이트 갱신 */\r\n\t\tupdateHighlight(state, action: PayloadAction<Highlight>) {\r\n\t\t\tconst new_idx = action.payload.key;\r\n\t\t\tconst old_idx = state.highlights.map(h => h.key).indexOf(new_idx);\r\n\t\t\tstate.highlights.splice(old_idx, 1, action.payload);\r\n\t\t},\r\n\t\t/** 하이라이트 삭제 */\r\n\t\tpopHighlight(state, action: PayloadAction<string>) {\r\n\t\t\tconst idx = state.highlights.map(h => h.key).indexOf(action.payload);\r\n\t\t\tstate.highlights.splice(idx, 1);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nexport interface BookState {\r\n\tbook: Book;\r\n\tcurrentLocation: Page;\r\n\ttoc: Toc[];\r\n\thighlights: Highlight[];\r\n\tcolorList: Color[];\r\n}\r\n\r\nexport const { \r\n\tupdateBook,\r\n\tclearBook,\r\n\tupdateCurrentPage,\r\n\tupdateToc,\r\n\tclearToc,\r\n\tpushHighlight,\r\n\tupdateHighlight,\r\n\tpopHighlight\r\n } = bookSlice.actions;\r\n \r\nexport default bookSlice.reducer","import { useDispatch } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/learning/highlight/Wrapper'\r\nimport Title from 'components/learning/highlight/Title'\r\nimport Post from 'components/learning/highlight/Post'\r\nimport PageNum from 'components/learning/highlight/PageNum'\r\n// slices\r\nimport { updateHighlight } from 'slices/book'\r\n// utils\r\nimport { cfiRangeSpliter } from 'lib/utils/commonUtil'\r\n// types\r\nimport HighlightType from 'types/highlight'\r\n\r\nconst Highlight = ({ \r\n  highlight, \r\n  onClick, \r\n  emitEvent, \r\n  viewerRef\r\n}: Props) => {\r\n  const dispatch = useDispatch();\r\n\r\n\r\n  /** 하이라이트 클릭 */\r\n  const onClickHighlight = () => {\r\n    if (!viewerRef.current) return;\r\n    \r\n    const now = new Date().toISOString();\r\n    dispatch(updateHighlight({\r\n      ...highlight,\r\n      accessTime: now\r\n    }));\r\n\r\n    const splitCfi = cfiRangeSpliter(highlight.cfiRange);\r\n    if (!splitCfi) return;\r\n\r\n    const { startCfi } = splitCfi;\r\n\r\n    viewerRef.current.setLocation(startCfi);\r\n\r\n    emitEvent();\r\n\r\n    const svgContainer = viewerRef.current.querySelector(\"svg\");\r\n    if (!svgContainer) return;\r\n\r\n    const targetSvg = svgContainer.querySelector(`g[data-epubcfi=\"${highlight.cfiRange}\"]`);\r\n    if (!targetSvg) return;\r\n\r\n    onClick(targetSvg.childNodes[0]);\r\n  }\r\n  \r\n  return (\r\n    <Wrapper onClick={onClickHighlight}>\r\n      <PageNum num={highlight.pageNum} />\r\n\r\n      <div>\r\n        <Title>{highlight.chpaterName}</Title>\r\n\r\n        <Post color={highlight.color}>{highlight.content}</Post>\r\n      </div>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  highlight: HighlightType;\r\n  onClick: (highlightNode: any) => void;\r\n  emitEvent: () => void;\r\n  viewerRef: any;\r\n}\r\n\r\nexport default Highlight","import styled from 'styled-components'\r\n\r\nconst Layout = styled.div`\r\n  flex-grow: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-sizing: border-box;\r\n  padding: 24px 0;\r\n`;\r\n\r\nexport default Layout","import styled from 'styled-components'\r\n\r\nconst SortedBtnWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-end;\r\n  padding: 0 24px 24px 24px;\r\n`;\r\n\r\nexport default SortedBtnWrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst SortedBtn = ({ text, isSelected, onClick }: Props) => {  \r\n  return <Btn isSelected={isSelected} onClick={onClick}>{text}</Btn>;\r\n}\r\n\r\nconst Btn = styled.button<{isSelected: boolean}>`\r\n  height: 20px;\r\n  line-height: 20px;\r\n  font-size: 14px;\r\n  cursor: pointer;\r\n  text-align: center;\r\n  margin-left: 16px;\r\n  color: ${({isSelected}) => isSelected \r\n    ? palette.blue3\r\n    : palette.gray4\r\n  };\r\n  transition: .2s ${styles.transition};\r\n  \r\n  &:hover {\r\n    color: ${palette.blue3};\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default SortedBtn","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst MenuEmpty = ({ text }: Props) => {\r\n  return <Content>{text}</Content>;\r\n}\r\n\r\nconst Content = styled.div`\r\n  flex-grow: 1;\r\n  height: auto;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: ${palette.blue2};\r\n  font-size: 14px;\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n}\r\n\r\nexport default MenuEmpty","import React, { useState, useEffect } from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// containers\r\nimport Highlight from 'containers/menu/commons/Highlight'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport LearningLayout from 'components/learning/Layout'\r\nimport SortedBtnWrapper from 'components/learning/SortedBtnWrapper'\r\nimport SortedBtn from 'components/learning/SortedBtn'\r\nimport MenuEmpty from 'components/sideMenu/MenuEmpty'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport HighlightType from 'types/highlight'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\n\r\n\r\nconst Note = ({ \r\n  control, \r\n  onToggle, \r\n  onClickHighlight, \r\n  emitEvent,\r\n  viewerRef \r\n}: Props, ref: any) => {\r\n  const highlights = useSelector<RootState, HighlightType[]>(state => state.book.highlights);\r\n  \r\n  const [sorted, setSorted] = useState<Sorted>(\"CART\");\r\n  const [highlightList, setHighlightList] = useState<any[]>([]);\r\n  \r\n  /** \r\n   * Select sort type\r\n   * @param type Viewed or Created\r\n   */\r\n  const onSortedClick = (type: Sorted) => setSorted(type);\r\n\r\n\r\n  /** Set highlight contents */\r\n  useEffect(() => {\r\n    const sortedKey = sorted === \"LOOK\" \r\n      ? \"accessTime\" \r\n      : \"createTime\";\r\n\r\n    const highlightList = highlights.slice().sort(function (a, b) {\r\n      return new Date(b[sortedKey]).getTime() - new Date(a[sortedKey]).getTime();\r\n    });\r\n    const Items = highlightList.map(h => <Highlight key={h.key} \r\n                                                    highlight={h}\r\n                                                    onClick={onClickHighlight} \r\n                                                    emitEvent={emitEvent}\r\n                                                    viewerRef={viewerRef} />\r\n    );\r\n    setHighlightList(Items); \r\n  }, [\r\n    viewerRef,\r\n    sorted, \r\n    highlights,\r\n    onClickHighlight,\r\n    emitEvent,\r\n    setHighlightList\r\n  ]);\r\n\r\n\r\n  return (<>\r\n    {control.display && <Wrapper title=\"Highlight\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref} >\r\n      <LearningLayout>\r\n        <SortedBtnWrapper>\r\n          <SortedBtn \r\n            text=\"viewed\" \r\n            isSelected={sorted === \"LOOK\"} \r\n            onClick={() => onSortedClick(\"LOOK\")}\r\n          />\r\n          <SortedBtn \r\n            text=\"created\" \r\n            isSelected={sorted === \"CART\"} \r\n            onClick={() => onSortedClick(\"CART\")}\r\n          />\r\n        </SortedBtnWrapper>\r\n\r\n        {highlightList.length > 0\r\n          ? highlightList\r\n          : <MenuEmpty text=\"Empty highlights!\" />\r\n        }\r\n      </LearningLayout>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ntype Sorted = \"LOOK\" | \"CART\"\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  onToggle: () => void;\r\n  onClickHighlight: (highlightNode: any) => void;\r\n  emitEvent: () => void;\r\n  viewerRef: any;\r\n}\r\n\r\nexport default React.forwardRef(Note)","import ViewerLayout from 'types/viewerLayout'\r\n\r\n/** Epub viewer layout size */\r\nconst viewerLayout: ViewerLayout = {\r\n  MIN_VIEWER_WIDTH: 600,  \r\n  MIN_VIEWER_HEIGHT: 300,\r\n  VIEWER_HEADER_HEIGHT: 54,\r\n  VIEWER_FOOTER_HEIGHT: 60,\r\n\tVIEWER_SIDEMENU_WIDTH: 0\r\n}\r\n\r\nexport const contextmenuWidth = 160;\r\n\r\nexport default viewerLayout","import styled, { css } from 'styled-components'\r\n// lib\r\nimport { contextmenuWidth } from 'lib/styles/viewerLayout'\r\nimport * as styles from 'lib/styles/styles'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Wrapper = styled.div<Props>`\r\n  position: absolute;\r\n  left: ${({ x }) => window.innerWidth < x + contextmenuWidth\r\n    ? `${window.innerWidth - contextmenuWidth}px`\r\n    : `${x}px`\r\n  };\r\n  top: ${({ y }) => window.innerHeight < y + 40\r\n    ? `${window.innerHeight - 40}px`\r\n    : `${y}px`\r\n  };\r\n  width: ${({ width }) => width + 'px'};\r\n  height: ${({ height }) => height + 'px'};\r\n  box-sizing: border-box;\r\n  padding: ${({ width }) => width > 0\r\n    ? `4px`\r\n    : ``\r\n  };\r\n  border-radius: 8px;\r\n  background-color: rgba(0,0,0,.8);\r\n  box-shadow: ${styles.boxShadow.regular};\r\n  z-index: ${zIndex.menu};\r\n\r\n  & > div:first-child {\r\n    height: 100%;\r\n    overflow-y: auto;\r\n    ${styles.scrollbar(0)};\r\n  }\r\n\r\n  &::before {\r\n    display: ${({ width }) => width > 0\r\n      ? `black`\r\n      : `none`\r\n    };\r\n    content: \"\";\r\n    position: absolute;\r\n    left: 80px;\r\n    ${({ isReverse }) => isReverse\r\n      ? css`bottom: -16px;`\r\n      : css`top: -16px;`\r\n    }\r\n    transform: translateX(-8px);\r\n    border: 8px solid rgba(0,0,0,0);\r\n    ${({ isReverse }) => isReverse\r\n      ? css`border-top: 8px solid rgba(0,0,0,.8);`\r\n      : css`border-bottom: 8px solid rgba(0,0,0,.8);`\r\n    }\r\n    z-index: 1;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  isReverse: boolean;\r\n}\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ColorItem = ({ name, color, onClick }: Props) => {\r\n  const onClickItem = (e: any) => {\r\n    onClick();\r\n    e.target.blur();\r\n  };\r\n\r\n  return (\r\n    <Wrapper onClick={onClickItem}>\r\n      <ColorWrapper>\r\n        <Color color={color} />\r\n      </ColorWrapper>\r\n      <Message>{name}</Message>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\nconst Wrapper = styled.button`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  height: 32px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  background-color: rgba(0,0,0,0);\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:hover, &:focus {\r\n    background-color: ${palette.blue3};\r\n\r\n    & > span {\r\n      color: #fff;\r\n    }\r\n  }\r\n`;\r\n\r\nconst ColorWrapper = styled.div`\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 16px;\r\n  background-color: #fff;\r\n  margin-right: 16px;\r\n`;\r\n\r\nconst Color = styled.div<{ color: string }>`\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 16px;\r\n  background-color: ${({ color }) => color};\r\n  opacity: .4;\r\n`;\r\n\r\nconst Message = styled.span`\r\n  width: 48px;\r\n  font-size: 14px;\r\n  color: #ddd;\r\n  line-height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  name: string;\r\n  color: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default ColorItem","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Item = ({ text, onClick }: Props) => {\r\n  return <Container onClick={onClick}>{text}</Container>;\r\n}\r\n\r\nconst Container = styled.button`\r\n  width: 100%;\r\n  height: 32px;\r\n  line-height: 32px;\r\n  text-align: center;\r\n  font-size: 14px;\r\n  color: #ccc;\r\n  transition: .1s ${styles.transition};\r\n  background-color: rgba(0,0,0,0);\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    color: #fff;\r\n    background-color: ${palette.red3};\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n  onClick: (e?: any) => void;\r\n}\r\n\r\nexport default Item","import { useState, useEffect, useCallback, useRef } from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/contextMenu/Wrapper'\r\nimport ColorItem from 'components/contextMenu/ColorItem'\r\nimport Item from 'components/contextMenu/Item'\r\n// utils\r\nimport { getParagraphCfi } from 'lib/utils/commonUtil'\r\n// slices\r\nimport { contextmenuWidth } from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport Highlight, { Color } from 'types/highlight'\r\nimport Selection from 'types/selection'\r\n\r\n\r\nconst ContextMenu = ({ \r\n  active,\r\n  viewerRef, \r\n  selection, \r\n  onAddHighlight,\r\n  onRemoveHighlight,\r\n  onUpdateHighlight, \r\n  onContextmMenuRemove\r\n}: Props) => {\r\n  const highlights = useSelector<RootState, Highlight[]>(state => state.book.highlights);\r\n  const colorList = useSelector<RootState, Color[]>(state => state.book.colorList);\r\n\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [highlight, setHighlight] = useState<Highlight | null>(null);\r\n  \r\n  const [display, setDisplay] = useState<boolean>(false);\r\n  const [isEraseBtn, setIsEraseBtn] = useState<boolean>(false);\r\n  const [isReverse, setIsReverse] = useState<boolean>(false);\r\n  \r\n  const [height, setHeight] = useState<number>(0);\r\n  const [y, setY] = useState<number>(selection.y);\r\n\r\n  const ColorList = colorList.map(\r\n    color => <ColorItem key={color.code}\r\n                        name={color.name}\r\n                        color={color.code}\r\n                        onClick={selection.update\r\n                          ? () => onUpdateHighlight(highlight, color.code)\r\n                          : () => onAddHighlight(color.code)\r\n                        } />\r\n  );\r\n\r\n  \r\n  /** Remove highlight */\r\n  const onRemoveHighlight_ = useCallback(() => {\r\n    if (!highlight) return;\r\n\r\n    onRemoveHighlight(highlight.key, highlight.cfiRange);\r\n    onContextmMenuRemove();\r\n    \r\n    setIsEraseBtn(false);\r\n  }, [highlight, onRemoveHighlight, onContextmMenuRemove]);\r\n\r\n  /** \r\n   * Remove contextmenu\r\n   * @param e Mouse Event\r\n   * @param e.path\r\n   */\r\n  const onRemove = useCallback(({ path }: any) => {\r\n    if (!menuRef.current) return;\r\n\r\n    if ([...path].includes(menuRef.current)) return;\r\n    onContextmMenuRemove();\r\n  }, [menuRef, onContextmMenuRemove]);\r\n  \r\n  /** \r\n   * Arrow event\r\n   * @param e Keyboard Event\r\n   * @param e.key\r\n   */\r\n  const onKeyPress = useCallback(({ key }: any) => {\r\n    key && key === \"ArrowLeft\" && onContextmMenuRemove();\r\n    key && key === \"ArrowRight\" && onContextmMenuRemove();\r\n  }, [onContextmMenuRemove]);\r\n\r\n\r\n  /** Check whether the menu button is visible */\r\n  useEffect(() => {\r\n    if (!active) setIsEraseBtn(false);\r\n\r\n    const paragraphCfi = getParagraphCfi(selection.cfiRange);\r\n    if (!paragraphCfi) return;\r\n\r\n    const filtered = highlights.filter(highlight => highlight.key === paragraphCfi + selection.cfiRange);\r\n\r\n    if (!filtered.length) return;\r\n    const highlight_ = filtered[0];\r\n    setHighlight(highlight_);\r\n\r\n    if (selection.update) {\r\n      setIsEraseBtn(true);\r\n    } else {\r\n      setIsEraseBtn(false);\r\n    }\r\n  }, [\r\n    active,\r\n    highlights, \r\n    selection.cfiRange,\r\n    selection.update\r\n  ]);\r\n\r\n  /** Register contextmenu events */\r\n  useEffect(() => {\r\n    if (!viewerRef.current) return;\r\n    \r\n    const iframe = document.querySelector('iframe');\r\n    const node = iframe && iframe.contentWindow && iframe.contentWindow.document;\r\n    const scrolledTarget = viewerRef.current.querySelector('div');\r\n\r\n    if (active) {\r\n      setDisplay(true);\r\n      scrolledTarget && scrolledTarget.addEventListener('scroll', onContextmMenuRemove);\r\n      node && node.addEventListener('mousedown', onRemove);\r\n      node && node.addEventListener('keyup', onKeyPress);\r\n      document.addEventListener('mousedown', onRemove);\r\n      document.addEventListener('keyup', onKeyPress);\r\n    } else {\r\n      setDisplay(false);\r\n      scrolledTarget && scrolledTarget.removeEventListener('scroll', onContextmMenuRemove);\r\n      node && node.removeEventListener('mousedown', onRemove);\r\n      node && node.removeEventListener('keyup', onKeyPress);\r\n      document.removeEventListener('mousedown', onRemove);\r\n      document.removeEventListener('keyup', onKeyPress);\r\n    };\r\n\r\n    return () => {\r\n      node && node.removeEventListener('mousedown', onContextmMenuRemove);\r\n      node && node.removeEventListener('keyup', onKeyPress);\r\n      document.removeEventListener('keyup', onKeyPress);\r\n    }\r\n  }, [\r\n    viewerRef, \r\n    active,\r\n    onRemove,\r\n    onContextmMenuRemove, \r\n    onKeyPress\r\n  ]);\r\n\r\n  /** Set modified contextmenu height & whether menu is reverse */\r\n  useEffect(() => {\r\n    const menuPadding = 8;\r\n    const itemHeight = 32;\r\n    let itemCnt = ColorList.length;\r\n    \r\n    if (isEraseBtn) itemCnt += 1;\r\n    \r\n    const defaultHeight = itemCnt * itemHeight + menuPadding;\r\n    let y_ = selection.y;\r\n    const { innerHeight } = window;\r\n    \r\n    if (selection.y + defaultHeight > innerHeight) {\r\n      y_ = selection.y - selection.height - (defaultHeight);\r\n      if (y_ < 0) {\r\n        setHeight(defaultHeight + y_ - 8);\r\n        y_ = 8;\r\n      } else {\r\n        setHeight(defaultHeight);\r\n      }\r\n      setIsReverse(true);\r\n    } else {\r\n      setHeight(defaultHeight);\r\n      setIsReverse(false);\r\n    }\r\n\r\n    setY(y_);\r\n  }, [\r\n    selection.y, \r\n    selection.height, \r\n    ColorList, \r\n    isEraseBtn, \r\n    setHeight\r\n  ]);\r\n\r\n\r\n  return (<>\r\n    {display && <Wrapper x={selection.x} \r\n                         y={y} \r\n                         width={contextmenuWidth}\r\n                         height={height}\r\n                         isReverse={isReverse}\r\n                         ref={menuRef}>\r\n      <div>\r\n        {ColorList}\r\n        {isEraseBtn && <Item text=\"Remove\" onClick={onRemoveHighlight_} />}\r\n      </div>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  viewerRef: any;\r\n  selection: Selection;\r\n  onAddHighlight: (color: string) => void;\r\n  onRemoveHighlight: (key: string, cfiRange: string) => void;\r\n  onUpdateHighlight: (highlight: Highlight | null, color: string) => void;\r\n  onContextmMenuRemove: () => void;\r\n}\r\n\r\nexport default ContextMenu","export const mediaQuery = (maxWidth: number): string => `\r\n\t@media (max-width: ${maxWidth}px)\r\n`;\r\n\r\nexport const mediaValue = {\r\n\txlarge: 1600,\r\n\tlarge: 1440,\r\n\tmedium: 1200,\r\n\tsmall: 702,\r\n\txsmall: 350\t\r\n};\r\n\r\ntype Media = {\r\n\txlarge : string,\r\n\tlarge : string,\r\n\tmedium : string,\r\n\tsmall : string,\r\n\txsmall : string,\r\n\tcustom : (maxWidth: number) => string\r\n}\r\n\r\nconst media: Media = {\r\n\txlarge : mediaQuery(mediaValue.xlarge),\r\n\tlarge : mediaQuery(mediaValue.large),\r\n\tmedium : mediaQuery(mediaValue.medium),\r\n\tsmall : mediaQuery(mediaValue.small),\r\n\txsmall : mediaQuery(mediaValue.xsmall),\r\n\tcustom : mediaQuery,\r\n};\r\n\r\nexport default media;","import { keyframes } from 'styled-components';\r\n\r\nconst fadeIn = keyframes`\r\n\t0% { opacity: 0; }\r\n\t100% { opacity: 1;}\r\n`;\r\nconst fadeOut = keyframes`\r\n\t0% { opacity: 1; }\r\n\t100% { opacity: 0; }\r\n`;\r\nconst fadeInTop = keyframes`\r\n\t0% { opacity: 0; transform: translateY(-40px); }\r\n\t100% { opacity: 1; transform: translateY(0); }\r\n`;\r\nconst fadeOutTop = keyframes`\r\n\t0% { opacity: 1; transform: translateY(0); }\r\n\t100% { opacity: 0; transform: translateY(-40px); }\r\n`;\r\nconst fadeInBottom = keyframes`\r\n\t0% { opacity: 0; transform: translateY(40px); }\r\n\t100% { opacity: 1; transform: translateY(0); }\r\n`;\r\nconst fadeOutBottom = keyframes`\r\n\t0% { opacity: 1; transform: translateY(0); }\r\n\t100% { opacity: 0; transform: translateY(40px); }\r\n`;\r\nconst fadeInLeft = keyframes`\r\n\t0% { opacity: 0; transform: translateX(-40px); }\r\n\t100% { opacity: 1; transform: translateX(0); }\r\n`;\r\nconst fadeOutLeft = keyframes`\r\n\t0% { opacity: 1; transform: translateX(0); }\r\n\t100% { opacity: 0; transform: translateX(-40px); }\r\n`;\r\nconst fadeInRight = keyframes`\r\n\t0% { opacity: 0; transform: translateX(40px); }\r\n\t100% { opacity: 1; transform: translateX(0); }\r\n`;\r\nconst fadeOutRight = keyframes`\r\n\t0% { opacity: 1; transform: translateX(0); }\r\n\t100% { opacity: 0; transform: translateX(40px); }\r\n`;\r\nconst spin = keyframes`\r\n\tfrom { transform: rotate(0deg); }\r\n\tto { transform: rotate(360deg); }\r\n`;\r\n\r\nconst animations = {\r\n\tfadeIn,\r\n\tfadeOut,\r\n\tfadeInTop,\r\n\tfadeOutTop,\r\n\tfadeInBottom,\r\n\tfadeOutBottom,\r\n\tfadeInLeft,\r\n\tfadeOutLeft,\r\n\tfadeInRight,\r\n\tfadeOutRight,\r\n\tspin\r\n};\r\n\r\nexport default animations","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport media from 'lib/styles/media'\r\nimport palette from 'lib/styles/palette'\r\nimport animations from 'lib/styles/animations'\r\n// types\r\nimport SnackbarType from 'types/snackbar'\r\n\r\nconst Snackbar = ({ onClick, text, type }: Props)=> {\r\n\treturn (\r\n\t  <Container onClick={onClick} type={type}>\r\n\t  \t<Content>\r\n\t  \t  <Message>{text}</Message>\r\n\t  \t</Content>\r\n\t  </Container>\r\n\t);\r\n}\r\n\r\nconst Container = styled.div<{ type: SnackbarType }>`\r\n\tposition: relative;\r\n\twidth: 320px;\r\n\theight: auto;\r\n\tmax-height: 800px;\r\n\tbackground-color: ${({ type }) => {\r\n\t\t\tif (type === 'SUCCESS') {\t\r\n\t\t\t\treturn palette.green4;\r\n\t\t\t} else if (type === 'WARNING') {\r\n\t\t\t\treturn palette.orange4;\r\n\t\t\t} else if (type === 'ERROR') {\r\n\t\t\t\treturn palette.red3;\r\n\t\t\t} else if (type === 'INFO') {\r\n\t\t\t\treturn palette.blue4;\r\n\t\t\t} else {\r\n\t\t\t\treturn palette.gray4;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tbox-shadow: ${styles.boxShadow.regular};\r\n\tborder-radius: 4px;\r\n\tanimation: ${animations.fadeInBottom} .3s cubic-bezier(0.25,0.1,0.25,1),\r\n\t\t\t\t\t\t ${animations.fadeOutBottom} .5s cubic-bezier(0.25,0.1,0.25,1) 3.6s;\r\n\tcursor: pointer;\r\n\ttransition: .2s ${styles.transition};\r\n\t${styles.noselect};\r\n\r\n\t&:active {\r\n\t\ttransform: scale(.97, .97);\r\n\t}\r\n\r\n\t${media.small} {\r\n\t\tborder-radius: 0px;\r\n\t\twidth: 100%;\r\n\t\tmin-height: 1.8rem;\r\n\t}\r\n`;\r\n\r\nconst Content = styled.div`\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\twidth: 100%;\r\n\theight: auto;\r\n\tmin-height: 2rem;\r\n\tbox-sizing: border-box;\r\n\tpadding: 12px 20px;\r\n\r\n\t${media.small} {\r\n\t\tmin-height: 1.6rem;\r\n\t\tline-height: 1.6rem;\r\n\t}\r\n`;\r\n\r\nconst Message = styled.div`\r\n\tposition: relative;\r\n\tflex-grow: 1;\r\n\tcolor: white;\r\n\tfont-size: 14px;\r\n\twhite-space: pre-wrap;\r\n\tword-break: keep-all;\r\n\tvertical-align: top;\r\n`;\r\n\r\n\r\ninterface Props {\r\n\tonClick(e: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\r\n\ttext: string;\r\n\ttype: SnackbarType;\r\n}\r\n\r\nexport default Snackbar","import { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\r\n// types\r\nimport Snackbar from 'types/snackbar'\r\n\r\n\r\nconst RefEvent: number[] = [];\r\n\r\n\r\n/* \r\n\tThunks\r\n*/\r\nexport const newSnackbar = createAsyncThunk(\r\n\t'snackbar/newSnackbar',\r\n\tasync (\r\n\t\t{ text, type }: SnackbarState, \r\n\t\t{ dispatch }\r\n\t) => {\r\n\t\tif(RefEvent.length !== 0) {\r\n\t\t\tlet event = RefEvent.shift();\r\n\t\t\tclearTimeout(event);\r\n\t\t}\r\n\t\tdispatch(SnackbarSlice.actions.deleteSnackbar());\r\n\t\tawait setTimeout(function() {\r\n\t\t\tdispatch(SnackbarSlice.actions.appendSnackbar({ text, type: type ? type: \"INFO\" }));\r\n\t\t\tlet event = window.setTimeout(function() {\r\n\t\t\t\tdispatch(SnackbarSlice.actions.deleteSnackbar());\r\n\t\t\t}, 4000);\r\n\t\t\tRefEvent.push(event);\r\n\t\t}, 50);\r\n\t}\r\n);\r\n\r\n/* \r\n\tInitial State\r\n*/\r\n\r\nconst initialState: SnackbarState = {\r\n\ttext: \"\",\r\n\ttype: \"INFO\"\r\n}\r\n\r\n\r\n/* \r\n\tSlice\r\n*/\r\nconst SnackbarSlice = createSlice({\r\n\tname: 'snackbar',\r\n\tinitialState,\r\n\treducers: {\r\n\t\t/** 스낵바 갱신 @dispatch */\r\n\t\tappendSnackbar(state, action: PayloadAction<SnackbarState>) {\r\n\t\t\tstate.text = action.payload.text;\r\n\t\t\tstate.type = action.payload.type;\r\n\t\t},\r\n\t\t/** 스낵바 초기화 @dispatch */\r\n\t\tdeleteSnackbar(state) {\r\n\t\t\tstate.text = \"\";\r\n\t\t\tstate.type = \"INFO\"\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nexport interface SnackbarState {\r\n\ttext: string;\r\n\ttype: Snackbar;\r\n}\r\n\r\nexport const {\r\n\tappendSnackbar,\r\n\tdeleteSnackbar\r\n} = SnackbarSlice.actions\r\n\r\nexport default SnackbarSlice.reducer","import styled from 'styled-components'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\n// components\r\nimport Snackbar from 'components/commons/Snackbar'\r\n// lib\r\nimport zIndex from 'lib/styles/zIndex'\r\nimport media from 'lib/styles/media'\r\n// slices\r\nimport { deleteSnackbar } from 'slices/snackbar'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { SnackbarState } from 'slices/snackbar'\r\n\r\n\r\nconst SnackbarWrapper = ()=> {\r\n  const dispatch = useDispatch();\r\n\tconst snackbar = useSelector<RootState, SnackbarState>(state => state.snackbar);\r\n\t\r\n\r\n\tconst onClick = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\r\n\t\tif (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t\tdispatch(deleteSnackbar());\r\n\t};\r\n\r\n\t\r\n\treturn (\r\n\t\t<Container>\r\n\t\t\t{snackbar.text !== '' && <Snackbar onClick={onClick} \r\n                                         text={snackbar.text} \r\n                                         type={snackbar.type} />}\r\n\t\t</Container>\r\n\t);\r\n}\r\n\r\nconst Container = styled.div`\r\n\tposition: fixed;\r\n\ttop: 40px;\r\n\tright: 30px;\r\n\twidth: 320px;\r\n\theight: auto;\r\n\tz-index: ${zIndex.snackbar};\r\n\r\n\t${media.small} {\r\n\t\twidth: 100%;\r\n\t\ttop: initial;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tmargin: auto;\r\n\t}\r\n`;\r\n\r\nexport default SnackbarWrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst ViewerWrapper = styled.div`\r\n  position: relative;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  overflow-x: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n  ${styles.scrollbar(0)};\r\n`;\r\n\r\nexport default ViewerWrapper","import { configureStore } from \"@reduxjs/toolkit\";\r\nimport { combineReducers } from 'redux'\r\n// reducers\r\nimport book from 'slices/book'\r\nimport snackbar from 'slices/snackbar'\r\n\r\n/**\r\n * 모든 리듀서가 결합된 Root 리듀서\r\n */\r\nconst reducer = combineReducers({\r\n\tbook,\r\n\tsnackbar\r\n});\r\n\r\nexport type RootState = ReturnType<typeof reducer>\r\n\r\n/**\r\n * 공통 Store\r\n */\r\nconst store = configureStore({\r\n\treducer,\t\r\n});\r\n\r\nexport default store","import { useState, useEffect, useCallback } from 'react';\r\n\r\n/**\r\n * Epub Reader 메뉴를 컨트롤 하는 hook\r\n * - control의 display를 Menu 생성/제거 플래그로 이용합니다.\r\n * - control의 show를 Animaton 플래그로 이용합니다.\r\n * - Menu 이외의 영역 클릭시 Close Event 발동\r\n *\r\n * @param ref DOM을 가지고 있는 useRef\r\n * @param delay 애니메이션 딜레이 시간(ms)\r\n * \r\n * @example\r\n * const Viewer = () => {\r\n *   const menuDelay = 300;\r\n * \r\n *   const ref = useRef<HTMLDivElement | null>(null);\r\n *   const [control, onToggle] = usemenu(ref, menuDelay);\r\n * \r\n *   return (<>\r\n *     <MenuOpenBtn onClick={onToggle} />\r\n *     <Menu control={control} onToggle={onToggle} ref={ref} />\r\n *   </>);\r\n * }\r\n * \r\n * const Menu = ({ control, onToggle }, ref) => {\r\n *   return (<>\r\n *     {control.display && <MenuWrapper show={control.show} \r\n *                                      delay={menuDelay}\r\n *                                      ref={ref}>\r\n *       <CloseBtn onClick={onToggle} />\r\n *     </MenuWrapper>}\r\n *   </>);\r\n * }\r\n * \r\n * const MenuWrapper = styled.div<{show: boolean; delay: boolean;}>`\r\n *   transform: ${({show}) => show\r\n *     ? \"translateX(0px)\"\r\n *     : \"translateX(420px)\"\r\n *   };\r\n *   transition: ${({delay}) => `${delay}ms ease`};\r\n * `;\r\n */\r\nfunction useMenu(ref: { current: any }, delay: number) {\r\n\tconst [eventSignal, setEventSignal] = useState<boolean>(true);\r\n\tconst [control, setControl] = useState<MenuControl>({\r\n\t\tdisplay: false,\r\n\t\topen: false\r\n\t});\r\n\t\r\n\r\n\t/** Menu 토글 */\r\n\tconst onToggle = useCallback(() => {\r\n\t\tlet event: any = null;\r\n\t\twindow.clearTimeout(event);\r\n\t\tif (!control.display) {\r\n\t\t\tsetControl({ display: true, open: false });\r\n\t\t\tevent = window.setTimeout(() => setControl({ display: true, open: true}), 0);\r\n\t\t} else {\r\n\t\t\tsetControl({ display: true, open: false });\r\n\t\t\tevent = window.setTimeout(() => setControl({ display: false, open: false }), delay - 50);\r\n\t\t}\r\n\t}, [control.display, delay]);\r\n\r\n\t/** \r\n\t * 메뉴 닫기 \r\n\t * - Event path에서 메뉴가 포함되어있지 않으면, 함수를 실행합니다.\r\n\t */\r\n  const onClose = useCallback((e: any) => {\r\n    if (!ref || !ref.current) return;\r\n    if (!e.path.includes(ref.current)) {\r\n\t\t\tonToggle();\r\n    }\r\n  }, [ref, onToggle]);\r\n\r\n\t/** \r\n\t * 이벤트 재등록\r\n\t * - '보기설정' 에서 rendition이 재 렌더링 될 때, 이벤트를 재등록하기 위한 함수\r\n\t * - Iframe 생성 시간 대기 [About 250ms]\r\n\t */\r\n\tconst emitEvent = useCallback(() => {\r\n\t\twindow.setTimeout(() => setEventSignal(true), 300);\r\n\t}, [setEventSignal]); \r\n\r\n\r\n  /** \r\n\t * 목차 닫기 이벤트 등록 \r\n\t * - Epub이 iframe으로 등록되므로, iframe에도 Event를 등록시켜줍니다.\r\n\t */\r\n  useEffect(() => {\r\n\t\tif (!eventSignal && !control.display) return;\r\n\t\t\r\n    const epubIframe = document.querySelector('iframe');\r\n\r\n\t\tif (control.display) {\r\n\t\t\tdocument.addEventListener('click', onClose);\r\n\t\t\tif (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.addEventListener('click', onClose);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdocument.removeEventListener('click', onClose);\r\n      if (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.removeEventListener('click', onClose);\r\n      }\r\n\t\t}\r\n\r\n\t\tsetEventSignal(false);\r\n  \r\n    return () => {\r\n      document.removeEventListener('click', onClose);\r\n      if (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.removeEventListener('click', onClose);\r\n      }\r\n    }\r\n  }, [control.display, onClose, eventSignal]);\r\n\r\n\treturn [control, onToggle, emitEvent] as const;\r\n}\r\n\r\nexport type MenuControl = {\r\n\tdisplay: boolean;\r\n\topen: boolean;\r\n}\r\n\r\nexport default useMenu","import React, { useState, useEffect, useCallback } from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\n// slices\r\nimport { pushHighlight, popHighlight, updateHighlight } from 'slices/book'\r\nimport { newSnackbar } from 'slices/snackbar'\r\n// utils\r\nimport {  \r\n\tgetParagraphCfi,\r\n\tclashCfiRange, \r\n\tgetSelectionPosition,\r\n\tcompareCfi,\r\n\tcfiRangeSpliter,\r\n\tgetNodefromCfi\r\n} from 'lib/utils/commonUtil'\r\n// styles\r\nimport viewerLayout, { contextmenuWidth } from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { BookStyle, BookFlow } from 'types/book'\r\nimport Page from 'types/page'\r\nimport Selection from 'types/selection'\r\nimport Highlight from 'types/highlight'\r\n\r\n\r\n/**\r\n * Epub Reader의 Highlight 관련 hook\r\n * - [selection]: 현재 selection의 정보\r\n * - [onSelection]: selection 적용 함수 (Iframe에 selection 이벤트로 등록해야 합니다.)\r\n * - [onClickHighlight]: highlight 클릭 함수\r\n * - [onAddHighlight] highlight 생성 함수\r\n * - [onRemoveHighlight]: highlight 제거 함수\r\n * - [onUpdateHighlight]: highlight 갱신 함수\r\n *\r\n * @param viewerRef Viewer에 등록된 가지고 있는 useRef\r\n * @param setIsContextMenu Contextmenu를 컨트롤 할 수 있는 useState 함수\r\n * \r\n * @example\r\n * const [isContextMenu, setIsContextMenu] = useState<boolean>(false);\r\n * \r\n * const { \r\n * \tselection, \r\n * \tonSelection, \r\n * \tonClickHighlight,\r\n * \tonRemoveHighlight\r\n * } = useSelection(viewerRef, setIsContextMenu);\r\n */\r\nconst useHighlight = (\r\n\tviewerRef: any, \r\n\tsetIsContextMenu: React.Dispatch<React.SetStateAction<boolean>>,\r\n\tbookStyle: BookStyle,\r\n\tbookFlow: BookFlow\r\n) => {\r\n\tconst dispatch = useDispatch();\r\n\tconst currentLocation = useSelector<RootState, Page>(state => state.book.currentLocation);\r\n\tconst highlights = useSelector<RootState, Highlight[]>(state => state.book.highlights);\r\n\r\n\tconst [selection, setSelection] = useState<Selection>({\r\n\t\tupdate: false,\r\n\t\tx: 0,\r\n\t\ty: 0,\r\n\t\theight: 0,\r\n\t\tcfiRange: '',\r\n\t\tcontent: ''\r\n\t});\r\n\t\r\n\r\n\t/** \r\n\t * Selection 발동 이벤트\r\n\t * @param cfiRange CfiRange\r\n\t * @return Whether event is success\r\n\t */\r\n\tconst onSelection = useCallback((cfiRange: string): boolean => {\r\n\t\tif (!viewerRef.current) return false;\r\n\r\n\t\tconst iframe = viewerRef.current.querySelector('iframe');\r\n\t\tif (!iframe) return false;\r\n\r\n\t\tconst iframeWin = iframe.contentWindow;\r\n\t\tif (!iframeWin) return false;\r\n\t\t\r\n\t\tconst filtered = highlights.filter(\r\n\t\t\thighlight => clashCfiRange(highlight.cfiRange, cfiRange)\r\n\t\t);\r\n\r\n\t\tif (filtered.length > 0) {\r\n\t\t\tdispatch(newSnackbar({\r\n        text: \"There are already registered highlights in your selection.\", \r\n        type: \"WARNING\" \r\n      }));\r\n\r\n\t\t\tiframeWin.getSelection().removeAllRanges();\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst position = getSelectionPosition(\r\n\t\t\tviewerRef.current,\r\n\t\t\tbookStyle,\r\n\t\t\tbookFlow,\r\n\t\t\tviewerLayout.MIN_VIEWER_WIDTH,\r\n\t\t\tviewerLayout.MIN_VIEWER_HEIGHT,\r\n\t\t\tviewerLayout.VIEWER_HEADER_HEIGHT,\r\n\t\t\tcontextmenuWidth\r\n\t\t);\r\n\t\tif (!position) return false;\r\n\r\n\t\tconst { x, y, height } = position;\r\n\r\n\t\tconst content = iframeWin.getSelection().toString().trim();\r\n\r\n\t\tif (content.length === 0) return false;\r\n\t\t\r\n\t\tsetSelection({ \r\n\t\t\tupdate: false,\r\n\t\t\tx, \r\n\t\t\ty,\r\n\t\t\theight,\r\n\t\t\tcfiRange,\r\n\t\t\tcontent\r\n\t\t});\r\n\t\t\r\n\t\treturn true;\r\n\t}, [\r\n\t\tdispatch, \r\n\t\tviewerRef,\r\n\t\thighlights, \r\n\t\tbookFlow, \r\n\t\tbookStyle,\r\n\t\tsetSelection\r\n\t]);\r\n\r\n\t/** Highlight 클릭 이벤트 */\r\n\tconst onClickHighlight = useCallback((highlightNode: HTMLElement) => {\r\n\t\tconst targetNode = highlightNode.parentElement;\r\n\t\tif (!targetNode) return;\r\n\r\n\t\tconst cfiRange = targetNode.dataset.epubcfi;\r\n\t\tif (!cfiRange) return;\r\n\r\n\t\tconst { x, y, width, height } = targetNode.getBoundingClientRect();\r\n\r\n\t\tsetSelection({ \r\n\t\t\tupdate: true,\r\n\t\t\tx: x + width / 2 - contextmenuWidth / 2, \r\n\t\t\ty: y + height,\r\n\t\t\theight,\r\n\t\t\tcfiRange,\r\n\t\t\tcontent: \"\"\r\n\t\t});\r\n\t}, [setSelection]);\r\n\r\n\t/** 하이라이트 생성 함수 */\r\n\tconst onAddHighlight = useCallback((color: string) => {\r\n    const paragraphCfi = getParagraphCfi(selection.cfiRange);\r\n    if (!paragraphCfi) return;\r\n    \r\n    const highlight: Highlight = {\r\n      key: paragraphCfi + selection.cfiRange,\r\n      accessTime: new Date().toISOString(),\r\n      createTime: new Date().toISOString(),\r\n      color,\r\n      paragraphCfi,\r\n      cfiRange: selection.cfiRange,\r\n      chpaterName: currentLocation.chapterName,\r\n      pageNum: currentLocation.currentPage,\r\n      content: selection.content\r\n    };\r\n\r\n    dispatch(pushHighlight(highlight));\r\n\r\n\t\tsetSelection({ ...selection, update: true });\r\n  }, [dispatch, selection, currentLocation]);\r\n\r\n\t/** \r\n   * 하이라이트 수정\r\n   * @param color 색상 Hex 코드\r\n   */\r\n\tconst onUpdateHighlight = useCallback((highlight: Highlight | null, color: string) => {\r\n\t\tif (!highlight) return;\r\n\r\n    dispatch(updateHighlight({\r\n      ...highlight,\r\n      color\r\n    }));\r\n  }, [dispatch]);\r\n\r\n\t/** \r\n\t * 하이라이트 제거 함수 \r\n\t * @param key 북마크 식별값\r\n\t */\r\n\t const onRemoveHighlight = useCallback((key: string, cfiRange: string) => {\r\n\t\tif (!viewerRef.current || !key) return;\r\n\r\n\t\tdispatch(popHighlight(key));\r\n\r\n\t\tdispatch(newSnackbar({\r\n\t\t\ttext: \"The highlight removed successful!\", \r\n\t\t\ttype: \"INFO\" \r\n\t\t}));\r\n\t\t\r\n\t\tviewerRef.current.offHighlight(cfiRange);\r\n\t}, [dispatch, viewerRef]);\r\n\r\n\r\n\t/**\r\n\t * 하이라이트 여부 확인\r\n\t * - 페이지 변경에 따른 하이라이트 확인 및 적용\r\n\t */\r\n\t useEffect(() => {\r\n\t\tif (!viewerRef.current) return;\r\n\r\n\t\tconst iframe = viewerRef.current.querySelector('iframe');\r\n\t\tif (!iframe) return;\r\n\r\n\t\tconst iframeWin = iframe.contentWindow;\r\n\t\tif (!iframeWin) return;\r\n\r\n\t\thighlights.forEach(highlight => {\r\n\t\t\tconst cfiRange = cfiRangeSpliter(highlight.cfiRange);\r\n\t\t\tif (!cfiRange) return;\r\n\r\n\t\t\tconst { startCfi } = cfiRange;\r\n\r\n\t\t\tif (compareCfi(currentLocation.startCfi, startCfi) < 1\r\n\t\t\t\t&& compareCfi(currentLocation.endCfi, startCfi) > -1) {\r\n\t\t\t\tconst node = getNodefromCfi(highlight.paragraphCfi);\r\n\t\t\t\tif (!node) return;\r\n\r\n\t\t\t\tviewerRef.current.onHighlight(\r\n\t\t\t\t\thighlight.cfiRange,\r\n\t\t\t\t\t(e: any) => {\r\n\t\t\t\t\t\tonClickHighlight(e.target);\r\n\t\t\t\t\t\tsetIsContextMenu(true);\r\n\t\t\t\t\t},\r\n\t\t\t\t\thighlight.color \r\n\t\t\t\t);\r\n\r\n\t\t\t\tiframeWin.getSelection().removeAllRanges();\r\n\t\t\t}\r\n\t\t});\r\n\t}, [\r\n\t\tdispatch,\r\n\t\tviewerRef, \r\n\t\tcurrentLocation, \r\n\t\thighlights, \r\n\t\tonRemoveHighlight,\r\n\t\tonClickHighlight,\r\n\t\tsetIsContextMenu\r\n\t]);\r\n\r\n\r\n\treturn { \r\n\t\tselection, \r\n\t\tonSelection, \r\n\t\tonClickHighlight,\r\n\t\tonAddHighlight,\r\n\t\tonRemoveHighlight,\r\n\t\tonUpdateHighlight\r\n\t};\r\n}\r\n\r\nexport default useHighlight;","import { useState, useRef } from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { Provider } from 'react-redux'\r\n// containers\r\nimport Viewer from 'modules/reactViewer/ReactViewer'\r\nimport Header from 'containers/Header'\r\nimport Footer from 'containers/Footer'\r\nimport Nav from 'containers/menu/Nav'\r\nimport Option from 'containers/menu/Option'\r\nimport Learning from 'containers/menu/Note'\r\nimport ContextMenu from 'containers/commons/ContextMenu'\r\nimport Snackbar from 'containers/commons/Snackbar'\r\n// components\r\nimport ViewerWrapper from 'components/commons/ViewerWrapper'\r\nimport LoadingView from 'LoadingView'\r\n// slices\r\nimport store from 'slices'\r\nimport { updateBook, updateCurrentPage, updateToc } from 'slices/book'\r\n// hooks\r\nimport useMenu from 'lib/hooks/useMenu'\r\nimport useHighlight from 'lib/hooks/useHighlight'\r\n// styles\r\nimport 'lib/styles/readerStyle.css'\r\nimport viewerLayout from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { ViewerRef } from 'types'\r\nimport Book, { BookStyle, BookOption } from 'types/book'\r\nimport Page from 'types/page'\r\nimport Toc from 'types/toc'\r\n\r\n\r\nconst Reader = ({ url, loadingView }: Props) => {\r\n  const dispatch = useDispatch();\r\n  const book = useSelector<RootState, Book>(state => state.book.book);\t\r\n\tconst currentLocation = useSelector<RootState, Page>(state => state.book.currentLocation);\r\n  \r\n\tconst viewerRef = useRef<ViewerRef | null>(null);\r\n\tconst navRef = useRef<HTMLDivElement | null>(null);\r\n  const optionRef = useRef<HTMLDivElement | null>(null);\r\n  const learningRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\tconst [isContextMenu, setIsContextMenu] = useState<boolean>(false);\r\n\t\r\n\tconst [bookStyle, setBookStyle] = useState<BookStyle>({\r\n    fontFamily: 'Origin',\r\n    fontSize: 18,\r\n    lineHeight: 1.4,\r\n    marginHorizontal: 15,\r\n    marginVertical: 5\r\n  });\r\n\r\n  const [bookOption, setBookOption] = useState<BookOption>({\r\n    flow: \"paginated\",\r\n    resizeOnOrientationChange: true,\r\n    spread: \"auto\"\r\n  });\r\n\r\n\tconst [navControl, onNavToggle] = useMenu(navRef, 300.);\r\n\tconst [optionControl, onOptionToggle, emitEvent] = useMenu(optionRef, 300);\r\n\tconst [learningControl, onLearningToggle] = useMenu(learningRef, 300);\r\n\tconst { \r\n\t\tselection, \r\n\t\tonSelection, \r\n\t\tonClickHighlight,\r\n\t\tonAddHighlight,\r\n\t\tonRemoveHighlight,\r\n\t\tonUpdateHighlight\r\n\t} = useHighlight(viewerRef, setIsContextMenu, bookStyle, bookOption.flow);\r\n\r\n\r\n\r\n\t/**\r\n\t * Change Epub book information\r\n\t * @param book Epub Book Info\r\n\t */\r\n\tconst onBookInfoChange = (book: Book) => dispatch(updateBook(book));\r\n\r\n  /**\r\n\t * Change Epub location\r\n\t * @param loc epubCFI or href\r\n\t */\r\n\tconst onLocationChange = (loc: string) => {\r\n\t\tif (!viewerRef.current) return;\r\n\t\tviewerRef.current.setLocation(loc);\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * Move page\r\n\t * @param type Direction\r\n\t */\r\n\tconst onPageMove = (type: \"PREV\" | \"NEXT\") => {\r\n\t\tconst node = viewerRef.current;\r\n\t\tif (!node || !node.prevPage || !node.nextPage) return;\r\n\r\n\t\ttype === \"PREV\" && node.prevPage();\r\n\t\ttype === \"NEXT\" && node.nextPage();\r\n\t};\r\n\r\n\t/**\r\n\t * Set toc\r\n\t * @param toc Table of Epub contents\r\n\t */\r\n\tconst onTocChange = (toc: Toc[]) => dispatch(updateToc(toc));\r\n\r\n\t/** \r\n\t * Set Epub viewer styles\r\n\t * @param bokkStyle_ viewer style\r\n\t */\r\n\tconst onBookStyleChange = (bookStyle_: BookStyle) => setBookStyle(bookStyle_);\r\n\r\n\t/** \r\n\t * Set Epub viewer options\r\n\t * @param bookOption_ viewer option\r\n\t */\r\n\t const onBookOptionChange = (bookOption_: BookOption) => setBookOption(bookOption_);\r\n\r\n\t/**\r\n\t * Change current page\r\n\t * @param page Epub page\r\n\t */\r\n\tconst onPageChange = (page: Page) => dispatch(updateCurrentPage(page));\r\n\r\n\t/** \r\n\t * ContextMenu on \r\n\t * @param cfiRange CfiRange\r\n\t */\r\n\tconst onContextMenu = (cfiRange: string) => {\r\n\t\tconst result = onSelection(cfiRange);\r\n\t\tsetIsContextMenu(result);\r\n\t}\r\n\r\n\t/** ContextMenu off */\r\n\tconst onContextmMenuRemove = () => setIsContextMenu(false);\r\n\r\n\t\r\n\t\r\n  return (<>\r\n    <ViewerWrapper>\r\n      <Header \r\n\t\t\t\ttitle={book.title}\r\n\t\t\t\tbookOption={bookOption}\r\n\t\t\t\tonNavToggle={onNavToggle}\r\n\t\t\t\tonOptionToggle={onOptionToggle}\r\n\t\t\t\tonLearningToggle={onLearningToggle}\r\n\t\t\t\tonBookOptionChange={onBookOptionChange}\r\n\t\t\t/>\r\n\r\n      <Viewer \r\n\t\t\t\turl={url}\r\n\t\t\t\tviewerLayout={viewerLayout}\r\n\t\t\t\tviewerStyle={bookStyle}\r\n\t\t\t\tviewerOption={bookOption}\r\n\t\t\t\tonBookInfoChange={onBookInfoChange}\r\n\t\t\t\tonPageChange={onPageChange}\r\n\t\t\t\tonTocChange={onTocChange}\r\n\t\t\t\tonSelection={onContextMenu}\r\n\t\t\t\tloadingView={loadingView || <LoadingView />}\r\n\t\t\t\tref={viewerRef}\r\n\t\t\t/>\r\n      \r\n\t\t\t<Footer \r\n\t\t\t\ttitle={currentLocation.chapterName}\r\n\t\t\t\tnowPage={currentLocation.currentPage}\r\n\t\t\t\ttotalPage={currentLocation.totalPage}\r\n\t\t\t\tonPageMove={onPageMove}\r\n\t\t\t/>\r\n    </ViewerWrapper>\r\n\r\n    <Nav\r\n\t\t\tcontrol={navControl}\r\n\t\t\tonToggle={onNavToggle}\r\n\t\t\tonLocation={onLocationChange}\r\n\t\t\tref={navRef}\r\n\t\t/>\r\n    \r\n    <Option \r\n\t\t\tcontrol={optionControl}\r\n\t\t\tbookStyle={bookStyle}\r\n\t\t\tbookFlow={bookOption.flow}\r\n\t\t\tonToggle={onOptionToggle} \r\n\t\t\temitEvent={emitEvent}\r\n\t\t\tonBookStyleChange={onBookStyleChange}\r\n\t\t\tref={optionRef}\r\n\t\t/>\r\n\r\n\t\t<Learning \r\n\t\t\tcontrol={learningControl}\r\n\t\t\tonToggle={onLearningToggle}\r\n\t\t\tonClickHighlight={onClickHighlight}\r\n\t\t\temitEvent={emitEvent}\r\n\t\t\tviewerRef={viewerRef}\r\n\t\t\tref={learningRef}\r\n\t\t/>\r\n\r\n\t\t<ContextMenu\r\n\t\t\tactive={isContextMenu}\r\n\t\t\tviewerRef={viewerRef}\r\n\t\t\tselection={selection}\r\n\t\t\tonAddHighlight={onAddHighlight}\r\n\t\t\tonRemoveHighlight={onRemoveHighlight}\r\n\t\t\tonUpdateHighlight={onUpdateHighlight}\r\n\t\t\tonContextmMenuRemove={onContextmMenuRemove}\r\n\t\t/>\r\n\r\n\t\t<Snackbar />\r\n  </>);\r\n}\r\n\r\nconst ReaderWrapper = ({ url, loadingView }: Props) => {\r\n\treturn (\r\n\t\t<Provider store={store}>\r\n\t\t\t<Reader url={url} loadingView={loadingView} />\r\n\t\t</Provider>\r\n\t);\r\n}\r\n\r\ninterface Props {\r\n\turl: string;\r\n\tloadingView?: React.ReactNode;\r\n}\r\n\r\nexport default ReaderWrapper","import ReactDOM from 'react-dom';\r\nimport Reader from 'containers/Reader'\r\n\r\nconst EPUB_URL = \"files/Alices Adventures in Wonderland.epub\";\r\n\r\nReactDOM.render(<Reader url={EPUB_URL} />,  document.getElementById('root'));"],"sourceRoot":""}