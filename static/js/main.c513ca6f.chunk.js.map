{"version":3,"sources":["lib/styles/palette.ts","lib/styles/zIndex.ts","components/header/Wrapper.tsx","components/header/Layout.tsx","lib/styles/styles.ts","lib/styles/media.ts","components/header/Logo.tsx","components/header/ControlBtn.tsx","containers/Header.tsx","components/footer/Wrapper.tsx","components/footer/Item.tsx","lib/svg/Prev.js","lib/svg/Next.js","lib/svg/BookClose.js","lib/svg/BookOpen.js","lib/svg/Close.js","lib/svg/Down.js","lib/svg/ScrollHorizontal.js","lib/svg/ScrollVertical.js","lib/svg/Search.js","components/footer/MoveBtn.tsx","containers/Footer.tsx","components/sideMenu/CloseBtn.tsx","components/sideMenu/Wrapper.tsx","components/nav/BookInfo.tsx","components/nav/NavItem.tsx","containers/menu/Nav.tsx","components/option/Layout.tsx","components/option/OptionWrapper.tsx","components/option/OptionTitle.tsx","components/option/DropdownValue.tsx","components/option/DropdownItemWrapper.tsx","components/option/DropdownItem.tsx","components/option/Dropdown.tsx","components/option/OptionValue.tsx","components/option/SliderValue.tsx","components/option/Slider.tsx","components/option/ControlIconBtnWrapper.tsx","components/option/ControlIconBtn.tsx","containers/menu/Option.tsx","components/note/highlight/Wrapper.tsx","components/note/highlight/Title.tsx","components/note/highlight/Post.tsx","slices/book.ts","lib/utils/commonUtil.ts","containers/menu/commons/Highlight.tsx","components/note/Layout.tsx","components/sideMenu/MenuEmpty.tsx","containers/menu/Note.tsx","lib/styles/viewerLayout.ts","components/contextMenu/Wrapper.tsx","components/contextMenu/ColorItem.tsx","components/contextMenu/Item.tsx","containers/commons/ContextMenu.tsx","lib/styles/animations.ts","components/commons/Snackbar.tsx","slices/snackbar.ts","containers/commons/Snackbar.tsx","components/commons/ViewerWrapper.tsx","LoadingView.tsx","slices/index.ts","lib/hooks/useMenu.ts","lib/hooks/useHighlight.ts","containers/Reader.tsx","index.tsx"],"names":["palette","white","black","gray0","gray1","gray2","gray3","gray4","gray5","gray6","gray7","gray8","red0","red1","red2","red3","red4","red5","red6","red7","red8","orange0","orange1","orange2","orange3","orange4","orange5","orange6","orange7","orange8","yellow0","yellow1","yellow2","yellow3","yellow4","yellow5","yellow6","yellow7","yellow8","green0","green1","green2","green3","green4","green5","green6","green7","green8","blue0","blue1","blue2","blue3","blue4","blue5","blue6","blue7","blue8","purple0","purple1","purple2","purple3","purple4","purple5","purple6","purple7","purple8","zIndexSet","layer","zIndex","header","menu","modal","snackbar","tooltip","Wrapper","styled","div","Layout","AutoLayout","noselect","transition","boxShadow","scrollbar","width","mediaQuery","maxWidth","mediaValue","media","xlarge","large","medium","small","xsmall","custom","a","styles","Img","img","Logo","href","target","src","alt","Btn","button","ControlBtn","message","onClick","Header","onNavToggle","onOptionToggle","onLearningToggle","Container","Item","text","SvgPrev","props","xmlns","viewBox","id","data-name","fill","d","opacity","className","SvgNext","SvgBookClose","SvgBookOpen","SvgClose","SvgDown","stroke","strokeLinecap","strokeLinejoin","strokeWidth","SvgScrollHorizontal","cx","cy","r","SvgScrollVertical","SvgSearch","Content","MoveBtn","type","Icon","PrevIcon","NextIcon","msg","title","Footer","nowPage","totalPage","onPageMove","CloseIcon","CloseBtn","ref","show","onClose","children","React","forwardRef","BookImg","BookContent","Title","Info","BookInfo","publisher","author","NavItem","Nav","control","onToggle","onLocation","book","useSelector","state","bookToc","toc","Tocs","map","t","idx","label","loc","display","open","coverURL","OptionWrapper","OptionTitle","isDropdown","span","DropdownValue","value","Down","DropdownItemWrapper","DropdownItem","DropdownWrapper","Dropdown","defaultValue","valueList","onSelect","useRef","useState","visible","setVisible","useCallback","e","current","path","includes","Items","font","useEffect","document","addEventListener","removeEventListener","OptionValue","active","SliderWrapper","SliderBackground","SliderBar","percentage","Slider","input","SliderValue","minValue","maxValue","step","onChange","Math","round","min","max","disabled","BtnWrapper","ControlIconBtnWrapper","isSelected","css","ControlIconBtn","HeaderIcon","ScrollVerticalIcon","ScrollHorizontalIcon","BookOpenIcon","BookCloseIcon","Option","bookStyle","bookOption","bookFlow","emitEvent","onBookStyleChange","onBookOptionChange","fontFamily","setFontFamily","fontSize","setFontSize","lineHeight","setLineHeight","marginHorizontal","setMarginHorizontal","marginVertical","setMarginVertical","isScrollHorizontal","setIsScrollHorizontal","spread","viewType","setViewType","onChangeSlider","onClickDirection","flow","onClickViewType","isSpread","timer","window","setTimeout","clearTimeout","Post","color","initialBook","description","published_date","modified_date","language","initialState","currentLocation","chapterName","currentPage","startCfi","endCfi","base","highlights","colorList","name","code","bookSlice","createSlice","reducers","updateBook","action","payload","updateCurrentPage","clearBook","updateToc","clearToc","pushHighlight","filter","h","key","length","push","updateHighlight","new_idx","old_idx","indexOf","splice","popHighlight","actions","compareCfi","cfi_1","cfi_2","EpubCFI","compare","cfiRangeSpliter","cfiRange","slice","split","origin","start","end","getParagraphCfi","Highlight","highlight","viewerRef","dispatch","useDispatch","now","Date","toISOString","accessTime","splitCfi","setLocation","svgContainer","querySelector","targetSvg","childNodes","chpaterName","content","MenuEmpty","Note","onClickHighlight","highlightList","setHighlightList","contextmenuWidth","viewerLayout","MIN_VIEWER_WIDTH","MIN_VIEWER_HEIGHT","VIEWER_HEADER_HEIGHT","VIEWER_FOOTER_HEIGHT","VIEWER_SIDEMENU_WIDTH","x","innerWidth","y","innerHeight","height","isReverse","ColorWrapper","Color","Message","ColorItem","blur","ContextMenu","selection","onAddHighlight","onRemoveHighlight","onUpdateHighlight","onContextmMenuRemove","menuRef","setHighlight","setDisplay","isEraseBtn","setIsEraseBtn","setIsReverse","setHeight","setY","ColorList","update","onRemoveHighlight_","onRemove","onKeyPress","paragraphCfi","filtered","highlight_","iframe","node","contentWindow","scrolledTarget","itemCnt","defaultHeight","y_","animations","fadeIn","keyframes","fadeOut","fadeInTop","fadeOutTop","fadeInBottom","fadeOutBottom","fadeInLeft","fadeOutLeft","fadeInRight","fadeOutRight","spin","Snackbar","RefEvent","newSnackbar","createAsyncThunk","event","shift","SnackbarSlice","deleteSnackbar","appendSnackbar","SnackbarWrapper","preventDefault","stopPropagation","ViewerWrapper","LoadingWrapper","LoadingView","reducer","combineReducers","store","configureStore","useMenu","delay","eventSignal","setEventSignal","setControl","epubIframe","useHighlight","setIsContextMenu","setSelection","onSelection","iframeWin","baseCfiRange","targetCfiRange","splitCfi1","splitCfi2","s1","e1","s2","e2","clashCfiRange","getSelection","removeAllRanges","position","viewer","CONTEXTMENU_WIDTH","windowWidth","windowHeight","iframeWidth","offsetWidth","scrollTop","selection_","rangeCount","getRangeAt","getBoundingClientRect","selectionX","selectionY","selectionHeight","selectionWidth","getSelectionPosition","toString","trim","highlightNode","targetNode","parentElement","dataset","epubcfi","createTime","pageNum","offHighlight","forEach","cfi","replace","cfiPath","Number","iframeBody","body","component","n","bookmark","getNodefromCfi","onHighlight","Reader","url","loadingView","navRef","optionRef","learningRef","isContextMenu","setBookStyle","resizeOnOrientationChange","setBookOption","navControl","optionControl","learningControl","viewerStyle","viewerOption","onBookInfoChange","onPageChange","page","onTocChange","result","prevPage","nextPage","bookStyle_","bookOption_","ReaderWrapper","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.c513ca6f.chunk.js","sourcesContent":["/*\r\n :::: Color Varient ::::\r\n*/\r\nconst palette = {\r\n  white: '#ffffff',\r\n  black: '#000000',\r\n  /* gray */\r\n  gray0: '#fafafa',\r\n  gray1: '#e7e7e7',\r\n  gray2: '#c3c3c3',\r\n  gray3: '#9e9e9e',\r\n  gray4: '#868686',\r\n  gray5: '#656565',\r\n  gray6: '#505050',\r\n  gray7: '#3c3c3c',\r\n  gray8: '#282828',\r\n  /* red */\r\n  red0: '#ffe8e8',\r\n  red1: '#ffd0d1',\r\n  red2: '#ff8a8b',\r\n  red3: '#ff4445',\r\n  red4: '#ff1517',\r\n  red5: '#bf1011',\r\n  red6: '#990d0e',\r\n  red7: '#73090a',\r\n  red8: '#4d0607',\r\n  /* orange */\r\n  orange0: '#fff0ec',\r\n  orange1: '#ffe2d9',\r\n  orange2: '#ffb6a0',\r\n  orange3: '#ff8966',\r\n  orange4: '#ff6c40',\r\n  orange5: '#bf5130',\r\n  orange6: '#994126',\r\n  orange7: '#73311d',\r\n  orange8: '#4d2013',\r\n  /* yellow */\r\n  yellow0: '#fffce6',\r\n  yellow1: '#fffacc',\r\n  yellow2: '#fff280',\r\n  yellow3: '#feea33',\r\n  yellow4: '#fee500',\r\n  yellow5: '#bfac00',\r\n  yellow6: '#988900',\r\n  yellow7: '#726700',\r\n  yellow8: '#4c4500',\r\n  /* green */\r\n  green0: '#e6f7e6',\r\n  green1: '#cdefcc',\r\n  green2: '#83d880',\r\n  green3: '#39c133',\r\n  green4: '#07b100',\r\n  green5: '#058500',\r\n  green6: '#046a00',\r\n  green7: '#035000',\r\n  green8: '#023500',\r\n  /* blue */\r\n  blue0: '#ebf1ff',\r\n  blue1: '#d7e3ff ',\r\n  blue2: '#9cb9ff ',\r\n  blue3: '#618eff ',\r\n  blue4: '#3972ff ',\r\n  blue5: '#2b56bf ',\r\n  blue6: '#224499 ',\r\n  blue7: '#1a3373 ',\r\n  blue8: '#11224d ',\r\n  /* purple */\r\n  purple0: '#f2ebff',\r\n  purple1: '#d7e3ff',\r\n  purple2: '#be9cff',\r\n  purple3: '#9761ff',\r\n  purple4: '#7d39ff',\r\n  purple5: '#5e2bbf',\r\n  purple6: '#4b2299',\r\n  purple7: '#381a73',\r\n  purple8: '#26114d',\r\n};\r\n\r\nexport default palette","export const zIndexSet = (layer: number): string => `\r\n\t${layer}\r\n`;\r\n\r\nconst zIndex = {\r\n\theader: zIndexSet(5),\r\n\tmenu: zIndexSet(10),\r\n\tmodal: zIndexSet(100),\r\n\tsnackbar: zIndexSet(400),\r\n\ttooltip: zIndexSet(500)\r\n};\r\n\r\nexport default zIndex;","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Wrapper = styled.div`\r\n  position: sticky;\r\n  width: 100%;\r\n  height: auto;\r\n  left: 0;\r\n  top: 0;\r\n  background-color: ${palette.white};\r\n  z-index: ${zIndex.header};\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Layout = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  height: 64px;\r\n  z-index: ${zIndex.header};\r\n`;\r\n\r\nexport const AutoLayout = styled.div`\r\n  width: 100%;\r\n  flex-grow: 1;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  border-bottom: 2px solid ${palette.gray1};\r\n\r\n  & > div {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n  }\r\n  & > div:last-child {\r\n    margin-right: 8px;\r\n  }\r\n`;\r\n\r\nexport default Layout","export const noselect = (): string => `\r\n\t-webkit-touch-callout: none;\r\n\t-webkit-user-select: none;\r\n\t-khtml-user-select: none;\r\n\t-moz-user-select: none;\r\n\t-ms-user-select: none;\r\n\tuser-select: none;\r\n`;\r\n\r\nexport const transition = (): string =>`\r\n\tcubic-bezier(0.25, 0.1, 0.25, 1);\r\n`;\r\n\r\nexport const boxShadow = {\r\n\tlight: \"0px 4px 16px rgba(0, 0, 0, 0.04)\",\r\n\tregular: \"0px 8px 12px rgba(0, 0, 0, 0.2)\",\r\n\tbold: \"0 8px 10px 1px rgba(0,0,0,0.14), 0 3px 8px 2px rgba(0,0,0,0.12), 0 5px 5px -3px rgba(0,0,0,0.2)\"\r\n};\r\n\r\nexport const scrollbar = (width=8) => `\r\n\t&::-webkit-scrollbar {\r\n\t\twidth: ${width}px;\r\n\t\tbackground: transparent;\r\n\t}\r\n\t&::-webkit-scrollbar-thumb {\r\n\t\tbackground: #ddd;\r\n\t\tborder-radius: 10px;\r\n\t}\r\n\t&::-webkit-scrollbar-thumb:hover {\r\n\t\tbackground: #ccc;\r\n\t}\r\n\t&::-webkit-scrollbar-track {\r\n\t\tbackground: transparent;\r\n\t}\r\n`","export const mediaQuery = (maxWidth: number): string => `\r\n\t@media (max-width: ${maxWidth}px)\r\n`;\r\n\r\nexport const mediaValue = {\r\n\txlarge: 1600,\r\n\tlarge: 1440,\r\n\tmedium: 1200,\r\n\tsmall: 702,\r\n\txsmall: 350\t\r\n};\r\n\r\ntype Media = {\r\n\txlarge : string,\r\n\tlarge : string,\r\n\tmedium : string,\r\n\tsmall : string,\r\n\txsmall : string,\r\n\tcustom : (maxWidth: number) => string\r\n}\r\n\r\nconst media: Media = {\r\n\txlarge : mediaQuery(mediaValue.xlarge),\r\n\tlarge : mediaQuery(mediaValue.large),\r\n\tmedium : mediaQuery(mediaValue.medium),\r\n\tsmall : mediaQuery(mediaValue.small),\r\n\txsmall : mediaQuery(mediaValue.xsmall),\r\n\tcustom : mediaQuery,\r\n};\r\n\r\nexport default media;","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\nimport { mediaQuery } from 'lib/styles/media'\r\n\r\nconst Logo = () => {\r\n\treturn (\r\n\t\t<Wrapper href=\"https://github.com/altmshfkgudtjr/react-epub-viewer\" target=\"__blank__\">\r\n\t\t\t<Img src=\"/react-epub-viewer/images/logo.png\" alt=\"Logo\" />\r\n\t\t</Wrapper>\r\n\t);\r\n}\r\n\r\nconst Wrapper = styled.a`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\toutline: none;\r\n\tmargin-left: 16px;\r\n\tbackground-color: rgba(0,0,0,0);\r\n\ttransition: .2s ${styles.transition};\r\n\tborder-radius: 8px;\r\n\tpadding: 4px 8px;\r\n\tcursor: pointer;\r\n\r\n\t${mediaQuery(700)} {\r\n\t\tdisplay: none;\r\n\t}\r\n\r\n\t&:focus, &:hover {\r\n\t\tbackground-color: ${palette.blue0};\r\n\t}\r\n`;\r\n\r\nconst Img = styled.img`\r\n\theight: 44px;\r\n`;\r\n\r\nexport default Logo","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ControlBtn = ({ message, onClick }: Props) => {\r\n  return <Btn onClick={() => onClick()}>{message}</Btn>;\r\n}\r\n\r\nconst Btn = styled.button`\r\n  height: 100%;\r\n  padding: 0 16px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    color: ${palette.blue3};\r\n  }\r\n\r\n  &:first-child {\r\n    margin-left: 8px;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  message: string;\r\n  onClick: (value?: boolean) => void;\r\n}\r\n\r\nexport default ControlBtn","// components\r\nimport Wrapper from 'components/header/Wrapper'\r\nimport Layout, { AutoLayout } from 'components/header/Layout'\r\nimport Logo from 'components/header/Logo'\r\nimport ControlBtn from 'components/header/ControlBtn'\r\n\r\nconst Header = ({\r\n  onNavToggle, \r\n  onOptionToggle, \r\n  onLearningToggle\r\n}: Props) => {\r\n  return (\r\n    <Wrapper>\r\n      <Layout>\r\n        <AutoLayout>\r\n          <Logo />\r\n          <div>\r\n            <ControlBtn message=\"Contents\" onClick={onNavToggle} />\r\n            <ControlBtn message=\"Setting\" onClick={onOptionToggle} />\r\n            <ControlBtn message=\"Highlights\" onClick={onLearningToggle} />\r\n          </div>\r\n        </AutoLayout>\r\n      </Layout>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  onNavToggle: (value?: boolean) => void;\r\n  onOptionToggle: (value?: boolean) => void;\r\n  onLearningToggle: (value?: boolean) => void;\r\n}\r\n\r\nexport default Header","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Wrapper = styled.div`\r\n  position: fixed;\r\n  left: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  height: 60px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: ${palette.white};\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Item = ({ text }: Props) => {\r\n  return (\r\n    <Container>\r\n      <span>{text}</span>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.div`\r\n  height: 100%;\r\n  flex-basis: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n\r\n  & > span {\r\n    color: ${palette.gray4};\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n}\r\n\r\nexport default Item;","import * as React from \"react\";\r\n\r\nfunction SvgPrev(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 44 44\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".prev_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"prev_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"prev_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h44v44H0z\" opacity={0.3} />\r\n          <path className=\"prev_svg__cls-3\" d=\"M12 22L32 2M12 22l20 20\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgPrev;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgNext(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 44 44\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".next_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"next_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"next_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h44v44H0z\" opacity={0.3} />\r\n          <path className=\"next_svg__cls-3\" d=\"M32 22L12 2M32 22L12 42\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgNext;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgBookClose(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".bookClose_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"bookClose_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"bookClose_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            className=\"bookClose_svg__cls-3\"\r\n            d=\"M37.12 3H10.88a3 3 0 00-.43 0A1.71 1.71 0 009.1 4.11a1.87 1.87 0 00-.1.59v29.18c0 1 0 .94 1.88 1.88l18 9a1.8 1.8 0 002.6-1.2 3 3 0 000-.31v-7.58h5.62A1.88 1.88 0 0039 33.8V4.87A1.88 1.88 0 0037.12 3z\"\r\n          />\r\n          <path\r\n            className=\"bookClose_svg__cls-3\"\r\n            d=\"M31.5 35.67V14.84a2 2 0 00-1.1-1.78L10.45 3\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgBookClose;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgBookOpen(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".bookOpen_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"bookOpen_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"bookOpen_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            className=\"bookOpen_svg__cls-3\"\r\n            d=\"M4 6.5a27.24 27.24 0 0120 1v34a27.24 27.24 0 00-20-1zM24 7.5a27.24 27.24 0 0120-1v34a27.24 27.24 0 00-20 1\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgBookOpen;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgClose(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".close_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"close_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"close_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path className=\"close_svg__cls-3\" d=\"M4 4l40 40M4 44L44 4\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgClose;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgDown(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <g data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g data-name=\"\\uB808\\uC774\\uC5B4 1\">\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <path\r\n            d=\"M8.33 15.82l14.32 20.46a1.63 1.63 0 002.7 0l14.32-20.46A1.78 1.78 0 0038.32 13H9.68a1.78 1.78 0 00-1.35 2.82z\"\r\n            stroke=\"#000\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgDown;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgScrollHorizontal(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".scrollHorizontal_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"scrollHorizontal_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"scrollHorizontal_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle\r\n            className=\"scrollHorizontal_svg__cls-3\"\r\n            cx={24}\r\n            cy={24}\r\n            r={5}\r\n          />\r\n          <path\r\n            className=\"scrollHorizontal_svg__cls-3\"\r\n            d=\"M3 24l12-12M3 24l12 12M45 24L33 12M45 24L33 36\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgScrollHorizontal;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgScrollVertical(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".scrollVertical_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g\r\n        id=\"scrollVertical_svg__\\uB808\\uC774\\uC5B4_2\"\r\n        data-name=\"\\uB808\\uC774\\uC5B4 2\"\r\n      >\r\n        <g\r\n          id=\"scrollVertical_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle className=\"scrollVertical_svg__cls-3\" cx={24} cy={24} r={5} />\r\n          <path\r\n            className=\"scrollVertical_svg__cls-3\"\r\n            d=\"M24 3l12 12M24 3L12 15M24 45l12-12M24 45L12 33\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgScrollVertical;\r\n","import * as React from \"react\";\r\n\r\nfunction SvgSearch(props) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" {...props}>\r\n      <defs>\r\n        <style>\r\n          {\r\n            \".search_svg__cls-3{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}\"\r\n          }\r\n        </style>\r\n      </defs>\r\n      <g id=\"search_svg__\\uB808\\uC774\\uC5B4_2\" data-name=\"\\uB808\\uC774\\uC5B4 2\">\r\n        <g\r\n          id=\"search_svg__\\uB808\\uC774\\uC5B4_1-2\"\r\n          data-name=\"\\uB808\\uC774\\uC5B4 1\"\r\n        >\r\n          <path fill=\"none\" d=\"M0 0h48v48H0z\" opacity={0.2} />\r\n          <circle className=\"search_svg__cls-3\" cx={17} cy={17} r={14} />\r\n          <path className=\"search_svg__cls-3\" d=\"M44 44L27 27\" />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default SvgSearch;\r\n","import styled from 'styled-components'\r\n// icons\r\nimport { PrevIcon, NextIcon } from 'lib/svg'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst MoveBtn = ({ type, onClick }: Props) => {\r\n  const Icon = type === \"PREV\"\r\n    ? PrevIcon\r\n    : NextIcon;\r\n  \r\n  const msg = type === \"PREV\"\r\n    ? \"이전 페이지\"\r\n    : \"다음 페이지\";\r\n\r\n  return (\r\n    <Container onClick={onClick} title={msg}>\r\n      <Content>\r\n        <Icon />\r\n      </Content>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.button`\r\n  min-width: 60px;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n  }\r\n`;\r\n\r\nconst Content = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n\r\n  & > svg {\r\n    width: 18px;\r\n    height: 18px;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  type: \"PREV\" | \"NEXT\"\r\n  onClick: () => void;\r\n}\r\n\r\nexport default MoveBtn;","// components\r\nimport Wrapper from 'components/footer/Wrapper'\r\nimport Item from 'components/footer/Item'\r\nimport MoveBtn from 'components/footer/MoveBtn'\r\n\r\n\r\nconst Footer = ({ title, nowPage, totalPage, onPageMove }: Props) => {\r\n  return (\r\n    <Wrapper>\r\n      <MoveBtn type=\"PREV\" onClick={() => onPageMove(\"PREV\")} />\r\n      <Item text={title} />\r\n      <Item text={`${nowPage} / ${totalPage}`} />\r\n      <MoveBtn type=\"NEXT\" onClick={() => onPageMove(\"NEXT\")} />\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  title: string;\r\n  nowPage: number;\r\n  totalPage: number;\r\n  onPageMove: (type: \"PREV\" | \"NEXT\") => void;\r\n}\r\n\r\nexport default Footer","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n// icons\r\nimport { CloseIcon } from 'lib/svg'\r\n\r\nconst CloseBtn = ({ onClick }: Props) => {\r\n  return (\r\n    <Btn onClick={onClick}>\r\n      <Icon />\r\n    </Btn>\r\n  );\r\n}\r\n\r\nconst Btn = styled.button`\r\n  position: relative;\r\n  height: 100%;\r\n  padding: 0 24px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n  }\r\n`;\r\n\r\nconst Icon = styled(CloseIcon)`\r\n  width: 18px;\r\n  height: 18px;\r\n`;\r\n\r\ninterface Props {\r\n  onClick: () => void;\r\n}\r\n\r\nexport default CloseBtn;","import React from 'react'\r\nimport styled from 'styled-components'\r\n// components\r\nimport CloseBtn from 'components/sideMenu/CloseBtn'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport zIndex from 'lib/styles/zIndex'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Wrapper = ({ title, show, onClose, children }: Props, ref: any) => {\r\n  return (\r\n    <Container show={show} ref={ref}>\r\n      <Header>\r\n        <span>{title}</span>\r\n        <CloseBtn onClick={onClose} />\r\n      </Header>\r\n      {children}\r\n    </Container>\r\n  )\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: fixed;\r\n  width: 340px;\r\n  max-width: 95vw;\r\n  height: 100vh;\r\n  top: 0;\r\n  right: 0;\r\n  z-index: ${zIndex.menu};\r\n  box-shadow: -4px 0 8px 0 rgba(0,0,0,.16);\r\n  background-color: ${palette.white};\r\n  border-radius: 16px 0 0 16px;\r\n  transform: ${({ show }: { show: boolean }) => show \r\n    ? `translateX(0px) scale(1)`\r\n    : `translateX(420px) scale(.9)`\r\n  };\r\n  transition: .4s ${styles.transition};\r\n  overflow-y: auto;\r\n  ${styles.scrollbar(0)};\r\n`;\r\n\r\nconst Header = styled.div`\r\n  width: 100%;\r\n  min-height: 64px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding-top: 4px;\r\n\r\n  & > span {\r\n    padding-left: 24px;\r\n    font-size: 21px;\r\n    font-weight: 600;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  title: string;\r\n  show: boolean;\r\n  onClose: () => void;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nexport default React.forwardRef(Wrapper)","import styled from 'styled-components'\r\n\r\nconst BookInfo = ({src=\"\", title ,publisher, author}: Props) => {\r\n  return (\r\n    <Container>\r\n      <BookImg src={src} alt={title} />\r\n      <BookContent>\r\n        <Title>{title}</Title>\r\n        <Info>{publisher}</Info>\r\n        <Info>{author}</Info>\r\n      </BookContent>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  padding: 24px;\r\n`;\r\n\r\nconst BookImg = styled.img`\r\n  margin-right: 12px;\r\n  width: 44%;\r\n  min-width: 120px;\r\n  border-radius: 4px;\r\n  background: #eee;\r\n`;\r\n\r\nconst BookContent = styled.div`\r\n  flex-grow: 1;\r\n`;\r\n\r\nconst Title = styled.div`\r\n  font-weight: 500;\r\n  margin-bottom: 4px;\r\n`;\r\n\r\nconst Info = styled.div`\r\n  font-size: 14px;\r\n  margin-bottom: 4px;\r\n`;\r\n\r\ninterface Props {\r\n  src: string;\r\n  title: string;\r\n  publisher: string;\r\n  author: string;\r\n}\r\n\r\nexport default BookInfo","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst NavItem = ({ message, onClick }: Props) => {\r\n  return (\r\n    <Content onClick={onClick}>\r\n      <span>{message}</span>\r\n    </Content>\r\n  );\r\n}\r\n\r\nconst Content = styled.button`\r\n  width: 100%;\r\n  height: 48px;\r\n  box-sizing: border-box;\r\n  padding: 12px 24px;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  background-color: ${palette.gray0};\r\n  outline: none;\r\n  \r\n  & > span {\r\n    transition: .2s ${styles.transition};\r\n    font-size: 14px;\r\n  }\r\n\r\n  &:focus, &:hover {\r\n    & > span {\r\n      color: ${palette.blue3};\r\n      margin-left: 12px;\r\n    }\r\n  }\r\n\r\n  &:last-child {\r\n    margin-bottom: 32px;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  message: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default NavItem","import React from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport BookInfo from 'components/nav/BookInfo'\r\nimport NavItem from 'components/nav/NavItem'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport Book from 'types/book'\r\nimport Toc from 'types/toc'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\n\r\nconst Nav = ({ control, onToggle, onLocation }: Props, ref: any) => {\r\n  const book = useSelector<RootState, Book>(state => state.book.book);\r\n  const bookToc = useSelector<RootState, Toc[]>(state => state.book.toc);\r\n  \r\n  /** Click nav item */\r\n  const onClickItem = (loc: string) => {\r\n    onLocation(loc);\r\n    onToggle();\r\n  }\r\n\r\n  const Tocs = bookToc.map((t, idx) => \r\n    <NavItem key={idx}\r\n             message={t.label}\r\n             onClick={() => onClickItem(t.href)} />\r\n  );\r\n  \r\n  \r\n  return (<>\r\n    {control.display && <Wrapper title=\"Contents\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref}>\r\n      <BookInfo \r\n        src={book.coverURL}\r\n        title={book.title}\r\n        publisher={book.publisher}\r\n        author={book.author} \r\n      />\r\n      {Tocs}\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  onToggle: () => void;\r\n  onLocation: (loc: string) => void;\r\n}\r\n\r\nexport default React.forwardRef(Nav)","import styled from 'styled-components'\r\n\r\nconst Wrapper = styled.div`\r\n  box-sizing: border-box;\r\n  padding: 24px;\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n\r\nconst OptionWrapper = styled.div`\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nexport default OptionWrapper","import styled from 'styled-components'\r\n\r\nconst OptionTitle = styled.div`\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  margin-bottom: 16px;\r\n`;\r\n\r\nexport default OptionTitle","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n// icons\r\nimport { DownIcon } from 'lib/svg'\r\n\r\nconst DropdownValue = ({ value, isDropdown, onClick }: Props) => {\r\n  return (\r\n    <Container \r\n      onClick={onClick}\r\n      isDropdown={isDropdown}\r\n      title=\"Select font\"\r\n    >\r\n      <Content>{value}</Content>\r\n      <Icon isDropdown={isDropdown}>\r\n        <DownIcon />\r\n      </Icon>\r\n    </Container>\r\n  );\r\n}\r\n\r\nconst Container = styled.button<{isDropdown: boolean}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  position: relative;\r\n  width: 100%;\r\n  height: 40px;\r\n  background-color: ${palette.white};\r\n  border: ${({isDropdown}) => isDropdown\r\n    ? `2px solid ${palette.blue3}`\r\n    : `2px solid ${palette.gray1}`\r\n  };\r\n  border-radius: ${({isDropdown}) => isDropdown\r\n    ? \"20px 20px 0 0\"\r\n    : \"20px\"\r\n  };\r\n  box-sizing: border-box;\r\n  padding: 0px 16px;\r\n  cursor: pointer;\r\n  z-index: 4;\r\n  transition: .1s ${styles.transition};\r\n  text-align: left;\r\n  outline: none;\r\n\r\n  &:hover, &:focus {\r\n    border: 2px solid ${palette.blue3};\r\n\r\n    & > div {\r\n      opacity: 1;\r\n      filter: invert(40%) sepia(85%) saturate(1256%) hue-rotate(210deg) brightness(113%) contrast(101%);\r\n    }\r\n  }\r\n`;\r\n\r\nconst Content = styled.span`\r\n  flex-grow: 1;\r\n  margin-right: 16px;\r\n  font-size: 14px;\r\n`;\r\n\r\nconst Icon = styled.div<{isDropdown: boolean}>`\r\n  display: flex;\r\n  width: 12px;\r\n  height: 12px;\r\n  opacity: .3;\r\n  \r\n  & > svg {\r\n    transform-origin: center;\r\n    transform: ${({isDropdown}) => isDropdown\r\n      ? 'rotate(180deg)'\r\n      : 'rotate(0deg)'\r\n    };\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  value: string;\r\n  isDropdown: boolean;\r\n  onClick: (e: any) => void;\r\n}\r\n\r\nexport default DropdownValue","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst DropdownItemWrapper = ({ show, children }: Props) => {\r\n  return <Container show={show}>{children}</Container>\r\n}\r\n\r\nconst Container = styled.div<{show: boolean}>`\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  max-height: 200px;\r\n  overflow-y: auto;\r\n  box-sizing: border-box;\r\n  padding: 0 0 16px 0;\r\n  background-color: ${palette.white};\r\n  border: 2px solid ${palette.blue3};\r\n  z-index: 3;\r\n  border-radius: ${({show}) => show\r\n    ? '0 0 20px 20px'\r\n    : '20px'\r\n  };\r\n  transition: .4s ${styles.transition};\r\n  opacity: ${({show}) => show\r\n    ? '1'\r\n    : '0'\r\n  };\r\n  transform-origin: top;\r\n  transform: ${({show}) => show\r\n    ? 'translateY(-2px) scaleY(1);'\r\n    : 'translateY(-40px) scaleY(0);'\r\n  };\r\n  ${styles.scrollbar(6)}\r\n  ${({show}) => show\r\n    ? ''\r\n    : styles.noselect\r\n  };\r\n`;\r\n\r\ninterface Props {\r\n  show: boolean;\r\n  children: React.ReactElement[];\r\n}\r\n\r\nexport default DropdownItemWrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst DropdownItem = ({ value, onClick }: Props) => {\r\nconst text = value === \"Origin\" ? \"Original\" : value;\r\n\r\n  return <Container onClick={onClick}>{text}</Container>;\r\n}\r\n\r\nconst Container = styled.button`\r\n  width: 100%;\r\n  height: 40px;\r\n  box-sizing: border-box;\r\n  padding: 0 16px;\r\n  transition: .1s ${styles.transition};\r\n  font-size: 14px;\r\n  line-height: 40px;\r\n  cursor: pointer;\r\n  text-align: left;\r\n  outline: none;\r\n  \r\n  &:focus, &:hover {\r\n    background-color: rgba(0,0,0,.05);\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  value: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default DropdownItem","import { useState, useEffect, useRef, useCallback } from 'react'\r\nimport styled from 'styled-components'\r\n// components\r\nimport OptionWrapper from 'components/option/OptionWrapper'\r\nimport OptionTitle from 'components/option/OptionTitle'\r\nimport DropdownValue from 'components/option/DropdownValue'\r\nimport DropdownItemWrapper from 'components/option/DropdownItemWrapper'\r\nimport DropdownItem from 'components/option/DropdownItem'\r\n// types\r\nimport { BookFontFamily } from 'types/book'\r\n\r\nconst Dropdown = ({\r\n  title,\r\n  defaultValue,\r\n  valueList,\r\n  onSelect\r\n}: Props) => {\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n  const [visible, setVisible] = useState<boolean>(false);\r\n  const value = defaultValue === \"Origin\" ? \"Original\" : defaultValue;\r\n  \r\n  /** Toggle dropdown */\r\n  const onToggle = useCallback(() => setVisible(!visible), [visible]);\r\n\r\n  /** Close dropdown */\r\n  const onClose = useCallback((e: any) => {\r\n    if (!ref || !ref.current) return;\r\n    if (![...e.path].includes(ref.current)) {\r\n      onToggle();\r\n    }\r\n  }, [ref, onToggle]);\r\n\r\n  const Items = valueList.map(font => \r\n    <DropdownItem key={font} value={font} onClick={() => {\r\n      onSelect(font);\r\n      onToggle();\r\n    }} />\r\n  );\r\n\r\n  /** Register dropdown close event */\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('click', onClose);\r\n    } else {\r\n      document.removeEventListener('click', onClose);\r\n    }\r\n    return () => {\r\n      document.removeEventListener('click', onClose);\r\n    }\r\n  }, [visible, onClose]);\r\n\r\n  return (\r\n    <OptionWrapper>\r\n      <OptionTitle>{title}</OptionTitle>\r\n\r\n      <DropdownWrapper ref={ref}>\r\n        <DropdownValue value={value} \r\n                       isDropdown={visible} \r\n                       onClick={onToggle} />\r\n        <DropdownItemWrapper show={visible}>\r\n          {Items}\r\n        </DropdownItemWrapper>\r\n      </DropdownWrapper>\r\n    </OptionWrapper>\r\n  );\r\n}\r\n\r\nconst DropdownWrapper = styled.div`\r\n  position: relative;\r\n`;\r\n\r\ninterface Props {\r\n  title: string;\r\n  defaultValue: BookFontFamily;\r\n  valueList: BookFontFamily[];\r\n  onSelect: (font: BookFontFamily) => void;\r\n}\r\n\r\nexport default Dropdown","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst OptionValue = styled.span<{ active: boolean }>`\r\n  display: inline-block;\r\n  font-size: 14px;\r\n  color: ${props => props.active\r\n    ? palette.blue3\r\n    : palette.gray4\r\n  };\r\n  margin-right: 8px;\r\n  width: 40px;\r\n  text-align: right;\r\n  line-height: 20px;\r\n`;\r\n\r\nexport default OptionValue","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst SliderValue = ({ \r\n  active, \r\n  minValue, \r\n  maxValue, \r\n  defaultValue, \r\n  step, \r\n  onChange \r\n}: Props) => {\r\n  const percentage = Math.round((defaultValue - minValue) / (maxValue - minValue) * 100);\r\n\r\n  return (<>\r\n    <Icon>-</Icon>\r\n    <SliderWrapper>\r\n      <SliderBackground />\r\n      <SliderBar \r\n        active={active}\r\n        percentage={percentage}\r\n      />\r\n      <Slider\r\n        type=\"range\" \r\n        min={minValue}\r\n        max={maxValue}\r\n        defaultValue={defaultValue}\r\n        step={step}\r\n        onChange={onChange}\r\n        active={active}\r\n        disabled={!active} />\r\n    </SliderWrapper>\r\n    <Icon>+</Icon>\r\n  </>);\r\n}\r\n\r\nconst SliderWrapper = styled.div`\r\n  flex-grow: 1;\r\n  display: flex;\r\n  position: relative;\r\n  width: auto;\r\n`;\r\n\r\nconst SliderBackground = styled.div`\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 6px;\r\n  background-color: #eee;\r\n  border-radius: 6px;\r\n  z-index: 0;\r\n`;\r\n\r\nconst SliderBar = styled.div<{ percentage: number, active: boolean }>`\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 0;\r\n  transform: translateY(-50%);\r\n  width: ${({ percentage }) => percentage + '%'};\r\n  height: 6px;\r\n  border-radius: 6px 0 0 6px;\r\n  background-color: ${props => props.active\r\n    ? palette.blue4\r\n    : palette.gray2\r\n  };\r\n\tz-index: 1;\r\n`;\r\n\r\nconst Slider = styled.input<{ active: boolean }>`\r\n  appearance: none;\r\n  width: 100%;\r\n  height: 6px;\r\n  background-color: transparent;\r\n  border-radius: 6px;\r\n  margin: 0;\r\n  z-index: 2;\r\n  outline: none;\r\n  \r\n  &::-webkit-slider-thumb {\r\n    appearance: none;\r\n    width: 18px;\r\n    height: 18px;\r\n    border-radius: 18px;\r\n    box-shadow: ${styles.boxShadow.regular};\r\n    background-color: white;\r\n    transition: .2s ${styles.transition};\r\n    transition-property: box-shadow, background-color;\r\n    border: ${props => props.active\r\n      ? `2px solid ${palette.blue3}`\r\n      : `2px solid ${palette.gray4}`\r\n    };\r\n    cursor: ${props => props.active\r\n        ? 'pointer'\r\n        : ''\r\n      };;\r\n\r\n    &:hover {\r\n      background-color: ${props => props.active\r\n        ? palette.blue1\r\n        : ''\r\n      };\r\n    }\r\n\r\n    &:active {\r\n      box-shadow: none;\r\n      background-color: ${props => props.active\r\n        ? palette.blue3\r\n        : ''\r\n      };\r\n    }\r\n  }\r\n\r\n  &:focus::-webkit-slider-thumb {\r\n    box-shadow: none;\r\n    background-color: ${palette.blue3};\r\n  }\r\n`;\r\n\r\nconst Icon = styled.span`\r\n  font-size: 12px;\r\n  font-weight: 500;\r\n  color: ${palette.gray4};\r\n  margin: 0 8px;\r\n  line-height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  minValue: number;\r\n  maxValue: number;\r\n  defaultValue: number;\r\n  step: number;\r\n  onChange: (e: any) => void;\r\n}\r\n\r\nexport default SliderValue","import styled from 'styled-components'\r\n// components\r\nimport OptionWrapper from 'components/option/OptionWrapper'\r\nimport OptionTitle from 'components/option/OptionTitle'\r\nimport OptionValue from 'components/option/OptionValue'\r\nimport SliderValue from 'components/option/SliderValue'\r\n\r\nconst Slider = ({\r\n  active,\r\n  title,\r\n  minValue,\r\n  maxValue,\r\n  defaultValue,\r\n  step,\r\n  onChange\r\n}: Props) => {\r\n  const onChangeValue = (e: any) => {\r\n    if (!active) return;\r\n    onChange(e);\r\n  }\r\n  \r\n  \r\n  return (\r\n    <OptionWrapper>\r\n      <OptionTitle>{title}</OptionTitle>\r\n      \r\n      <SliderWrapper>\r\n        <OptionValue active={active}>{defaultValue}</OptionValue>\r\n        <SliderValue active={active}\r\n                     minValue={minValue}\r\n                     maxValue={maxValue}\r\n                     defaultValue={defaultValue}\r\n                     step={step}\r\n                     onChange={onChangeValue} />\r\n      </SliderWrapper>\r\n    </OptionWrapper>\r\n  );\r\n}\r\n\r\nconst SliderWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  title: string;\r\n  minValue: number;\r\n  maxValue: number;\r\n  defaultValue: number;\r\n  step: number;\r\n  onChange: (e: any) => void;\r\n}\r\n\r\nexport default Slider","import styled from 'styled-components'\r\n// components\r\nimport OptionWrapper from 'components/option/OptionWrapper'\r\nimport OptionTitle from 'components/option/OptionTitle'\r\n\r\nconst ControlIconBtnWrapper = ({ title, children }: Props) => {\r\n\treturn (\r\n\t\t<OptionWrapper>\r\n\t\t\t<OptionTitle>{title}</OptionTitle>\r\n\t\t\t<BtnWrapper>\r\n\t\t\t\t{children}\r\n\t\t\t</BtnWrapper>\r\n\t\t</OptionWrapper>\r\n\t);\r\n}\r\n\r\nconst BtnWrapper = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: space-around;\r\n\tpadding: 8px 0;\r\n`;\r\n\r\ninterface Props {\r\n\ttitle: string;\r\n\tchildren: any[]\r\n}\r\n\r\nexport default ControlIconBtnWrapper","import styled, { css } from 'styled-components'\r\n// icons\r\nimport { \r\n  ScrollHorizontalIcon,\r\n  ScrollVerticalIcon,\r\n  BookCloseIcon,\r\n  BookOpenIcon\r\n} from 'lib/svg'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ControlIconBtn = ({ type, alt, active, isSelected, onClick }: Props) => {\r\n  let HeaderIcon = null;\r\n  switch (type) {\r\n    case \"ScrollVertical\":\r\n      HeaderIcon = ScrollVerticalIcon;\r\n      break;\r\n    case \"ScrollHorizontal\":\r\n      HeaderIcon = ScrollHorizontalIcon;\r\n      break;\r\n    case \"BookOpen\":\r\n      HeaderIcon = BookOpenIcon;\r\n      break;\r\n    case \"BookClose\":\r\n      HeaderIcon = BookCloseIcon;\r\n      break;\r\n  }\r\n  \r\n  const onClickBtn = () => {\r\n    if (active) onClick();\r\n  }\r\n\r\n  return (\r\n    <Btn \r\n      onClick={onClickBtn} \r\n      isSelected={isSelected}\r\n      active={active}\r\n      title={alt}\r\n    >\r\n      <Icon>\r\n        <HeaderIcon />\r\n      </Icon>\r\n    </Btn>\r\n  );\r\n}\r\n\r\nconst Btn = styled.button<{ isSelected: boolean, active: boolean }>`\r\n  position: relative;\r\n  height: 100%;\r\n  padding: 0 12px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 0;\r\n  transition: .3s ${styles.transition};\r\n  opacity: ${({active}) => active\r\n    ? '1'\r\n    : '.3'\r\n  };\r\n  cursor: ${({active}) => active\r\n    ? 'pointer'\r\n    : 'default'\r\n  };\r\n  outline: none;\r\n\r\n  &::before {\r\n    content: '';\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    top: 0;\r\n    bottom: 0;\r\n    margin: auto;\r\n    z-index: -1;\r\n    border-radius: 30px;\r\n    width: ${({isSelected}) => isSelected\r\n      ? '32px'\r\n      : '8px'\r\n    };\r\n    height: ${({isSelected}) => isSelected\r\n      ? '32px'\r\n      : '8px'\r\n    };\r\n    opacity: ${({active, isSelected}) => active && isSelected\r\n      ? '.7'\r\n      : '0'\r\n    };\r\n    transition: .1s ${styles.transition};\r\n    background-color: ${palette.blue1};\r\n  }\r\n\r\n  &:focus, &:hover {\r\n    ${({active}) => active\r\n      ? css`\r\n        &:before {\r\n          width: 32px;\r\n          height: 32px;\r\n          opacity: 1;\r\n        }\r\n      `\r\n      : \"\"\r\n    };\r\n    \r\n  }\r\n`;\r\n\r\nconst Icon = styled.div`\r\n  width: 16px;\r\n  height: 16px;\r\n\r\n  & > div, & > svg {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n`;\r\n\r\ntype HeaderIcon = \r\n  \"ScrollHorizontal\" |\r\n  \"ScrollVertical\" |\r\n  \"BookOpen\" |\r\n  \"BookClose\";\r\n\r\ninterface Props {\r\n  type: HeaderIcon;\r\n  alt: string;\r\n  active: boolean;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default ControlIconBtn","import React from 'react'\r\nimport { useState, useEffect } from 'react'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport OptionLayout from 'components/option/Layout'\r\nimport OptionDropdown from 'components/option/Dropdown'\r\nimport OptionSlider from 'components/option/Slider'\r\nimport ControlIconBtnWrapper from 'components/option/ControlIconBtnWrapper'\r\nimport ControlIconBtn from 'components/option/ControlIconBtn'\r\n// types\r\nimport { BookStyle, BookFontFamily, BookFlow } from 'types/book'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\nimport { BookOption } from 'types/book'\r\n\r\nconst Option = ({ \r\n  control, \r\n  bookStyle,\r\n  bookOption,\r\n  bookFlow,\r\n  onToggle, \r\n  emitEvent,\r\n  onBookStyleChange,\r\n  onBookOptionChange\r\n}: Props, ref: any) => {\r\n  const [fontFamily, setFontFamily] = useState<BookFontFamily>(bookStyle.fontFamily);\r\n  const [fontSize, setFontSize] = useState<number>(bookStyle.fontSize);\r\n  const [lineHeight, setLineHeight] = useState<number>(bookStyle.lineHeight);\r\n  const [marginHorizontal, setMarginHorizontal] = useState<number>(bookStyle.marginHorizontal);\r\n  const [marginVertical, setMarginVertical] = useState<number>(bookStyle.marginVertical);\r\n  const [isScrollHorizontal, setIsScrollHorizontal] = useState<boolean>(true);\r\n  const [viewType, setViewType] = useState<ViewType>({\r\n    active: true,\r\n    spread: true\r\n  });\r\n\r\n\r\n  /** Change font family */\r\n  const onSelectFontFamily = (font: BookFontFamily) => setFontFamily(font);\r\n\r\n  /** Change font style and layout */\r\n  const onChangeSlider = (type: SliderType, e: any) => {\r\n    if (!e || !e.target) return;\r\n    switch (type) {\r\n      case \"FontSize\":\r\n        setFontSize(e.target.value);\r\n        break;\r\n      case \"LineHeight\":\r\n        setLineHeight(e.target.value);\r\n        break;\r\n      case \"MarginHorizontal\":\r\n        setMarginHorizontal(e.target.value);\r\n        break;\r\n      case \"MarginVertical\":\r\n        setMarginVertical(e.target.value);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /** \r\n   * Select view direction\r\n   * @param type Direction\r\n   */\r\n   const onClickDirection = (type: \"Horizontal\" | \"Vertical\") => {\r\n    if (type === \"Horizontal\") {\r\n      setIsScrollHorizontal(true);\r\n      setViewType({ ...viewType, active: true });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        flow: \"paginated\"\r\n      });\r\n    } else {\r\n      setIsScrollHorizontal(false);\r\n      setViewType({ ...viewType, active: false });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        flow: \"scrolled-doc\"\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select isSpread\r\n   * @param isSpread Whether spread view \r\n   */\r\n  const onClickViewType = (isSpread: boolean) => {\r\n    if (isSpread) {\r\n      setViewType({ ...viewType, spread: true });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        spread: \"auto\"\r\n      });\r\n    } else {\r\n      setViewType({ ...viewType, spread: false });\r\n      onBookOptionChange({\r\n        ...bookOption,\r\n        spread: \"none\"\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  /* Save userdata */\r\n  // TODO Fix the infinite re-rendering issue, when inlcude `onBookStyleChange` to dependencies array.\r\n  /* eslint-disable */\r\n  useEffect(() => {\r\n    const timer = window.setTimeout(() => { \r\n      onBookStyleChange({\r\n        fontFamily,\r\n        fontSize,\r\n        lineHeight,\r\n        marginHorizontal,\r\n        marginVertical\r\n      });\r\n    }, 250);\r\n\r\n    return () => window.clearTimeout(timer);\r\n  }, [\r\n    fontFamily, \r\n    fontSize, \r\n    lineHeight, \r\n    marginHorizontal, \r\n    marginVertical\r\n  ]);\r\n  /* eslint-enable */\r\n\r\n  /** Re-register close event, when after set */\r\n  useEffect(() => emitEvent(), [bookStyle, emitEvent]);\r\n\r\n  \r\n  return (<>\r\n    {control.display && <Wrapper title=\"Setting\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref}>\r\n      <OptionLayout>\r\n        <ControlIconBtnWrapper title=\"View Direction\">\r\n          <ControlIconBtn type=\"ScrollHorizontal\"\r\n                          alt=\"Horizontal View\"\r\n                          active={true}\r\n                          isSelected={isScrollHorizontal}\r\n                          onClick={() => onClickDirection(\"Horizontal\")} />\r\n          <ControlIconBtn type=\"ScrollVertical\" \r\n                          alt=\"Vertical View\"\r\n                          active={true}\r\n                          isSelected={!isScrollHorizontal}\r\n                          onClick={() => onClickDirection(\"Vertical\")} />\r\n        </ControlIconBtnWrapper>\r\n        <ControlIconBtnWrapper title=\"View Spread\">\r\n          <ControlIconBtn type=\"BookOpen\" \r\n                          alt=\"Two Page View\"\r\n                          active={viewType.active}\r\n                          isSelected={viewType.spread}\r\n                          onClick={() => onClickViewType(true)} />\r\n          <ControlIconBtn type=\"BookClose\" \r\n                          alt=\"One Page View\"\r\n                          active={viewType.active}\r\n                          isSelected={!viewType.spread}\r\n                          onClick={() => onClickViewType(false)} />\r\n        </ControlIconBtnWrapper>\r\n        <OptionDropdown title=\"Font\"\r\n                        defaultValue={fontFamily}\r\n                        valueList={[\"Origin\", \"Roboto\"]}\r\n                        onSelect={onSelectFontFamily} />\r\n        <OptionSlider active={true}\r\n                      title=\"Size\"\r\n                      minValue={8}\r\n                      maxValue={36}\r\n                      defaultValue={fontSize}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"FontSize\", e)} />\r\n        <OptionSlider active={true}\r\n                      title=\"Line height\"\r\n                      minValue={1}\r\n                      maxValue={3}\r\n                      defaultValue={lineHeight}\r\n                      step={0.1}\r\n                      onChange={(e) => onChangeSlider(\"LineHeight\", e)} />\r\n        <OptionSlider active={true}\r\n                      title=\"Horizontal margin\"\r\n                      minValue={0}\r\n                      maxValue={100}\r\n                      defaultValue={marginHorizontal}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"MarginHorizontal\", e)} />\r\n        <OptionSlider active={bookFlow === \"paginated\"}\r\n                      title=\"Vertical margin\"\r\n                      minValue={0}\r\n                      maxValue={100}\r\n                      defaultValue={marginVertical}\r\n                      step={1}\r\n                      onChange={(e) => onChangeSlider(\"MarginVertical\", e)} />\r\n      </OptionLayout>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  bookStyle: BookStyle;\r\n  bookOption: BookOption;\r\n  bookFlow: BookFlow;\r\n  onToggle: () => void;\r\n  emitEvent: () => void;\r\n  onBookStyleChange: (bookStyle: BookStyle) => void;\r\n  onBookOptionChange: (bookOption: BookOption) => void;\r\n}\r\n\r\ntype SliderType = \"FontSize\" \r\n  | \"LineHeight\" \r\n  | \"MarginHorizontal\" \r\n  | \"MarginVertical\";\r\n\r\ntype ViewType = {\r\n  active: boolean,\r\n  spread: boolean\r\n}\r\n\r\nexport default React.forwardRef(Option)","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst Wrapper = styled.button`\r\n  padding: 16px 24px;\r\n  display: flex;\r\n  align-items: flex-start;\r\n  justify-content: flex-start;\r\n  background-color: ${palette.gray0};\r\n  transition: .1s ${styles.transition};\r\n  cursor: pointer;\r\n  outline: none;\r\n  text-align: left;\r\n  border-bottom: 1px solid ${palette.gray1};\r\n  \r\n  &:nth-child(2) {\r\n    border-top: 1px solid ${palette.gray1};\r\n  }\r\n\r\n  & > div {\r\n    color: inherit;\r\n    flex-grow: 1;\r\n  }\r\n\r\n  &:hover > *, &:focus > * {\r\n    color: ${palette.blue3};\r\n  }\r\n`;\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n\r\nconst Title = styled.div`\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  color: inherit;\r\n`;\r\n\r\nexport default Title","import styled from 'styled-components'\r\n\r\nconst Post = styled.div<{ color: string }>`\r\n  position: relative;\r\n  font-size: 14px;\r\n  margin-top: 16px;\r\n  padding: 8px;\r\n  box-sizing: border-box;\r\n\r\n  &::before {\r\n    content: '';\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n    background-color: ${({ color }) => color};\r\n    opacity: .3;\r\n    border-radius: 8px;\r\n    mix-blend-mode: multiply;\r\n  }\r\n`;\r\n\r\nexport default Post","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n// types\r\nimport Book from 'types/book'\r\nimport Page from 'types/page'\r\nimport Toc from 'types/toc'\r\nimport Highlight, { Color } from 'types/highlight'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\n\r\n/* \r\n\tInitial State\r\n*/\r\n\r\n/** 초기 Book 상태 */\r\nconst initialBook: Book = {\r\n\tcoverURL: '',\r\n\ttitle: '',\r\n\tdescription: '',\r\n\tpublished_date: '',\r\n\tmodified_date: '',\r\n\tauthor: '',\r\n\tpublisher: '',\r\n\tlanguage: ''\r\n}\r\n\r\n/** 초기 CurrentPage 상태 */\r\nconst initialCurrentLocation: Page = {\r\n\tchapterName: \"-\",\r\n\tcurrentPage: 0,\r\n\ttotalPage: 0,\r\n\tstartCfi: '',\r\n\tendCfi: '',\r\n\tbase: ''\r\n}\r\n\r\n/** 초기 색상표 상태 */\r\nconst initialColorList: Color[] = [\r\n\t{ name: 'Red', code: palette.red4 },\r\n\t{ name: 'Orange', code: palette.orange4 },\r\n\t{ name: 'Yellow', code: palette.yellow4 },\r\n\t{ name: 'Green', code: palette.green4 },\r\n\t{ name: 'Blue', code: palette.blue4 },\r\n\t{ name: 'Purple', code: palette.purple4 }\r\n]\r\n\r\nconst initialState: BookState = {\r\n\tbook: initialBook,\r\n\tcurrentLocation: initialCurrentLocation,\r\n\ttoc: [],\r\n\thighlights: [],\r\n\tcolorList: initialColorList,\r\n}\r\n\r\n\r\n/* \r\n\tSlice\r\n*/\r\nconst bookSlice = createSlice({\r\n\tname: 'book',\r\n\tinitialState,\r\n\treducers: {\r\n\t\t/** Book 갱신 @dispatch */\r\n\t\tupdateBook(state, action: PayloadAction<Book>) {\r\n\t\t\tstate.book = action.payload;\r\n\t\t},\r\n\t\t/** CurrentPage 갱신 @dispatch */\r\n\t\tupdateCurrentPage(state, action: PayloadAction<Page>) {\r\n\t\t\tstate.currentLocation = action.payload;\r\n\t\t},\r\n\t\t/** Book 초기화 @dispatch */\r\n\t\tclearBook(state) {\r\n\t\t\tstate.book = initialBook;\r\n\t\t},\r\n\t\t/** 목차 갱신 @dispatch */\r\n\t\tupdateToc(state, action: PayloadAction<Toc[]>) {\r\n\t\t\tstate.toc = action.payload;\r\n\t\t},\r\n\t\t/** 목차 초기화 @dispatch */\r\n\t\tclearToc(state) {\r\n\t\t\tstate.toc = [];\r\n\t\t},\r\n\t\t/** 하이라이트 추가 */\r\n\t\tpushHighlight(state, action: PayloadAction<Highlight>) {\r\n\t\t\tconst check = state.highlights.filter(h => h.key === action.payload.key);\r\n\t\t\tif (check.length > 0) return;\r\n\t\t\tstate.highlights.push(action.payload);\r\n\t\t},\r\n\t\t/** 하이라이트 갱신 */\r\n\t\tupdateHighlight(state, action: PayloadAction<Highlight>) {\r\n\t\t\tconst new_idx = action.payload.key;\r\n\t\t\tconst old_idx = state.highlights.map(h => h.key).indexOf(new_idx);\r\n\t\t\tstate.highlights.splice(old_idx, 1, action.payload);\r\n\t\t},\r\n\t\t/** 하이라이트 삭제 */\r\n\t\tpopHighlight(state, action: PayloadAction<string>) {\r\n\t\t\tconst idx = state.highlights.map(h => h.key).indexOf(action.payload);\r\n\t\t\tstate.highlights.splice(idx, 1);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nexport interface BookState {\r\n\tbook: Book;\r\n\tcurrentLocation: Page;\r\n\ttoc: Toc[];\r\n\thighlights: Highlight[];\r\n\tcolorList: Color[];\r\n}\r\n\r\nexport const { \r\n\tupdateBook,\r\n\tclearBook,\r\n\tupdateCurrentPage,\r\n\tupdateToc,\r\n\tclearToc,\r\n\tpushHighlight,\r\n\tupdateHighlight,\r\n\tpopHighlight\r\n } = bookSlice.actions;\r\n \r\nexport default bookSlice.reducer","import { EpubCFI } from 'epubjs'\r\n// types\r\nimport { BookStyle, BookFlow } from 'types/book'\r\n\r\n\r\n/**\r\n * DateTime to `yyyy-mm-dd`\r\n * @param {Date} time \r\n */\r\n export const timeFormatter = (time: Date): string => {\r\n\tconst yyyy = time.getFullYear();\r\n\tconst mm = time.getMonth() + 1;\r\n\tconst dd = time.getDate();\r\n\tconst msg = `${yyyy}-${mm}-${dd}`;\r\n\r\n\treturn msg;\r\n}\r\n\r\n\r\n/**\r\n * Comparison of two CFI sizes\r\n * - -1 : CFI 1 < CFI 2\r\n * - 0 : CFI 1 == CFI 2\r\n * - 1 : CFI 1 > CFI 2\r\n * @param cfi_1 CFI 1\r\n * @param cfi_2 CFI 2\r\n */\r\nexport const compareCfi = (cfi_1: string, cfi_2: string): number => {\r\n\tconst epubcfi = new EpubCFI();\r\n\treturn epubcfi.compare(cfi_1, cfi_2);\r\n};\r\n\r\n\r\n/**\r\n * Split CFI range into two starting CFI and ending CFI\r\n * - null : Invalid CFIRange\r\n * @param cfiRange CFIRange\r\n */\r\nexport const cfiRangeSpliter = (cfiRange: string) => {\r\n\tconst content = cfiRange.slice(8, -1);\r\n\tconst [origin, start, end] = content.split(',');\r\n\r\n\tif (!origin || !start || !end) return null;\r\n\r\n\tconst startCfi = `epubcfi(${origin + start})`;\r\n\tconst endCfi = `epubcfi(${origin + end})`;\r\n\treturn { startCfi, endCfi }\r\n}\r\n\r\n\r\n/**\r\n * Whether the two CFI ranges nested\r\n * - true : Nested\r\n * - false : Not nested\r\n * - null : Invalid CFIRange\r\n * @param cfiRange1 First CFIRange\r\n * @param cfiRange2 Second CFIRange\r\n */\r\nexport const clashCfiRange = (baseCfiRange: string, targetCfiRange: string) => {\r\n\tconst splitCfi1 = cfiRangeSpliter(baseCfiRange);\r\n\tconst splitCfi2 = cfiRangeSpliter(targetCfiRange);\r\n\r\n\tif (!splitCfi1 || !splitCfi2) return null;\r\n\r\n\tconst { startCfi: s1, endCfi: e1 } = splitCfi1;\r\n\tconst { startCfi: s2, endCfi: e2 } = splitCfi2;\r\n\r\n\tif ((compareCfi(s2, s1) <= 0 && compareCfi(s1, e2) <= 0)\r\n\t\t||(compareCfi(s2, e1) <= 0 && compareCfi(e1, e2) <= 0)\r\n\t\t||(compareCfi(s1, s2) <= 0 && compareCfi(e2, e1) <= 0)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n/**\r\n * Extract paragraph CFI from CFIRange\r\n * - null : Invalid CFIRange\r\n * @param cfiRange CFIRange\r\n */\r\nexport const getParagraphCfi = (cfiRange: string) => {\r\n\tif (!cfiRange) return;\r\n\r\n\tconst content = cfiRange.slice(8, -1);\r\n\tconst [origin, start, end] = content.split(',');\r\n\t\r\n\tif (!origin || !start || !end) return null;\r\n\r\n\tconst cfi = `epubcfi(${origin})`;\r\n\treturn cfi;\r\n}\r\n\r\n\r\n/**\r\n * Get specific DOM Element from CFI\r\n * - **※ Warning**: Other Iframe must not exist in the Reader page!\r\n * @param cfi CFI\r\n * @returns HTML Element or Null\r\n */\r\nexport const getNodefromCfi = (cfi: string): HTMLElement | null => {\r\n\tconst epubcfi = cfi.slice(8, -1);\r\n\r\n\t/* Remove Id */\r\n\tconst pureCfi = epubcfi.replace(/\\[.*?\\]/gi, '');\r\n\r\n\t/* Only CFI Base */\r\n\tconst splitCfi = pureCfi.split('!');\r\n\tif (splitCfi.length < 1 || splitCfi[1] === \"\") {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/* Remove Body tag CFI */\r\n\tconst cfiPath: number[] = splitCfi[1].split('/')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t .slice(2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t .map(x => Number(x));\r\n\r\n\tconst iframe = document.querySelector('iframe');\r\n\tif (!iframe) return null;\r\n\t\r\n\tconst iframeBody = iframe.contentWindow && iframe.contentWindow.document.body;\r\n\tif (!iframeBody) return null;\r\n\r\n\tlet component: HTMLElement | null = iframeBody;\r\n\r\n\t/* Find Node based on CFI */\r\n\tfor (let idx of cfiPath) {\r\n\t\tconst childNodes: any = component && component.childNodes;\r\n\r\n\t\t/* Bookmark / Highlight filtering.. */\r\n\t\tconst filtered = ([...childNodes].filter(n => !n.dataset \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| !n.dataset.bookmark\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| !n.dataset.highlight ));\r\n\t\tcomponent = filtered[idx - 1];\r\n\r\n\t\tif (!component) {\r\n\t\t\tcomponent = null;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn component;\r\n}\r\n\r\n\r\n/**\r\n * Selection absolute location\r\n * @param viewer viewerRef.current\r\n * @param bookStyle bookStyle\r\n * @param bookFlow book-flow\r\n * @param MIN_VIEWER_WIDTH min viewer width\r\n * @param MIN_VIEWER_HEIGHT min viewer height\r\n * @param VIEWER_HEADER_HEIGHT viewer header height\r\n * @param CONTEXTMENU_WIDTH contextmenu width\r\n * @returns Contextmenu location\r\n */\r\nexport const getSelectionPosition = (\r\n\tviewer: any,\r\n\tbookStyle: BookStyle,\r\n\tbookFlow: BookFlow,\r\n\tMIN_VIEWER_WIDTH: number,\r\n\tMIN_VIEWER_HEIGHT: number,\r\n\tVIEWER_HEADER_HEIGHT: number,\r\n\tCONTEXTMENU_WIDTH: number\r\n): { x: number, y: number, height: number, width: number } | null => {\r\n\tconst { \r\n\t\tinnerWidth: windowWidth,\r\n\t\tinnerHeight: windowHeight \r\n\t} = window;\r\n\r\n\tconst iframeWidth = viewer.offsetWidth;\r\n\r\n\tconst scrollTop = viewer.querySelector('div').scrollTop;\r\n\r\n\tconst iframe = viewer.querySelector('iframe');\r\n\tconst selection_ = iframe && iframe.contentWindow && iframe.contentWindow.getSelection();\r\n\tif (!selection_ || selection_.rangeCount === 0) return null;\r\n\r\n\tconst range = selection_.getRangeAt(0);\r\n\tconst {\r\n\t\tx: selectionX,\r\n\t\ty: selectionY,\r\n\t\theight: selectionHeight,\r\n\t\twidth: selectionWidth\r\n\t} = range.getBoundingClientRect();\r\n\r\n\tconst marginLeft = ~~((windowWidth - MIN_VIEWER_WIDTH) / 100 * bookStyle.marginHorizontal / 2);\r\n\tconst marginTop = bookFlow === \"scrolled-doc\"\r\n\t\t? 0\r\n\t\t: ~~((windowHeight - VIEWER_HEADER_HEIGHT - MIN_VIEWER_HEIGHT) / 100 * bookStyle.marginVertical / 2);\r\n\r\n\tconst x = ~~(selectionX % iframeWidth + marginLeft + ( selectionWidth / 2 - CONTEXTMENU_WIDTH / 2));\r\n\tconst y = ~~(selectionY + selectionHeight + VIEWER_HEADER_HEIGHT + marginTop - scrollTop);\r\n\r\n\treturn { \r\n\t\tx, \r\n\t\ty, \r\n\t\theight: selectionHeight, \r\n\t\twidth: selectionWidth \r\n\t};\r\n}\r\n\r\n/**\r\n * Debounce\r\n * @param func Target function\r\n * @param timeout delay\r\n */\r\n export function debounce<Params extends any[]>(\r\n  timeout: number,\r\n  func: (...args: Params) => any,\r\n): (...args: Params) => void {\r\n  let timer: NodeJS.Timeout\r\n  return (...args: Params) => {\r\n    clearTimeout(timer)\r\n    timer = setTimeout(() => {\r\n      func(...args)\r\n    }, timeout)\r\n  }\r\n}","import { useDispatch } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/note/highlight/Wrapper'\r\nimport Title from 'components/note/highlight/Title'\r\nimport Post from 'components/note/highlight/Post'\r\n// slices\r\nimport { updateHighlight } from 'slices/book'\r\n// utils\r\nimport { cfiRangeSpliter } from 'lib/utils/commonUtil'\r\n// types\r\nimport HighlightType from 'types/highlight'\r\n\r\nconst Highlight = ({ \r\n  highlight, \r\n  onClick, \r\n  emitEvent, \r\n  viewerRef\r\n}: Props) => {\r\n  const dispatch = useDispatch();\r\n\r\n\r\n  /** 하이라이트 클릭 */\r\n  const onClickHighlight = () => {\r\n    if (!viewerRef.current) return;\r\n    \r\n    const now = new Date().toISOString();\r\n    dispatch(updateHighlight({\r\n      ...highlight,\r\n      accessTime: now\r\n    }));\r\n\r\n    const splitCfi = cfiRangeSpliter(highlight.cfiRange);\r\n    if (!splitCfi) return;\r\n\r\n    const { startCfi } = splitCfi;\r\n\r\n    viewerRef.current.setLocation(startCfi);\r\n\r\n    emitEvent();\r\n\r\n    const svgContainer = viewerRef.current.querySelector(\"svg\");\r\n    if (!svgContainer) return;\r\n\r\n    const targetSvg = svgContainer.querySelector(`g[data-epubcfi=\"${highlight.cfiRange}\"]`);\r\n    if (!targetSvg) return;\r\n\r\n    onClick(targetSvg.childNodes[0]);\r\n  }\r\n  \r\n  return (\r\n    <Wrapper onClick={onClickHighlight}>\r\n      <div>\r\n        <Title>{highlight.chpaterName}</Title>\r\n\r\n        <Post color={highlight.color}>{highlight.content}</Post>\r\n      </div>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  highlight: HighlightType;\r\n  onClick: (highlightNode: any) => void;\r\n  emitEvent: () => void;\r\n  viewerRef: any;\r\n}\r\n\r\nexport default Highlight","import styled from 'styled-components'\r\n\r\nconst Layout = styled.div`\r\n  flex-grow: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-sizing: border-box;\r\n  padding: 24px 0;\r\n`;\r\n\r\nexport default Layout","import styled from 'styled-components'\r\n// lib\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst MenuEmpty = ({ text }: Props) => {\r\n  return <Content>{text}</Content>;\r\n}\r\n\r\nconst Content = styled.div`\r\n  flex-grow: 1;\r\n  height: auto;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: ${palette.blue2};\r\n  font-size: 14px;\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n}\r\n\r\nexport default MenuEmpty","import React, { useState, useEffect } from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// containers\r\nimport Highlight from 'containers/menu/commons/Highlight'\r\n// components\r\nimport Wrapper from 'components/sideMenu/Wrapper'\r\nimport LearningLayout from 'components/note/Layout'\r\nimport MenuEmpty from 'components/sideMenu/MenuEmpty'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport HighlightType from 'types/highlight'\r\nimport { MenuControl } from 'lib/hooks/useMenu'\r\n\r\n\r\nconst Note = ({ \r\n  control, \r\n  onToggle, \r\n  onClickHighlight, \r\n  emitEvent,\r\n  viewerRef \r\n}: Props, ref: any) => {\r\n  const highlights = useSelector<RootState, HighlightType[]>(state => state.book.highlights);\r\n  const [highlightList, setHighlightList] = useState<any[]>([]);\r\n\r\n\r\n  /** Set highlight contents */\r\n  useEffect(() => {\r\n    const Items = highlights.map(h => <Highlight key={h.key} \r\n                                                 highlight={h}\r\n                                                 onClick={onClickHighlight} \r\n                                                 emitEvent={emitEvent}\r\n                                                 viewerRef={viewerRef} />\r\n    );\r\n    setHighlightList(Items); \r\n  }, [\r\n    viewerRef,\r\n    highlights,\r\n    onClickHighlight,\r\n    emitEvent,\r\n    setHighlightList\r\n  ]);\r\n\r\n\r\n  return (<>\r\n    {control.display && <Wrapper title=\"Highlight\"\r\n                                 show={control.open}\r\n                                 onClose={onToggle}\r\n                                 ref={ref} >\r\n      <LearningLayout>\r\n        {highlightList.length > 0\r\n          ? highlightList\r\n          : <MenuEmpty text=\"Empty highlights!\" />\r\n        }\r\n      </LearningLayout>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  control: MenuControl;\r\n  onToggle: () => void;\r\n  onClickHighlight: (highlightNode: any) => void;\r\n  emitEvent: () => void;\r\n  viewerRef: any;\r\n}\r\n\r\nexport default React.forwardRef(Note)","import ViewerLayout from 'types/viewerLayout'\r\n\r\n/** Epub viewer layout size */\r\nconst viewerLayout: ViewerLayout = {\r\n  MIN_VIEWER_WIDTH: 300,  \r\n  MIN_VIEWER_HEIGHT: 300,\r\n  VIEWER_HEADER_HEIGHT: 64,\r\n  VIEWER_FOOTER_HEIGHT: 60,\r\n\tVIEWER_SIDEMENU_WIDTH: 0\r\n}\r\n\r\nexport const contextmenuWidth = 160;\r\n\r\nexport default viewerLayout","import styled, { css } from 'styled-components'\r\n// lib\r\nimport { contextmenuWidth } from 'lib/styles/viewerLayout'\r\nimport * as styles from 'lib/styles/styles'\r\nimport zIndex from 'lib/styles/zIndex'\r\n\r\nconst Wrapper = styled.div<Props>`\r\n  position: absolute;\r\n  left: ${({ x }) => window.innerWidth < x + contextmenuWidth\r\n    ? `${window.innerWidth - contextmenuWidth}px`\r\n    : `${x}px`\r\n  };\r\n  top: ${({ y }) => window.innerHeight < y + 40\r\n    ? `${window.innerHeight - 40}px`\r\n    : `${y}px`\r\n  };\r\n  width: ${({ width }) => width + 'px'};\r\n  height: ${({ height }) => height + 'px'};\r\n  box-sizing: border-box;\r\n  padding: ${({ width }) => width > 0\r\n    ? `4px`\r\n    : ``\r\n  };\r\n  border-radius: 8px;\r\n  background-color: rgba(0,0,0,.8);\r\n  box-shadow: ${styles.boxShadow.regular};\r\n  z-index: ${zIndex.menu};\r\n\r\n  & > div:first-child {\r\n    height: 100%;\r\n    overflow-y: auto;\r\n    ${styles.scrollbar(0)};\r\n  }\r\n\r\n  &::before {\r\n    display: ${({ width }) => width > 0\r\n      ? `black`\r\n      : `none`\r\n    };\r\n    content: \"\";\r\n    position: absolute;\r\n    left: 80px;\r\n    ${({ isReverse }) => isReverse\r\n      ? css`bottom: -16px;`\r\n      : css`top: -16px;`\r\n    }\r\n    transform: translateX(-8px);\r\n    border: 8px solid rgba(0,0,0,0);\r\n    ${({ isReverse }) => isReverse\r\n      ? css`border-top: 8px solid rgba(0,0,0,.8);`\r\n      : css`border-bottom: 8px solid rgba(0,0,0,.8);`\r\n    }\r\n    z-index: 1;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  isReverse: boolean;\r\n}\r\n\r\nexport default Wrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst ColorItem = ({ name, color, onClick }: Props) => {\r\n  const onClickItem = (e: any) => {\r\n    onClick();\r\n    e.target.blur();\r\n  };\r\n\r\n  return (\r\n    <Wrapper onClick={onClickItem}>\r\n      <ColorWrapper>\r\n        <Color color={color} />\r\n      </ColorWrapper>\r\n      <Message>{name}</Message>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\nconst Wrapper = styled.button`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  height: 32px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  background-color: rgba(0,0,0,0);\r\n  transition: .1s ${styles.transition};\r\n  outline: none;\r\n\r\n  &:hover, &:focus {\r\n    background-color: ${palette.blue3};\r\n\r\n    & > span {\r\n      color: #fff;\r\n    }\r\n  }\r\n`;\r\n\r\nconst ColorWrapper = styled.div`\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 16px;\r\n  background-color: #fff;\r\n  margin-right: 16px;\r\n`;\r\n\r\nconst Color = styled.div<{ color: string }>`\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 16px;\r\n  background-color: ${({ color }) => color};\r\n  opacity: .4;\r\n`;\r\n\r\nconst Message = styled.span`\r\n  width: 48px;\r\n  font-size: 14px;\r\n  color: #ddd;\r\n  line-height: 20px;\r\n`;\r\n\r\ninterface Props {\r\n  name: string;\r\n  color: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default ColorItem","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport palette from 'lib/styles/palette'\r\n\r\nconst Item = ({ text, onClick }: Props) => {\r\n  return <Container onClick={onClick}>{text}</Container>;\r\n}\r\n\r\nconst Container = styled.button`\r\n  width: 100%;\r\n  height: 32px;\r\n  line-height: 32px;\r\n  text-align: center;\r\n  font-size: 14px;\r\n  color: #ccc;\r\n  transition: .1s ${styles.transition};\r\n  background-color: rgba(0,0,0,0);\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  outline: none;\r\n\r\n  &:focus, &:hover {\r\n    color: #fff;\r\n    background-color: ${palette.red3};\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  text: string;\r\n  onClick: (e?: any) => void;\r\n}\r\n\r\nexport default Item","import { useState, useEffect, useCallback, useRef } from 'react'\r\nimport { useSelector } from 'react-redux'\r\n// components\r\nimport Wrapper from 'components/contextMenu/Wrapper'\r\nimport ColorItem from 'components/contextMenu/ColorItem'\r\nimport Item from 'components/contextMenu/Item'\r\n// utils\r\nimport { getParagraphCfi } from 'lib/utils/commonUtil'\r\n// slices\r\nimport { contextmenuWidth } from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport Highlight, { Color } from 'types/highlight'\r\nimport Selection from 'types/selection'\r\n\r\n\r\nconst ContextMenu = ({ \r\n  active,\r\n  viewerRef, \r\n  selection, \r\n  onAddHighlight,\r\n  onRemoveHighlight,\r\n  onUpdateHighlight, \r\n  onContextmMenuRemove\r\n}: Props) => {\r\n  const highlights = useSelector<RootState, Highlight[]>(state => state.book.highlights);\r\n  const colorList = useSelector<RootState, Color[]>(state => state.book.colorList);\r\n\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [highlight, setHighlight] = useState<Highlight | null>(null);\r\n  \r\n  const [display, setDisplay] = useState<boolean>(false);\r\n  const [isEraseBtn, setIsEraseBtn] = useState<boolean>(false);\r\n  const [isReverse, setIsReverse] = useState<boolean>(false);\r\n  \r\n  const [height, setHeight] = useState<number>(0);\r\n  const [y, setY] = useState<number>(selection.y);\r\n\r\n  const ColorList = colorList.map(\r\n    color => <ColorItem key={color.code}\r\n                        name={color.name}\r\n                        color={color.code}\r\n                        onClick={selection.update\r\n                          ? () => onUpdateHighlight(highlight, color.code)\r\n                          : () => onAddHighlight(color.code)\r\n                        } />\r\n  );\r\n\r\n  \r\n  /** Remove highlight */\r\n  const onRemoveHighlight_ = useCallback(() => {\r\n    if (!highlight) return;\r\n\r\n    onRemoveHighlight(highlight.key, highlight.cfiRange);\r\n    onContextmMenuRemove();\r\n    \r\n    setIsEraseBtn(false);\r\n  }, [highlight, onRemoveHighlight, onContextmMenuRemove]);\r\n\r\n  /** \r\n   * Remove contextmenu\r\n   * @param e Mouse Event\r\n   * @param e.path\r\n   */\r\n  const onRemove = useCallback(({ path }: any) => {\r\n    if (!menuRef.current) return;\r\n\r\n    if ([...path].includes(menuRef.current)) return;\r\n    onContextmMenuRemove();\r\n  }, [menuRef, onContextmMenuRemove]);\r\n  \r\n  /** \r\n   * Arrow event\r\n   * @param e Keyboard Event\r\n   * @param e.key\r\n   */\r\n  const onKeyPress = useCallback(({ key }: any) => {\r\n    key && key === \"ArrowLeft\" && onContextmMenuRemove();\r\n    key && key === \"ArrowRight\" && onContextmMenuRemove();\r\n  }, [onContextmMenuRemove]);\r\n\r\n\r\n  /** Check whether the menu button is visible */\r\n  useEffect(() => {\r\n    if (!active) setIsEraseBtn(false);\r\n\r\n    const paragraphCfi = getParagraphCfi(selection.cfiRange);\r\n    if (!paragraphCfi) return;\r\n\r\n    const filtered = highlights.filter(highlight => highlight.key === paragraphCfi + selection.cfiRange);\r\n\r\n    if (!filtered.length) return;\r\n    const highlight_ = filtered[0];\r\n    setHighlight(highlight_);\r\n\r\n    if (selection.update) {\r\n      setIsEraseBtn(true);\r\n    } else {\r\n      setIsEraseBtn(false);\r\n    }\r\n  }, [\r\n    active,\r\n    highlights, \r\n    selection.cfiRange,\r\n    selection.update\r\n  ]);\r\n\r\n  /** Register contextmenu events */\r\n  useEffect(() => {\r\n    if (!viewerRef.current) return;\r\n    \r\n    const iframe = document.querySelector('iframe');\r\n    const node = iframe && iframe.contentWindow && iframe.contentWindow.document;\r\n    const scrolledTarget = viewerRef.current.querySelector('div');\r\n\r\n    if (active) {\r\n      setDisplay(true);\r\n      scrolledTarget && scrolledTarget.addEventListener('scroll', onContextmMenuRemove);\r\n      node && node.addEventListener('mousedown', onRemove);\r\n      node && node.addEventListener('keyup', onKeyPress);\r\n      document.addEventListener('mousedown', onRemove);\r\n      document.addEventListener('keyup', onKeyPress);\r\n    } else {\r\n      setDisplay(false);\r\n      scrolledTarget && scrolledTarget.removeEventListener('scroll', onContextmMenuRemove);\r\n      node && node.removeEventListener('mousedown', onRemove);\r\n      node && node.removeEventListener('keyup', onKeyPress);\r\n      document.removeEventListener('mousedown', onRemove);\r\n      document.removeEventListener('keyup', onKeyPress);\r\n    };\r\n\r\n    return () => {\r\n      node && node.removeEventListener('mousedown', onContextmMenuRemove);\r\n      node && node.removeEventListener('keyup', onKeyPress);\r\n      document.removeEventListener('keyup', onKeyPress);\r\n    }\r\n  }, [\r\n    viewerRef, \r\n    active,\r\n    onRemove,\r\n    onContextmMenuRemove, \r\n    onKeyPress\r\n  ]);\r\n\r\n  /** Set modified contextmenu height & whether menu is reverse */\r\n  useEffect(() => {\r\n    const menuPadding = 8;\r\n    const itemHeight = 32;\r\n    let itemCnt = ColorList.length;\r\n    \r\n    if (isEraseBtn) itemCnt += 1;\r\n    \r\n    const defaultHeight = itemCnt * itemHeight + menuPadding;\r\n    let y_ = selection.y;\r\n    const { innerHeight } = window;\r\n    \r\n    if (selection.y + defaultHeight > innerHeight) {\r\n      y_ = selection.y - selection.height - (defaultHeight);\r\n      if (y_ < 0) {\r\n        setHeight(defaultHeight + y_ - 8);\r\n        y_ = 8;\r\n      } else {\r\n        setHeight(defaultHeight);\r\n      }\r\n      setIsReverse(true);\r\n    } else {\r\n      setHeight(defaultHeight);\r\n      setIsReverse(false);\r\n    }\r\n\r\n    setY(y_);\r\n  }, [\r\n    selection.y, \r\n    selection.height, \r\n    ColorList, \r\n    isEraseBtn, \r\n    setHeight\r\n  ]);\r\n\r\n\r\n  return (<>\r\n    {display && <Wrapper x={selection.x} \r\n                         y={y} \r\n                         width={contextmenuWidth}\r\n                         height={height}\r\n                         isReverse={isReverse}\r\n                         ref={menuRef}>\r\n      <div>\r\n        {ColorList}\r\n        {isEraseBtn && <Item text=\"Remove\" onClick={onRemoveHighlight_} />}\r\n      </div>\r\n    </Wrapper>}\r\n  </>);\r\n}\r\n\r\ninterface Props {\r\n  active: boolean;\r\n  viewerRef: any;\r\n  selection: Selection;\r\n  onAddHighlight: (color: string) => void;\r\n  onRemoveHighlight: (key: string, cfiRange: string) => void;\r\n  onUpdateHighlight: (highlight: Highlight | null, color: string) => void;\r\n  onContextmMenuRemove: () => void;\r\n}\r\n\r\nexport default ContextMenu","import { keyframes } from 'styled-components';\r\n\r\nconst fadeIn = keyframes`\r\n\t0% { opacity: 0; }\r\n\t100% { opacity: 1;}\r\n`;\r\nconst fadeOut = keyframes`\r\n\t0% { opacity: 1; }\r\n\t100% { opacity: 0; }\r\n`;\r\nconst fadeInTop = keyframes`\r\n\t0% { opacity: 0; transform: translateY(-40px); }\r\n\t100% { opacity: 1; transform: translateY(0); }\r\n`;\r\nconst fadeOutTop = keyframes`\r\n\t0% { opacity: 1; transform: translateY(0); }\r\n\t100% { opacity: 0; transform: translateY(-40px); }\r\n`;\r\nconst fadeInBottom = keyframes`\r\n\t0% { opacity: 0; transform: translateY(40px); }\r\n\t100% { opacity: 1; transform: translateY(0); }\r\n`;\r\nconst fadeOutBottom = keyframes`\r\n\t0% { opacity: 1; transform: translateY(0); }\r\n\t100% { opacity: 0; transform: translateY(40px); }\r\n`;\r\nconst fadeInLeft = keyframes`\r\n\t0% { opacity: 0; transform: translateX(-40px); }\r\n\t100% { opacity: 1; transform: translateX(0); }\r\n`;\r\nconst fadeOutLeft = keyframes`\r\n\t0% { opacity: 1; transform: translateX(0); }\r\n\t100% { opacity: 0; transform: translateX(-40px); }\r\n`;\r\nconst fadeInRight = keyframes`\r\n\t0% { opacity: 0; transform: translateX(40px); }\r\n\t100% { opacity: 1; transform: translateX(0); }\r\n`;\r\nconst fadeOutRight = keyframes`\r\n\t0% { opacity: 1; transform: translateX(0); }\r\n\t100% { opacity: 0; transform: translateX(40px); }\r\n`;\r\nconst spin = keyframes`\r\n\tfrom { transform: rotate(0deg); }\r\n\tto { transform: rotate(360deg); }\r\n`;\r\n\r\nconst animations = {\r\n\tfadeIn,\r\n\tfadeOut,\r\n\tfadeInTop,\r\n\tfadeOutTop,\r\n\tfadeInBottom,\r\n\tfadeOutBottom,\r\n\tfadeInLeft,\r\n\tfadeOutLeft,\r\n\tfadeInRight,\r\n\tfadeOutRight,\r\n\tspin\r\n};\r\n\r\nexport default animations","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\nimport media from 'lib/styles/media'\r\nimport palette from 'lib/styles/palette'\r\nimport animations from 'lib/styles/animations'\r\n// types\r\nimport SnackbarType from 'types/snackbar'\r\n\r\nconst Snackbar = ({ onClick, text, type }: Props)=> {\r\n\treturn (\r\n\t  <Container onClick={onClick} type={type}>\r\n\t  \t<Content>\r\n\t  \t  <Message>{text}</Message>\r\n\t  \t</Content>\r\n\t  </Container>\r\n\t);\r\n}\r\n\r\nconst Container = styled.div<{ type: SnackbarType }>`\r\n\tposition: relative;\r\n\twidth: 320px;\r\n\theight: auto;\r\n\tmax-height: 800px;\r\n\tbackground-color: ${({ type }) => {\r\n\t\t\tif (type === 'SUCCESS') {\t\r\n\t\t\t\treturn palette.green4;\r\n\t\t\t} else if (type === 'WARNING') {\r\n\t\t\t\treturn palette.orange4;\r\n\t\t\t} else if (type === 'ERROR') {\r\n\t\t\t\treturn palette.red3;\r\n\t\t\t} else if (type === 'INFO') {\r\n\t\t\t\treturn palette.blue4;\r\n\t\t\t} else {\r\n\t\t\t\treturn palette.gray4;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tbox-shadow: ${styles.boxShadow.regular};\r\n\tborder-radius: 4px;\r\n\tanimation: ${animations.fadeInBottom} .3s cubic-bezier(0.25,0.1,0.25,1),\r\n\t\t\t\t\t\t ${animations.fadeOutBottom} .5s cubic-bezier(0.25,0.1,0.25,1) 3.6s;\r\n\tcursor: pointer;\r\n\ttransition: .2s ${styles.transition};\r\n\t${styles.noselect};\r\n\r\n\t&:active {\r\n\t\ttransform: scale(.97, .97);\r\n\t}\r\n\r\n\t${media.small} {\r\n\t\tborder-radius: 0px;\r\n\t\twidth: 100%;\r\n\t\tmin-height: 1.8rem;\r\n\t}\r\n`;\r\n\r\nconst Content = styled.div`\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\twidth: 100%;\r\n\theight: auto;\r\n\tmin-height: 2rem;\r\n\tbox-sizing: border-box;\r\n\tpadding: 12px 20px;\r\n\r\n\t${media.small} {\r\n\t\tmin-height: 1.6rem;\r\n\t\tline-height: 1.6rem;\r\n\t}\r\n`;\r\n\r\nconst Message = styled.div`\r\n\tposition: relative;\r\n\tflex-grow: 1;\r\n\tcolor: white;\r\n\tfont-size: 14px;\r\n\twhite-space: pre-wrap;\r\n\tword-break: keep-all;\r\n\tvertical-align: top;\r\n`;\r\n\r\n\r\ninterface Props {\r\n\tonClick(e: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\r\n\ttext: string;\r\n\ttype: SnackbarType;\r\n}\r\n\r\nexport default Snackbar","import { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\r\n// types\r\nimport Snackbar from 'types/snackbar'\r\n\r\n\r\nconst RefEvent: number[] = [];\r\n\r\n\r\n/* \r\n\tThunks\r\n*/\r\nexport const newSnackbar = createAsyncThunk(\r\n\t'snackbar/newSnackbar',\r\n\tasync (\r\n\t\t{ text, type }: SnackbarState, \r\n\t\t{ dispatch }\r\n\t) => {\r\n\t\tif(RefEvent.length !== 0) {\r\n\t\t\tlet event = RefEvent.shift();\r\n\t\t\tclearTimeout(event);\r\n\t\t}\r\n\t\tdispatch(SnackbarSlice.actions.deleteSnackbar());\r\n\t\tawait setTimeout(function() {\r\n\t\t\tdispatch(SnackbarSlice.actions.appendSnackbar({ text, type: type ? type: \"INFO\" }));\r\n\t\t\tlet event = window.setTimeout(function() {\r\n\t\t\t\tdispatch(SnackbarSlice.actions.deleteSnackbar());\r\n\t\t\t}, 4000);\r\n\t\t\tRefEvent.push(event);\r\n\t\t}, 50);\r\n\t}\r\n);\r\n\r\n/* \r\n\tInitial State\r\n*/\r\n\r\nconst initialState: SnackbarState = {\r\n\ttext: \"\",\r\n\ttype: \"INFO\"\r\n}\r\n\r\n\r\n/* \r\n\tSlice\r\n*/\r\nconst SnackbarSlice = createSlice({\r\n\tname: 'snackbar',\r\n\tinitialState,\r\n\treducers: {\r\n\t\t/** 스낵바 갱신 @dispatch */\r\n\t\tappendSnackbar(state, action: PayloadAction<SnackbarState>) {\r\n\t\t\tstate.text = action.payload.text;\r\n\t\t\tstate.type = action.payload.type;\r\n\t\t},\r\n\t\t/** 스낵바 초기화 @dispatch */\r\n\t\tdeleteSnackbar(state) {\r\n\t\t\tstate.text = \"\";\r\n\t\t\tstate.type = \"INFO\"\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nexport interface SnackbarState {\r\n\ttext: string;\r\n\ttype: Snackbar;\r\n}\r\n\r\nexport const {\r\n\tappendSnackbar,\r\n\tdeleteSnackbar\r\n} = SnackbarSlice.actions\r\n\r\nexport default SnackbarSlice.reducer","import styled from 'styled-components'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\n// components\r\nimport Snackbar from 'components/commons/Snackbar'\r\n// lib\r\nimport zIndex from 'lib/styles/zIndex'\r\nimport media from 'lib/styles/media'\r\n// slices\r\nimport { deleteSnackbar } from 'slices/snackbar'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { SnackbarState } from 'slices/snackbar'\r\n\r\n\r\nconst SnackbarWrapper = ()=> {\r\n  const dispatch = useDispatch();\r\n\tconst snackbar = useSelector<RootState, SnackbarState>(state => state.snackbar);\r\n\t\r\n\r\n\tconst onClick = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\r\n\t\tif (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t\tdispatch(deleteSnackbar());\r\n\t};\r\n\r\n\t\r\n\treturn (\r\n\t\t<Container>\r\n\t\t\t{snackbar.text !== '' && <Snackbar onClick={onClick} \r\n                                         text={snackbar.text} \r\n                                         type={snackbar.type} />}\r\n\t\t</Container>\r\n\t);\r\n}\r\n\r\nconst Container = styled.div`\r\n\tposition: fixed;\r\n\ttop: 40px;\r\n\tright: 30px;\r\n\twidth: 320px;\r\n\theight: auto;\r\n\tz-index: ${zIndex.snackbar};\r\n\r\n\t${media.small} {\r\n\t\twidth: 100%;\r\n\t\ttop: initial;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tmargin: auto;\r\n\t}\r\n`;\r\n\r\nexport default SnackbarWrapper","import styled from 'styled-components'\r\n// lib\r\nimport * as styles from 'lib/styles/styles'\r\n\r\nconst ViewerWrapper = styled.div`\r\n  position: relative;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  overflow-x: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n  ${styles.scrollbar(0)};\r\n`;\r\n\r\nexport default ViewerWrapper","import styled, { keyframes } from 'styled-components'\r\n\r\nconst LoadingView = () => {\r\n  return (\r\n    <LoadingWrapper>\r\n      <Wrapper>\r\n        <Content />\r\n      </Wrapper>\r\n    </LoadingWrapper>\r\n  );\r\n}\r\n\r\nconst spin = keyframes`\r\n\tfrom { transform: rotate(0deg); }\r\n\tto { transform: rotate(360deg); }\r\n`;\r\n\r\nconst LoadingWrapper = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`;\r\n\r\nconst Wrapper = styled.div`\r\n\tposition: relative;\r\n\twidth: 100%;\r\n\theight: 30px;\r\n\tmargin: 30px 0;\r\n\ttext-align: center;\r\n`;\r\n\r\nconst Content = styled.div`\r\n\tdisplay: inline-block;\r\n\twidth: 30px;\r\n\theight: 30px;\r\n\tborder: 3px solid #ebf1ff;\r\n\tborder-radius: 50%;\r\n\tborder-top-color: #3972ff;\r\n\tanimation: ${spin} 1s ease-in-out infinite;\r\n`;\r\n\r\nexport default LoadingView","import { configureStore } from \"@reduxjs/toolkit\";\r\nimport { combineReducers } from 'redux'\r\n// reducers\r\nimport book from 'slices/book'\r\nimport snackbar from 'slices/snackbar'\r\n\r\n/**\r\n * 모든 리듀서가 결합된 Root 리듀서\r\n */\r\nconst reducer = combineReducers({\r\n\tbook,\r\n\tsnackbar\r\n});\r\n\r\nexport type RootState = ReturnType<typeof reducer>\r\n\r\n/**\r\n * 공통 Store\r\n */\r\nconst store = configureStore({\r\n\treducer,\t\r\n});\r\n\r\nexport default store","import { useState, useEffect, useCallback } from 'react';\r\n\r\n/**\r\n * Epub Reader 메뉴를 컨트롤 하는 hook\r\n * - control의 display를 Menu 생성/제거 플래그로 이용합니다.\r\n * - control의 show를 Animaton 플래그로 이용합니다.\r\n * - Menu 이외의 영역 클릭시 Close Event 발동\r\n *\r\n * @param ref DOM을 가지고 있는 useRef\r\n * @param delay 애니메이션 딜레이 시간(ms)\r\n * \r\n * @example\r\n * const Viewer = () => {\r\n *   const menuDelay = 300;\r\n * \r\n *   const ref = useRef<HTMLDivElement | null>(null);\r\n *   const [control, onToggle] = usemenu(ref, menuDelay);\r\n * \r\n *   return (<>\r\n *     <MenuOpenBtn onClick={onToggle} />\r\n *     <Menu control={control} onToggle={onToggle} ref={ref} />\r\n *   </>);\r\n * }\r\n * \r\n * const Menu = ({ control, onToggle }, ref) => {\r\n *   return (<>\r\n *     {control.display && <MenuWrapper show={control.show} \r\n *                                      delay={menuDelay}\r\n *                                      ref={ref}>\r\n *       <CloseBtn onClick={onToggle} />\r\n *     </MenuWrapper>}\r\n *   </>);\r\n * }\r\n * \r\n * const MenuWrapper = styled.div<{show: boolean; delay: boolean;}>`\r\n *   transform: ${({show}) => show\r\n *     ? \"translateX(0px)\"\r\n *     : \"translateX(420px)\"\r\n *   };\r\n *   transition: ${({delay}) => `${delay}ms ease`};\r\n * `;\r\n */\r\nfunction useMenu(ref: { current: any }, delay: number) {\r\n\tconst [eventSignal, setEventSignal] = useState<boolean>(true);\r\n\tconst [control, setControl] = useState<MenuControl>({\r\n\t\tdisplay: false,\r\n\t\topen: false\r\n\t});\r\n\t\r\n\r\n\t/** Menu 토글 */\r\n\tconst onToggle = useCallback(() => {\r\n\t\tlet event: any = null;\r\n\t\twindow.clearTimeout(event);\r\n\t\tif (!control.display) {\r\n\t\t\tsetControl({ display: true, open: false });\r\n\t\t\tevent = window.setTimeout(() => setControl({ display: true, open: true}), 0);\r\n\t\t} else {\r\n\t\t\tsetControl({ display: true, open: false });\r\n\t\t\tevent = window.setTimeout(() => setControl({ display: false, open: false }), delay - 50);\r\n\t\t}\r\n\t}, [control.display, delay]);\r\n\r\n\t/** \r\n\t * 메뉴 닫기 \r\n\t * - Event path에서 메뉴가 포함되어있지 않으면, 함수를 실행합니다.\r\n\t */\r\n  const onClose = useCallback((e: any) => {\r\n    if (!ref || !ref.current) return;\r\n    if (!e.path.includes(ref.current)) {\r\n\t\t\tonToggle();\r\n    }\r\n  }, [ref, onToggle]);\r\n\r\n\t/** \r\n\t * 이벤트 재등록\r\n\t * - '보기설정' 에서 rendition이 재 렌더링 될 때, 이벤트를 재등록하기 위한 함수\r\n\t * - Iframe 생성 시간 대기 [About 250ms]\r\n\t */\r\n\tconst emitEvent = useCallback(() => {\r\n\t\twindow.setTimeout(() => setEventSignal(true), 300);\r\n\t}, [setEventSignal]); \r\n\r\n\r\n  /** \r\n\t * 목차 닫기 이벤트 등록 \r\n\t * - Epub이 iframe으로 등록되므로, iframe에도 Event를 등록시켜줍니다.\r\n\t */\r\n  useEffect(() => {\r\n\t\tif (!eventSignal && !control.display) return;\r\n\t\t\r\n    const epubIframe = document.querySelector('iframe');\r\n\r\n\t\tif (control.display) {\r\n\t\t\tdocument.addEventListener('click', onClose);\r\n\t\t\tif (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.addEventListener('click', onClose);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdocument.removeEventListener('click', onClose);\r\n      if (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.removeEventListener('click', onClose);\r\n      }\r\n\t\t}\r\n\r\n\t\tsetEventSignal(false);\r\n  \r\n    return () => {\r\n      document.removeEventListener('click', onClose);\r\n      if (epubIframe && epubIframe.contentWindow) {\r\n\t\t\t\tepubIframe.contentWindow.document.removeEventListener('click', onClose);\r\n      }\r\n    }\r\n  }, [control.display, onClose, eventSignal]);\r\n\r\n\treturn [control, onToggle, emitEvent] as const;\r\n}\r\n\r\nexport type MenuControl = {\r\n\tdisplay: boolean;\r\n\topen: boolean;\r\n}\r\n\r\nexport default useMenu","import React, { useState, useEffect, useCallback } from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\n// slices\r\nimport { pushHighlight, popHighlight, updateHighlight } from 'slices/book'\r\nimport { newSnackbar } from 'slices/snackbar'\r\n// utils\r\nimport {  \r\n\tgetParagraphCfi,\r\n\tclashCfiRange, \r\n\tgetSelectionPosition,\r\n\tcompareCfi,\r\n\tcfiRangeSpliter,\r\n\tgetNodefromCfi\r\n} from 'lib/utils/commonUtil'\r\n// styles\r\nimport viewerLayout, { contextmenuWidth } from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { BookStyle, BookFlow } from 'types/book'\r\nimport Page from 'types/page'\r\nimport Selection from 'types/selection'\r\nimport Highlight from 'types/highlight'\r\n\r\n\r\n/**\r\n * Epub Reader의 Highlight 관련 hook\r\n * - [selection]: 현재 selection의 정보\r\n * - [onSelection]: selection 적용 함수 (Iframe에 selection 이벤트로 등록해야 합니다.)\r\n * - [onClickHighlight]: highlight 클릭 함수\r\n * - [onAddHighlight] highlight 생성 함수\r\n * - [onRemoveHighlight]: highlight 제거 함수\r\n * - [onUpdateHighlight]: highlight 갱신 함수\r\n *\r\n * @param viewerRef Viewer에 등록된 가지고 있는 useRef\r\n * @param setIsContextMenu Contextmenu를 컨트롤 할 수 있는 useState 함수\r\n * \r\n * @example\r\n * const [isContextMenu, setIsContextMenu] = useState<boolean>(false);\r\n * \r\n * const { \r\n * \tselection, \r\n * \tonSelection, \r\n * \tonClickHighlight,\r\n * \tonRemoveHighlight\r\n * } = useSelection(viewerRef, setIsContextMenu);\r\n */\r\nconst useHighlight = (\r\n\tviewerRef: any, \r\n\tsetIsContextMenu: React.Dispatch<React.SetStateAction<boolean>>,\r\n\tbookStyle: BookStyle,\r\n\tbookFlow: BookFlow\r\n) => {\r\n\tconst dispatch = useDispatch();\r\n\tconst currentLocation = useSelector<RootState, Page>(state => state.book.currentLocation);\r\n\tconst highlights = useSelector<RootState, Highlight[]>(state => state.book.highlights);\r\n\r\n\tconst [selection, setSelection] = useState<Selection>({\r\n\t\tupdate: false,\r\n\t\tx: 0,\r\n\t\ty: 0,\r\n\t\theight: 0,\r\n\t\tcfiRange: '',\r\n\t\tcontent: ''\r\n\t});\r\n\t\r\n\r\n\t/** \r\n\t * Selection 발동 이벤트\r\n\t * @param cfiRange CfiRange\r\n\t * @return Whether event is success\r\n\t */\r\n\tconst onSelection = useCallback((cfiRange: string): boolean => {\r\n\t\tif (!viewerRef.current) return false;\r\n\r\n\t\tconst iframe = viewerRef.current.querySelector('iframe');\r\n\t\tif (!iframe) return false;\r\n\r\n\t\tconst iframeWin = iframe.contentWindow;\r\n\t\tif (!iframeWin) return false;\r\n\t\t\r\n\t\tconst filtered = highlights.filter(\r\n\t\t\thighlight => clashCfiRange(highlight.cfiRange, cfiRange)\r\n\t\t);\r\n\r\n\t\tif (filtered.length > 0) {\r\n\t\t\tdispatch(newSnackbar({\r\n        text: \"There are already registered highlights in your selection.\", \r\n        type: \"WARNING\" \r\n      }));\r\n\r\n\t\t\tiframeWin.getSelection().removeAllRanges();\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst position = getSelectionPosition(\r\n\t\t\tviewerRef.current,\r\n\t\t\tbookStyle,\r\n\t\t\tbookFlow,\r\n\t\t\tviewerLayout.MIN_VIEWER_WIDTH,\r\n\t\t\tviewerLayout.MIN_VIEWER_HEIGHT,\r\n\t\t\tviewerLayout.VIEWER_HEADER_HEIGHT,\r\n\t\t\tcontextmenuWidth\r\n\t\t);\r\n\t\tif (!position) return false;\r\n\r\n\t\tconst { x, y, height } = position;\r\n\r\n\t\tconst content = iframeWin.getSelection().toString().trim();\r\n\r\n\t\tif (content.length === 0) return false;\r\n\t\t\r\n\t\tsetSelection({ \r\n\t\t\tupdate: false,\r\n\t\t\tx, \r\n\t\t\ty,\r\n\t\t\theight,\r\n\t\t\tcfiRange,\r\n\t\t\tcontent\r\n\t\t});\r\n\t\t\r\n\t\treturn true;\r\n\t}, [\r\n\t\tdispatch, \r\n\t\tviewerRef,\r\n\t\thighlights, \r\n\t\tbookFlow, \r\n\t\tbookStyle,\r\n\t\tsetSelection\r\n\t]);\r\n\r\n\t/** Highlight 클릭 이벤트 */\r\n\tconst onClickHighlight = useCallback((highlightNode: HTMLElement) => {\r\n\t\tconst targetNode = highlightNode.parentElement;\r\n\t\tif (!targetNode) return;\r\n\r\n\t\tconst cfiRange = targetNode.dataset.epubcfi;\r\n\t\tif (!cfiRange) return;\r\n\r\n\t\tconst { x, y, width, height } = targetNode.getBoundingClientRect();\r\n\r\n\t\tsetSelection({ \r\n\t\t\tupdate: true,\r\n\t\t\tx: x + width / 2 - contextmenuWidth / 2, \r\n\t\t\ty: y + height,\r\n\t\t\theight,\r\n\t\t\tcfiRange,\r\n\t\t\tcontent: \"\"\r\n\t\t});\r\n\t}, [setSelection]);\r\n\r\n\t/** 하이라이트 생성 함수 */\r\n\tconst onAddHighlight = useCallback((color: string) => {\r\n    const paragraphCfi = getParagraphCfi(selection.cfiRange);\r\n    if (!paragraphCfi) return;\r\n    \r\n    const highlight: Highlight = {\r\n      key: paragraphCfi + selection.cfiRange,\r\n      accessTime: new Date().toISOString(),\r\n      createTime: new Date().toISOString(),\r\n      color,\r\n      paragraphCfi,\r\n      cfiRange: selection.cfiRange,\r\n      chpaterName: currentLocation.chapterName,\r\n      pageNum: currentLocation.currentPage,\r\n      content: selection.content\r\n    };\r\n\r\n    dispatch(pushHighlight(highlight));\r\n\r\n\t\tsetSelection({ ...selection, update: true });\r\n  }, [dispatch, selection, currentLocation]);\r\n\r\n\t/** \r\n   * 하이라이트 수정\r\n   * @param color 색상 Hex 코드\r\n   */\r\n\tconst onUpdateHighlight = useCallback((highlight: Highlight | null, color: string) => {\r\n\t\tif (!highlight) return;\r\n\r\n    dispatch(updateHighlight({\r\n      ...highlight,\r\n      color\r\n    }));\r\n  }, [dispatch]);\r\n\r\n\t/** \r\n\t * 하이라이트 제거 함수 \r\n\t * @param key 북마크 식별값\r\n\t */\r\n\t const onRemoveHighlight = useCallback((key: string, cfiRange: string) => {\r\n\t\tif (!viewerRef.current || !key) return;\r\n\r\n\t\tdispatch(popHighlight(key));\r\n\r\n\t\tdispatch(newSnackbar({\r\n\t\t\ttext: \"The highlight removed successful!\", \r\n\t\t\ttype: \"INFO\" \r\n\t\t}));\r\n\t\t\r\n\t\tviewerRef.current.offHighlight(cfiRange);\r\n\t}, [dispatch, viewerRef]);\r\n\r\n\r\n\t/**\r\n\t * 하이라이트 여부 확인\r\n\t * - 페이지 변경에 따른 하이라이트 확인 및 적용\r\n\t */\r\n\t useEffect(() => {\r\n\t\tif (!viewerRef.current) return;\r\n\r\n\t\tconst iframe = viewerRef.current.querySelector('iframe');\r\n\t\tif (!iframe) return;\r\n\r\n\t\tconst iframeWin = iframe.contentWindow;\r\n\t\tif (!iframeWin) return;\r\n\r\n\t\thighlights.forEach(highlight => {\r\n\t\t\tconst cfiRange = cfiRangeSpliter(highlight.cfiRange);\r\n\t\t\tif (!cfiRange) return;\r\n\r\n\t\t\tconst { startCfi } = cfiRange;\r\n\r\n\t\t\tif (compareCfi(currentLocation.startCfi, startCfi) < 1\r\n\t\t\t\t&& compareCfi(currentLocation.endCfi, startCfi) > -1) {\r\n\t\t\t\tconst node = getNodefromCfi(highlight.paragraphCfi);\r\n\t\t\t\tif (!node) return;\r\n\r\n\t\t\t\tviewerRef.current.onHighlight(\r\n\t\t\t\t\thighlight.cfiRange,\r\n\t\t\t\t\t(e: any) => {\r\n\t\t\t\t\t\tonClickHighlight(e.target);\r\n\t\t\t\t\t\tsetIsContextMenu(true);\r\n\t\t\t\t\t},\r\n\t\t\t\t\thighlight.color \r\n\t\t\t\t);\r\n\r\n\t\t\t\tiframeWin.getSelection().removeAllRanges();\r\n\t\t\t}\r\n\t\t});\r\n\t}, [\r\n\t\tdispatch,\r\n\t\tviewerRef, \r\n\t\tcurrentLocation, \r\n\t\thighlights, \r\n\t\tonRemoveHighlight,\r\n\t\tonClickHighlight,\r\n\t\tsetIsContextMenu\r\n\t]);\r\n\r\n\r\n\treturn { \r\n\t\tselection, \r\n\t\tonSelection, \r\n\t\tonClickHighlight,\r\n\t\tonAddHighlight,\r\n\t\tonRemoveHighlight,\r\n\t\tonUpdateHighlight\r\n\t};\r\n}\r\n\r\nexport default useHighlight;","import { useState, useRef } from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { Provider } from 'react-redux'\r\nimport { ReactEpubViewer } from 'react-epub-viewer'\r\n// containers\r\nimport Header from 'containers/Header'\r\nimport Footer from 'containers/Footer'\r\nimport Nav from 'containers/menu/Nav'\r\nimport Option from 'containers/menu/Option'\r\nimport Learning from 'containers/menu/Note'\r\nimport ContextMenu from 'containers/commons/ContextMenu'\r\nimport Snackbar from 'containers/commons/Snackbar'\r\n// components\r\nimport ViewerWrapper from 'components/commons/ViewerWrapper'\r\nimport LoadingView from 'LoadingView'\r\n// slices\r\nimport store from 'slices'\r\nimport { updateBook, updateCurrentPage, updateToc } from 'slices/book'\r\n// hooks\r\nimport useMenu from 'lib/hooks/useMenu'\r\nimport useHighlight from 'lib/hooks/useHighlight'\r\n// styles\r\nimport 'lib/styles/readerStyle.css'\r\nimport viewerLayout from 'lib/styles/viewerLayout'\r\n// types\r\nimport { RootState } from 'slices'\r\nimport { ViewerRef } from 'types'\r\nimport Book, { BookStyle, BookOption } from 'types/book'\r\nimport Page from 'types/page'\r\nimport Toc from 'types/toc'\r\n\r\n\r\nconst Reader = ({ url, loadingView }: Props) => {\r\n  const dispatch = useDispatch();\r\n\tconst currentLocation = useSelector<RootState, Page>(state => state.book.currentLocation);\r\n  \r\n\tconst viewerRef = useRef<ViewerRef | any>(null);\r\n\tconst navRef = useRef<HTMLDivElement | null>(null);\r\n  const optionRef = useRef<HTMLDivElement | null>(null);\r\n  const learningRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\tconst [isContextMenu, setIsContextMenu] = useState<boolean>(false);\r\n\t\r\n\tconst [bookStyle, setBookStyle] = useState<BookStyle>({\r\n    fontFamily: 'Origin',\r\n    fontSize: 18,\r\n    lineHeight: 1.4,\r\n    marginHorizontal: 15,\r\n    marginVertical: 5\r\n  });\r\n\r\n  const [bookOption, setBookOption] = useState<BookOption>({\r\n    flow: \"paginated\",\r\n    resizeOnOrientationChange: true,\r\n    spread: \"auto\"\r\n  });\r\n\r\n\tconst [navControl, onNavToggle] = useMenu(navRef, 300.);\r\n\tconst [optionControl, onOptionToggle, emitEvent] = useMenu(optionRef, 300);\r\n\tconst [learningControl, onLearningToggle] = useMenu(learningRef, 300);\r\n\tconst { \r\n\t\tselection, \r\n\t\tonSelection, \r\n\t\tonClickHighlight,\r\n\t\tonAddHighlight,\r\n\t\tonRemoveHighlight,\r\n\t\tonUpdateHighlight\r\n\t} = useHighlight(viewerRef, setIsContextMenu, bookStyle, bookOption.flow);\r\n\r\n\r\n\r\n\t/**\r\n\t * Change Epub book information\r\n\t * @param book Epub Book Info\r\n\t */\r\n\tconst onBookInfoChange = (book: Book) => dispatch(updateBook(book));\r\n\r\n  /**\r\n\t * Change Epub location\r\n\t * @param loc epubCFI or href\r\n\t */\r\n\tconst onLocationChange = (loc: string) => {\r\n\t\tif (!viewerRef.current) return;\r\n\t\tviewerRef.current.setLocation(loc);\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * Move page\r\n\t * @param type Direction\r\n\t */\r\n\tconst onPageMove = (type: \"PREV\" | \"NEXT\") => {\r\n\t\tconst node = viewerRef.current;\r\n\t\tif (!node || !node.prevPage || !node.nextPage) return;\r\n\r\n\t\ttype === \"PREV\" && node.prevPage();\r\n\t\ttype === \"NEXT\" && node.nextPage();\r\n\t};\r\n\r\n\t/**\r\n\t * Set toc\r\n\t * @param toc Table of Epub contents\r\n\t */\r\n\tconst onTocChange = (toc: Toc[]) => dispatch(updateToc(toc));\r\n\r\n\t/** \r\n\t * Set Epub viewer styles\r\n\t * @param bokkStyle_ viewer style\r\n\t */\r\n\tconst onBookStyleChange = (bookStyle_: BookStyle) => setBookStyle(bookStyle_);\r\n\r\n\t/** \r\n\t * Set Epub viewer options\r\n\t * @param bookOption_ viewer option\r\n\t */\r\n\t const onBookOptionChange = (bookOption_: BookOption) => setBookOption(bookOption_);\r\n\r\n\t/**\r\n\t * Change current page\r\n\t * @param page Epub page\r\n\t */\r\n\tconst onPageChange = (page: Page) => dispatch(updateCurrentPage(page));\r\n\r\n\t/** \r\n\t * ContextMenu on \r\n\t * @param cfiRange CfiRange\r\n\t */\r\n\tconst onContextMenu = (cfiRange: string) => {\r\n\t\tconst result = onSelection(cfiRange);\r\n\t\tsetIsContextMenu(result);\r\n\t}\r\n\r\n\t/** ContextMenu off */\r\n\tconst onContextmMenuRemove = () => setIsContextMenu(false);\r\n\r\n\t\r\n\t\r\n  return (<>\r\n    <ViewerWrapper>\r\n      <Header \r\n\t\t\t\tonNavToggle={onNavToggle}\r\n\t\t\t\tonOptionToggle={onOptionToggle}\r\n\t\t\t\tonLearningToggle={onLearningToggle}\r\n\t\t\t/>\r\n\r\n      <ReactEpubViewer \r\n\t\t\t\turl={url}\r\n\t\t\t\tviewerLayout={viewerLayout}\r\n\t\t\t\tviewerStyle={bookStyle}\r\n\t\t\t\tviewerOption={bookOption}\r\n\t\t\t\tonBookInfoChange={onBookInfoChange}\r\n\t\t\t\tonPageChange={onPageChange}\r\n\t\t\t\tonTocChange={onTocChange}\r\n\t\t\t\tonSelection={onContextMenu}\r\n\t\t\t\tloadingView={loadingView || <LoadingView />}\r\n\t\t\t\tref={viewerRef}\r\n\t\t\t/>\r\n      \r\n\t\t\t<Footer \r\n\t\t\t\ttitle={currentLocation.chapterName}\r\n\t\t\t\tnowPage={currentLocation.currentPage}\r\n\t\t\t\ttotalPage={currentLocation.totalPage}\r\n\t\t\t\tonPageMove={onPageMove}\r\n\t\t\t/>\r\n    </ViewerWrapper>\r\n\r\n    <Nav\r\n\t\t\tcontrol={navControl}\r\n\t\t\tonToggle={onNavToggle}\r\n\t\t\tonLocation={onLocationChange}\r\n\t\t\tref={navRef}\r\n\t\t/>\r\n    \r\n    <Option \r\n\t\t\tcontrol={optionControl}\r\n\t\t\tbookStyle={bookStyle}\r\n\t\t\tbookOption={bookOption}\r\n\t\t\tbookFlow={bookOption.flow}\r\n\t\t\tonToggle={onOptionToggle} \r\n\t\t\temitEvent={emitEvent}\r\n\t\t\tonBookStyleChange={onBookStyleChange}\r\n\t\t\tonBookOptionChange={onBookOptionChange}\r\n\t\t\tref={optionRef}\r\n\t\t/>\r\n\r\n\t\t<Learning \r\n\t\t\tcontrol={learningControl}\r\n\t\t\tonToggle={onLearningToggle}\r\n\t\t\tonClickHighlight={onClickHighlight}\r\n\t\t\temitEvent={emitEvent}\r\n\t\t\tviewerRef={viewerRef}\r\n\t\t\tref={learningRef}\r\n\t\t/>\r\n\r\n\t\t<ContextMenu\r\n\t\t\tactive={isContextMenu}\r\n\t\t\tviewerRef={viewerRef}\r\n\t\t\tselection={selection}\r\n\t\t\tonAddHighlight={onAddHighlight}\r\n\t\t\tonRemoveHighlight={onRemoveHighlight}\r\n\t\t\tonUpdateHighlight={onUpdateHighlight}\r\n\t\t\tonContextmMenuRemove={onContextmMenuRemove}\r\n\t\t/>\r\n\r\n\t\t<Snackbar />\r\n  </>);\r\n}\r\n\r\nconst ReaderWrapper = ({ url, loadingView }: Props) => {\r\n\treturn (\r\n\t\t<Provider store={store}>\r\n\t\t\t<Reader url={url} loadingView={loadingView} />\r\n\t\t</Provider>\r\n\t);\r\n}\r\n\r\ninterface Props {\r\n\turl: string;\r\n\tloadingView?: React.ReactNode;\r\n}\r\n\r\nexport default ReaderWrapper","import ReactDOM from 'react-dom';\r\nimport Reader from 'containers/Reader'\r\n\r\nconst EPUB_URL = \"/react-epub-viewer/files/Alices Adventures in Wonderland.epub\";\r\n\r\nReactDOM.render(<Reader url={EPUB_URL} />,  document.getElementById('root'));"],"sourceRoot":""}